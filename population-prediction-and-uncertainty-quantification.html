<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Population Prediction and Uncertainty Quantification | WorldPop Population Modelling Training Manual, Vol. I</title>
  <meta name="description" content="An open book of WorldPop methods to produce gridded population estimates." />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Population Prediction and Uncertainty Quantification | WorldPop Population Modelling Training Manual, Vol. I" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="An open book of WorldPop methods to produce gridded population estimates." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Population Prediction and Uncertainty Quantification | WorldPop Population Modelling Training Manual, Vol. I" />
  
  <meta name="twitter:description" content="An open book of WorldPop methods to produce gridded population estimates." />
  

<meta name="author" content="WorldPop, University of Southampton" />


<meta name="date" content="2025-07-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="model-fit-checks-and-cross-validation.html"/>
<link rel="next" href="age-sex-disaggregation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<link href="libs/health_facilities - type-CSS-0.0.1/health_facilities - type_home-button.css" rel="stylesheet" />
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<link href="libs/states-CSS-0.0.1/states_home-button.css" rel="stylesheet" />
<link href="libs/states_utm-CSS-0.0.1/states_utm_home-button.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#preface"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#book-contents"><i class="fa fa-check"></i>Book Contents</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html"><i class="fa fa-check"></i><b>1</b> Basics of R Programming</a>
<ul>
<li class="chapter" data-level="1.1" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#overview-of-r"><i class="fa fa-check"></i><b>1.1</b> Overview of R</a>
<ul>
<li class="chapter" data-level="" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#getting-started-with-r"><i class="fa fa-check"></i>Getting started with R</a>
<ul>
<li class="chapter" data-level="" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#downloading-r-and-rstudio"><i class="fa fa-check"></i>Downloading R and RStudio</a></li>
<li class="chapter" data-level="" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#features-of-the-r-gui-environment"><i class="fa fa-check"></i>Features of the R GUI environment</a></li>
<li class="chapter" data-level="" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#features-of-the-rstudio-environment"><i class="fa fa-check"></i>Features of the RStudio environment</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#creating-opening-and-saving-r-scripts"><i class="fa fa-check"></i>Creating, opening and saving R scripts</a></li>
<li class="chapter" data-level="1.1.1" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#getting-and-setting-the-working-directory"><i class="fa fa-check"></i><b>1.1.1</b> Getting and setting the working directory</a></li>
<li class="chapter" data-level="1.1.2" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#creating-opening-and-saving-r-projects"><i class="fa fa-check"></i><b>1.1.2</b> Creating, opening and saving R projects</a></li>
<li class="chapter" data-level="1.1.3" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#getting-help-in-r"><i class="fa fa-check"></i><b>1.1.3</b> Getting help in R</a></li>
<li class="chapter" data-level="1.1.4" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#r-coding-best-practices"><i class="fa fa-check"></i><b>1.1.4</b> R coding best practices</a>
<ul>
<li class="chapter" data-level="1.1.4.1" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#commenting"><i class="fa fa-check"></i><b>1.1.4.1</b> Commenting</a></li>
<li class="chapter" data-level="1.1.4.2" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#naming-conventions"><i class="fa fa-check"></i><b>1.1.4.2</b> Naming conventions</a></li>
<li class="chapter" data-level="1.1.4.3" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#spacing"><i class="fa fa-check"></i><b>1.1.4.3</b> Spacing</a></li>
<li class="chapter" data-level="1.1.4.4" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#punctuation"><i class="fa fa-check"></i><b>1.1.4.4</b> Punctuation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#data-types-and-key-components"><i class="fa fa-check"></i><b>1.2</b> Data types and key components</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#basic-operations-in-r"><i class="fa fa-check"></i><b>1.2.1</b> Basic operations in R</a>
<ul>
<li class="chapter" data-level="1.2.1.1" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#arithmetic-operators"><i class="fa fa-check"></i><b>1.2.1.1</b> Arithmetic operators</a></li>
<li class="chapter" data-level="1.2.1.2" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#logical-operators"><i class="fa fa-check"></i><b>1.2.1.2</b> Logical operators</a></li>
<li class="chapter" data-level="1.2.1.3" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#other-operators"><i class="fa fa-check"></i><b>1.2.1.3</b> Other operators</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#key-functions-in-r"><i class="fa fa-check"></i><b>1.3</b> Key functions in R</a></li>
<li class="chapter" data-level="1.4" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#data-structures"><i class="fa fa-check"></i><b>1.4</b> Data structures</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#vectors"><i class="fa fa-check"></i><b>1.4.1</b> Vectors</a></li>
<li class="chapter" data-level="1.4.2" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#matrices"><i class="fa fa-check"></i><b>1.4.2</b> Matrices</a></li>
<li class="chapter" data-level="1.4.3" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#arrays"><i class="fa fa-check"></i><b>1.4.3</b> Arrays</a></li>
<li class="chapter" data-level="1.4.4" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#data-frames"><i class="fa fa-check"></i><b>1.4.4</b> Data frames</a></li>
<li class="chapter" data-level="1.4.5" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#list"><i class="fa fa-check"></i><b>1.4.5</b> List</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#end-of-module-exercises"><i class="fa fa-check"></i><b>1.5</b> End of module exercises</a></li>
<li class="chapter" data-level="1.6" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#useful-resources"><i class="fa fa-check"></i><b>1.6</b> Useful resources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html"><i class="fa fa-check"></i><b>2</b> Working with Data Frames</a>
<ul>
<li class="chapter" data-level="2.1" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#importing-and-exporting-data-in-and-from-r"><i class="fa fa-check"></i><b>2.1</b> Importing and exporting data in and from R</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#installing-and-loading-packages"><i class="fa fa-check"></i><b>2.1.1</b> Installing and loading packages</a></li>
<li class="chapter" data-level="2.1.2" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#reading-data-into-the-r-environment"><i class="fa fa-check"></i><b>2.1.2</b> Reading data into the R environment</a></li>
<li class="chapter" data-level="2.1.3" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#creating-work-paths"><i class="fa fa-check"></i><b>2.1.3</b> Creating work paths</a></li>
<li class="chapter" data-level="2.1.4" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#exploring-data-attributes"><i class="fa fa-check"></i><b>2.1.4</b> Exploring data attributes</a></li>
<li class="chapter" data-level="2.1.5" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#viewing-data"><i class="fa fa-check"></i><b>2.1.5</b> Viewing data</a></li>
<li class="chapter" data-level="2.1.6" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#extracting-data"><i class="fa fa-check"></i><b>2.1.6</b> Extracting data</a></li>
<li class="chapter" data-level="2.1.7" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#attaching-data"><i class="fa fa-check"></i><b>2.1.7</b> Attaching data</a></li>
<li class="chapter" data-level="2.1.8" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#writing-data-to-external-repositories"><i class="fa fa-check"></i><b>2.1.8</b> Writing data to external repositories</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#basic-data-wrangling-methods-for-data-preparation-and-handling-in-r"><i class="fa fa-check"></i><b>2.2</b> Basic data wrangling methods for data preparation and handling in R</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#dealing-with-na-not-available-values"><i class="fa fa-check"></i><b>2.2.1</b> Dealing with NA (‘Not Available’) values</a></li>
<li class="chapter" data-level="2.2.2" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#key-data-wrangling-methods"><i class="fa fa-check"></i><b>2.2.2</b> Key data wrangling methods</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#data-visualisation"><i class="fa fa-check"></i><b>2.3</b> Data visualisation</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#bar-plots"><i class="fa fa-check"></i><b>2.3.1</b> Bar plots</a></li>
<li class="chapter" data-level="2.3.2" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#box-plots"><i class="fa fa-check"></i><b>2.3.2</b> Box plots</a></li>
<li class="chapter" data-level="2.3.3" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#histograms"><i class="fa fa-check"></i><b>2.3.3</b> Histograms</a></li>
<li class="chapter" data-level="2.3.4" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#density-plots"><i class="fa fa-check"></i><b>2.3.4</b> Density plots</a></li>
<li class="chapter" data-level="2.3.5" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#scatter-plots"><i class="fa fa-check"></i><b>2.3.5</b> Scatter plots</a></li>
<li class="chapter" data-level="2.3.6" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#violin-plots"><i class="fa fa-check"></i><b>2.3.6</b> Violin plots</a></li>
<li class="chapter" data-level="2.3.7" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#line-graphs"><i class="fa fa-check"></i><b>2.3.7</b> Line graphs</a></li>
<li class="chapter" data-level="2.3.8" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#population-pyramids"><i class="fa fa-check"></i><b>2.3.8</b> Population pyramids</a></li>
<li class="chapter" data-level="2.3.9" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#lollipop-plots"><i class="fa fa-check"></i><b>2.3.9</b> Lollipop plots</a></li>
<li class="chapter" data-level="2.3.10" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#plots-with-an-image-background"><i class="fa fa-check"></i><b>2.3.10</b> Plots with an image background</a></li>
<li class="chapter" data-level="2.3.11" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#viewing-and-saving-plots"><i class="fa fa-check"></i><b>2.3.11</b> Viewing and saving plots</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#end-of-module-exercises-1"><i class="fa fa-check"></i><b>2.4</b> End of module exercises</a></li>
<li class="chapter" data-level="2.5" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#useful-resources-1"><i class="fa fa-check"></i><b>2.5</b> Useful resources</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html"><i class="fa fa-check"></i><b>3</b> Working with Spatial Data in R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#spatial-data-overview-and-types"><i class="fa fa-check"></i><b>3.1</b> Spatial data: Overview and types</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#points-data"><i class="fa fa-check"></i><b>3.1.1</b> Points data</a></li>
<li class="chapter" data-level="3.1.2" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#areal-data"><i class="fa fa-check"></i><b>3.1.2</b> Areal data</a></li>
<li class="chapter" data-level="3.1.3" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#vector-data"><i class="fa fa-check"></i><b>3.1.3</b> Vector data</a>
<ul>
<li class="chapter" data-level="3.1.3.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#points"><i class="fa fa-check"></i><b>3.1.3.1</b> Points</a></li>
<li class="chapter" data-level="3.1.3.2" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#polylines"><i class="fa fa-check"></i><b>3.1.3.2</b> Polylines</a></li>
<li class="chapter" data-level="3.1.3.3" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#polygons"><i class="fa fa-check"></i><b>3.1.3.3</b> Polygons</a></li>
</ul></li>
<li class="chapter" data-level="3.1.4" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#raster-data"><i class="fa fa-check"></i><b>3.1.4</b> Raster data</a></li>
<li class="chapter" data-level="3.1.5" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#sources-of-spatial-data"><i class="fa fa-check"></i><b>3.1.5</b> Sources of spatial data</a></li>
<li class="chapter" data-level="3.1.6" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#geospatial-covariates"><i class="fa fa-check"></i><b>3.1.6</b> Geospatial covariates</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#basic-gis-concepts"><i class="fa fa-check"></i><b>3.2</b> Basic GIS concepts</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#geoprocessing"><i class="fa fa-check"></i><b>3.2.1</b> Geoprocessing</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#using-gis-in-r"><i class="fa fa-check"></i><b>3.3</b> Using GIS in R</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#importing-spatial-data-in-r"><i class="fa fa-check"></i><b>3.3.1</b> Importing spatial data in R</a></li>
<li class="chapter" data-level="3.3.2" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#handling-spatial-data-in-r"><i class="fa fa-check"></i><b>3.3.2</b> Handling spatial data in R</a>
<ul>
<li class="chapter" data-level="3.3.2.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#converting-between-vectors-and-rasters-in-r"><i class="fa fa-check"></i><b>3.3.2.1</b> Converting between vectors and rasters in R</a></li>
<li class="chapter" data-level="3.3.2.2" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#checking-the-resolution-and-number-of-cells"><i class="fa fa-check"></i><b>3.3.2.2</b> Checking the resolution and number of cells</a></li>
<li class="chapter" data-level="3.3.2.3" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#exporting-spatial-data-in-various-formats"><i class="fa fa-check"></i><b>3.3.2.3</b> Exporting spatial data in various formats</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#visualisation-of-spatial-data"><i class="fa fa-check"></i><b>3.4</b> Visualisation of spatial data</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#static-maps"><i class="fa fa-check"></i><b>3.4.1</b> Static maps</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#interactive-maps"><i class="fa fa-check"></i><b>3.5</b> Interactive maps</a>
<ul>
<li class="chapter" data-level="" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#visualisation-with-tmap-1"><i class="fa fa-check"></i>Visualisation with <code>tmap</code></a></li>
<li class="chapter" data-level="" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#visualisation-with-leaflet"><i class="fa fa-check"></i>Visualisation with <code>leaflet</code></a></li>
<li class="chapter" data-level="" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#visualisation-with-mapview"><i class="fa fa-check"></i>Visualisation with <code>mapview</code></a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#basic-geoprocessing"><i class="fa fa-check"></i><b>3.6</b> Basic geoprocessing</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#coordinate-reference-systems-crs"><i class="fa fa-check"></i><b>3.6.1</b> Coordinate reference systems (CRS)</a></li>
<li class="chapter" data-level="3.6.2" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#converting-between-latlong-and-the-universal-transverse-mercator-utm-coordinate-system"><i class="fa fa-check"></i><b>3.6.2</b> Converting between Lat/Long and the Universal Transverse Mercator (UTM) coordinate system</a></li>
<li class="chapter" data-level="3.6.3" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#subsetting-clipping-and-masking"><i class="fa fa-check"></i><b>3.6.3</b> Subsetting, clipping and masking</a></li>
<li class="chapter" data-level="3.6.4" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#buffer-analysis"><i class="fa fa-check"></i><b>3.6.4</b> Buffer analysis</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#end-of-module-exercises-2"><i class="fa fa-check"></i><b>3.7</b> End of module exercises</a></li>
<li class="chapter" data-level="3.8" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#useful-resources-2"><i class="fa fa-check"></i><b>3.8</b> Useful resources</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html"><i class="fa fa-check"></i><b>4</b> Introduction to Statistical Modelling with Implementation in R</a>
<ul>
<li class="chapter" data-level="4.1" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#concept-of-statistical-modelling"><i class="fa fa-check"></i><b>4.1</b> Concept of statistical modelling</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#overview-of-statistical-modelling"><i class="fa fa-check"></i><b>4.1.1</b> Overview of statistical modelling</a></li>
<li class="chapter" data-level="4.1.2" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#correlation"><i class="fa fa-check"></i><b>4.1.2</b> Correlation</a></li>
<li class="chapter" data-level="4.1.3" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#scaled-covariates"><i class="fa fa-check"></i><b>4.1.3</b> Scaled covariates</a></li>
<li class="chapter" data-level="4.1.4" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#uncertainty"><i class="fa fa-check"></i><b>4.1.4</b> Uncertainty</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#simple-regression"><i class="fa fa-check"></i><b>4.2</b> Simple regression</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#linear-regression"><i class="fa fa-check"></i><b>4.2.1</b> Linear regression</a></li>
<li class="chapter" data-level="4.2.2" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#polynomial-regression"><i class="fa fa-check"></i><b>4.2.2</b> Polynomial regression</a></li>
<li class="chapter" data-level="4.2.3" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#non-linear-regression"><i class="fa fa-check"></i><b>4.2.3</b> Non-linear regression</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#multiple-regression"><i class="fa fa-check"></i><b>4.3</b> Multiple regression</a></li>
<li class="chapter" data-level="4.4" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#generalised-linear-regression"><i class="fa fa-check"></i><b>4.4</b> Generalised linear regression</a></li>
<li class="chapter" data-level="4.5" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#model-predictions"><i class="fa fa-check"></i><b>4.5</b> Model predictions</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#predictions-with-the-formula-and-coefficients"><i class="fa fa-check"></i><b>4.5.1</b> Predictions with the formula and coefficients</a></li>
<li class="chapter" data-level="4.5.2" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#predictions-with-functions"><i class="fa fa-check"></i><b>4.5.2</b> Predictions with functions</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#model-selection"><i class="fa fa-check"></i><b>4.6</b> Model selection</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#accuracy-and-precision"><i class="fa fa-check"></i><b>4.6.1</b> Accuracy and precision</a></li>
<li class="chapter" data-level="4.6.2" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#akaike-information-criterion"><i class="fa fa-check"></i><b>4.6.2</b> Akaike information criterion</a></li>
<li class="chapter" data-level="4.6.3" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#bayesian-information-criterion"><i class="fa fa-check"></i><b>4.6.3</b> Bayesian information criterion</a></li>
<li class="chapter" data-level="4.6.4" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#r-squared-statistic"><i class="fa fa-check"></i><b>4.6.4</b> R-squared statistic</a></li>
<li class="chapter" data-level="4.6.5" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#analysis-of-variance"><i class="fa fa-check"></i><b>4.6.5</b> Analysis of variance</a></li>
<li class="chapter" data-level="4.6.6" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#likelihood-ratio-testing"><i class="fa fa-check"></i><b>4.6.6</b> Likelihood ratio testing</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#stepwise-regression"><i class="fa fa-check"></i><b>4.7</b> Stepwise regression</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#forward-stepwise-regression"><i class="fa fa-check"></i><b>4.7.1</b> Forward stepwise regression</a></li>
<li class="chapter" data-level="4.7.2" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#backward-stepwise-regression"><i class="fa fa-check"></i><b>4.7.2</b> Backward stepwise regression</a></li>
<li class="chapter" data-level="4.7.3" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#both-ways-stepwise-regression"><i class="fa fa-check"></i><b>4.7.3</b> Both ways stepwise regression</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#cross-validation"><i class="fa fa-check"></i><b>4.8</b> Cross-validation</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>4.8.1</b> <em>k</em>-fold cross-validation</a></li>
<li class="chapter" data-level="4.8.2" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#leave-one-out-cross-validation"><i class="fa fa-check"></i><b>4.8.2</b> Leave-one-out cross-validation</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#hierarchical-regression"><i class="fa fa-check"></i><b>4.9</b> Hierarchical regression</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#data-structure"><i class="fa fa-check"></i><b>4.9.1</b> Data structure</a></li>
<li class="chapter" data-level="4.9.2" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#variance-partition-coefficient"><i class="fa fa-check"></i><b>4.9.2</b> Variance partition coefficient</a></li>
<li class="chapter" data-level="4.9.3" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#random-intercepts-modelling"><i class="fa fa-check"></i><b>4.9.3</b> Random intercepts modelling</a></li>
<li class="chapter" data-level="4.9.4" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#random-intercepts-mixed-effects-modelling"><i class="fa fa-check"></i><b>4.9.4</b> Random intercepts mixed-effects modelling</a></li>
<li class="chapter" data-level="4.9.5" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#random-slope-mixed-effects-modelling"><i class="fa fa-check"></i><b>4.9.5</b> Random slope mixed-effects modelling</a></li>
<li class="chapter" data-level="4.9.6" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#adding-an-extra-level"><i class="fa fa-check"></i><b>4.9.6</b> Adding an extra level</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#useful-resources-3"><i class="fa fa-check"></i><b>4.10</b> Useful resources</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html"><i class="fa fa-check"></i><b>5</b> Probability Theory and Applications</a>
<ul>
<li class="chapter" data-level="5.1" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#introduction-to-probability"><i class="fa fa-check"></i><b>5.1</b> Introduction to probability</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#theoretical-and-experimental-probability"><i class="fa fa-check"></i><b>5.1.1</b> Theoretical and experimental probability</a></li>
<li class="chapter" data-level="5.1.2" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#keywords"><i class="fa fa-check"></i><b>5.1.2</b> Keywords</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#axioms-of-probability"><i class="fa fa-check"></i><b>5.2</b> Axioms of probability</a></li>
<li class="chapter" data-level="5.3" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#joint-probability"><i class="fa fa-check"></i><b>5.3</b> Joint probability</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#joint-probability-table"><i class="fa fa-check"></i><b>5.3.1</b> Joint probability table</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#conditional-probability"><i class="fa fa-check"></i><b>5.4</b> Conditional probability</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#multiplication-rule-of-conditional-probability"><i class="fa fa-check"></i><b>5.4.1</b> Multiplication rule of conditional probability</a></li>
<li class="chapter" data-level="5.4.2" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#law-of-total-probability"><i class="fa fa-check"></i><b>5.4.2</b> Law of total probability</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#contingency-tables"><i class="fa fa-check"></i><b>5.5</b> Contingency tables</a></li>
<li class="chapter" data-level="5.6" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#useful-resources-4"><i class="fa fa-check"></i><b>5.6</b> Useful resources</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html"><i class="fa fa-check"></i><b>6</b> Bayesian Statistical Inference</a>
<ul>
<li class="chapter" data-level="6.1" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#introduction"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#bayes-theorem"><i class="fa fa-check"></i><b>6.2</b> Bayes’ theorem</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#bayes-theorem-for-random-variables"><i class="fa fa-check"></i><b>6.2.1</b> Bayes’ theorem for random variables</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#the-likelihood-function"><i class="fa fa-check"></i><b>6.3</b> The likelihood function</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#different-types-and-structures"><i class="fa fa-check"></i><b>6.3.1</b> Different types and structures</a>
<ul>
<li class="chapter" data-level="6.3.1.1" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#count-data"><i class="fa fa-check"></i><b>6.3.1.1</b> Count data</a></li>
<li class="chapter" data-level="6.3.1.2" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#binary-data"><i class="fa fa-check"></i><b>6.3.1.2</b> Binary data</a></li>
<li class="chapter" data-level="6.3.1.3" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#proportional-data"><i class="fa fa-check"></i><b>6.3.1.3</b> Proportional data</a></li>
<li class="chapter" data-level="6.3.1.4" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#continuous-data"><i class="fa fa-check"></i><b>6.3.1.4</b> Continuous data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#prior-distribution"><i class="fa fa-check"></i><b>6.4</b> Prior distribution</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#conjugate-priors"><i class="fa fa-check"></i><b>6.4.1</b> Conjugate priors</a></li>
<li class="chapter" data-level="6.4.2" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#flat-improper-and-non-informative-priors"><i class="fa fa-check"></i><b>6.4.2</b> Flat, improper and non-informative priors</a></li>
<li class="chapter" data-level="6.4.3" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#informative-prior"><i class="fa fa-check"></i><b>6.4.3</b> Informative prior</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#overview-of-posterior-inference"><i class="fa fa-check"></i><b>6.5</b> Overview of posterior inference</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#markov-chain-monte-carlo-approach"><i class="fa fa-check"></i><b>6.5.1</b> Markov Chain Monte Carlo approach</a></li>
<li class="chapter" data-level="6.5.2" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#integrated-nested-laplace-approximation-approach"><i class="fa fa-check"></i><b>6.5.2</b> Integrated Nested Laplace Approximation approach</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#elicitation-of-priors"><i class="fa fa-check"></i><b>6.6</b> Elicitation of priors</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#priors-inla"><i class="fa fa-check"></i><b>6.6.1</b> Priors INLA</a>
<ul>
<li class="chapter" data-level="6.6.1.1" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#penalised-complexity-priors"><i class="fa fa-check"></i><b>6.6.1.1</b> Penalised Complexity priors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#sampling-and-evaluating-the-posterior-density"><i class="fa fa-check"></i><b>6.7</b> Sampling and evaluating the posterior density</a></li>
<li class="chapter" data-level="6.8" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#useful-resources-5"><i class="fa fa-check"></i><b>6.8</b> Useful resources</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="introduction-to-small-area-population-estimation-and-modelling-sapem.html"><a href="introduction-to-small-area-population-estimation-and-modelling-sapem.html"><i class="fa fa-check"></i><b>7</b> Introduction to Small Area Population Estimation and Modelling (SAPEM)</a>
<ul>
<li class="chapter" data-level="7.1" data-path="introduction-to-small-area-population-estimation-and-modelling-sapem.html"><a href="introduction-to-small-area-population-estimation-and-modelling-sapem.html#small-area-population-estimation"><i class="fa fa-check"></i><b>7.1</b> Small area population estimation</a></li>
<li class="chapter" data-level="7.2" data-path="introduction-to-small-area-population-estimation-and-modelling-sapem.html"><a href="introduction-to-small-area-population-estimation-and-modelling-sapem.html#direct-estimation"><i class="fa fa-check"></i><b>7.2</b> Direct estimation</a></li>
<li class="chapter" data-level="7.3" data-path="introduction-to-small-area-population-estimation-and-modelling-sapem.html"><a href="introduction-to-small-area-population-estimation-and-modelling-sapem.html#indirect-estimation"><i class="fa fa-check"></i><b>7.3</b> Indirect estimation</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="introduction-to-small-area-population-estimation-and-modelling-sapem.html"><a href="introduction-to-small-area-population-estimation-and-modelling-sapem.html#approaches-for-creating-gridded-population-datasets"><i class="fa fa-check"></i><b>7.3.1</b> Approaches for creating gridded population datasets</a>
<ul>
<li class="chapter" data-level="7.3.1.1" data-path="introduction-to-small-area-population-estimation-and-modelling-sapem.html"><a href="introduction-to-small-area-population-estimation-and-modelling-sapem.html#top-down"><i class="fa fa-check"></i><b>7.3.1.1</b> Top-down</a></li>
<li class="chapter" data-level="7.3.1.2" data-path="introduction-to-small-area-population-estimation-and-modelling-sapem.html"><a href="introduction-to-small-area-population-estimation-and-modelling-sapem.html#bottom-up"><i class="fa fa-check"></i><b>7.3.1.2</b> Bottom-up</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="introduction-to-small-area-population-estimation-and-modelling-sapem.html"><a href="introduction-to-small-area-population-estimation-and-modelling-sapem.html#useful-resources-6"><i class="fa fa-check"></i><b>7.4</b> Useful resources</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html"><i class="fa fa-check"></i><b>8</b> Bayesian Hierarchical Population Modelling in R</a>
<ul>
<li class="chapter" data-level="8.1" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#data-sources"><i class="fa fa-check"></i><b>8.1</b> Data sources</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#population-data"><i class="fa fa-check"></i><b>8.1.1</b> Population data</a></li>
<li class="chapter" data-level="8.1.2" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#settlement-data"><i class="fa fa-check"></i><b>8.1.2</b> Settlement data</a></li>
<li class="chapter" data-level="8.1.3" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#other-sources"><i class="fa fa-check"></i><b>8.1.3</b> Other sources</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#data-cleaning-and-covariates-extraction"><i class="fa fa-check"></i><b>8.2</b> Data cleaning and covariates extraction</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#extracting-continuous-rasters"><i class="fa fa-check"></i><b>8.2.1</b> Extracting continuous rasters</a></li>
<li class="chapter" data-level="8.2.2" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#extracting-categorical-rasters"><i class="fa fa-check"></i><b>8.2.2</b> Extracting categorical rasters</a></li>
<li class="chapter" data-level="8.2.3" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#extracting-building-count"><i class="fa fa-check"></i><b>8.2.3</b> Extracting building count</a></li>
<li class="chapter" data-level="8.2.4" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#exracting-building-total-area"><i class="fa fa-check"></i><b>8.2.4</b> Exracting building total area</a></li>
<li class="chapter" data-level="8.2.5" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#adding-admin-area-names-to-the-data"><i class="fa fa-check"></i><b>8.2.5</b> Adding admin area names to the data</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#exploratory-analysis"><i class="fa fa-check"></i><b>8.3</b> Exploratory analysis</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#basic-visualisation"><i class="fa fa-check"></i><b>8.3.1</b> Basic visualisation</a></li>
<li class="chapter" data-level="8.3.2" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#geospatial-visualisation"><i class="fa fa-check"></i><b>8.3.2</b> Geospatial visualisation</a></li>
<li class="chapter" data-level="8.3.3" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#checking-for-nas"><i class="fa fa-check"></i><b>8.3.3</b> Checking for NAs</a></li>
<li class="chapter" data-level="8.3.4" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#checking-for-minimum-and-maximum-values"><i class="fa fa-check"></i><b>8.3.4</b> Checking for minimum and maximum values</a></li>
<li class="chapter" data-level="8.3.5" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#checking-the-distribution-of-categorical-variables"><i class="fa fa-check"></i><b>8.3.5</b> Checking the distribution of categorical variables</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#model-set-up"><i class="fa fa-check"></i><b>8.4</b> Model set-up</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#simple-linear-regression"><i class="fa fa-check"></i><b>8.4.1</b> Simple linear regression</a></li>
<li class="chapter" data-level="8.4.2" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#multiple-regression-1"><i class="fa fa-check"></i><b>8.4.2</b> Multiple regression</a></li>
<li class="chapter" data-level="8.4.3" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#generalised-linear-regression-1"><i class="fa fa-check"></i><b>8.4.3</b> Generalised linear regression</a></li>
<li class="chapter" data-level="8.4.4" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#fitting-fixed-effects-models-in-r-inla"><i class="fa fa-check"></i><b>8.4.4</b> Fitting fixed effects models in <code>R-INLA</code></a></li>
<li class="chapter" data-level="8.4.5" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#fitting-bayesian-hierarchical-mixed-effects-models-in-r-inla"><i class="fa fa-check"></i><b>8.4.5</b> Fitting Bayesian hierarchical mixed effects models in <code>R-INLA</code></a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#stan-mcmc-approach"><i class="fa fa-check"></i><b>8.5</b> STAN (MCMC) approach</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#metropolis-hastings-algorithm"><i class="fa fa-check"></i><b>8.5.1</b> Metropolis-Hastings algorithm</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#inla-and-inla-spde-approach"><i class="fa fa-check"></i><b>8.6</b> INLA and INLA-SPDE approach</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#mesh-construction"><i class="fa fa-check"></i><b>8.6.1</b> Mesh construction</a></li>
<li class="chapter" data-level="8.6.2" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#building-the-spde"><i class="fa fa-check"></i><b>8.6.2</b> Building the SPDE</a></li>
<li class="chapter" data-level="8.6.3" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#projection-matrix"><i class="fa fa-check"></i><b>8.6.3</b> Projection matrix</a></li>
<li class="chapter" data-level="8.6.4" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#data-location-indexing"><i class="fa fa-check"></i><b>8.6.4</b> Data location indexing</a></li>
<li class="chapter" data-level="8.6.5" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#projection-data"><i class="fa fa-check"></i><b>8.6.5</b> Projection data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html"><i class="fa fa-check"></i><b>9</b> Model Fit Checks and Cross-Validation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html#model-assumption-checking"><i class="fa fa-check"></i><b>9.1</b> Model assumption checking</a></li>
<li class="chapter" data-level="9.2" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html#model-selection-1"><i class="fa fa-check"></i><b>9.2</b> Model selection</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html#watanabe-akaike-information-criterion-waic"><i class="fa fa-check"></i><b>9.2.1</b> Watanabe-Akaike Information Criterion (WAIC)</a></li>
<li class="chapter" data-level="9.2.2" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html#deviance-information-criterion-dic"><i class="fa fa-check"></i><b>9.2.2</b> Deviance Information Criterion (DIC)</a></li>
<li class="chapter" data-level="9.2.3" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html#conditional-predictive-ordinate-cpo"><i class="fa fa-check"></i><b>9.2.3</b> Conditional predictive ordinate (CPO)</a></li>
<li class="chapter" data-level="9.2.4" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html#probability-integral-transform-pit"><i class="fa fa-check"></i><b>9.2.4</b> Probability Integral Transform (PIT)</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html#cross-validation-1"><i class="fa fa-check"></i><b>9.3</b> Cross-validation</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html#basic-cross-validation"><i class="fa fa-check"></i><b>9.3.1</b> Basic cross-validation</a></li>
<li class="chapter" data-level="9.3.2" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html#k-fold-cross-validation-1"><i class="fa fa-check"></i><b>9.3.2</b> K-Fold Cross-Validation</a></li>
<li class="chapter" data-level="9.3.3" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html#useful-resources-7"><i class="fa fa-check"></i><b>9.3.3</b> Useful resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html"><i class="fa fa-check"></i><b>10</b> Population Prediction and Uncertainty Quantification</a>
<ul>
<li class="chapter" data-level="10.1" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html#covariate-stacking"><i class="fa fa-check"></i><b>10.1</b> Covariate stacking</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html#admin-names"><i class="fa fa-check"></i><b>10.1.1</b> Admin names</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html#grid-cellpixel-level-prediction"><i class="fa fa-check"></i><b>10.2</b> Grid cell/pixel level prediction</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html#pre-processing"><i class="fa fa-check"></i><b>10.2.1</b> Pre-processing</a></li>
<li class="chapter" data-level="10.2.2" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html#inla-spde-approach"><i class="fa fa-check"></i><b>10.2.2</b> INLA-SPDE approach</a>
<ul>
<li class="chapter" data-level="10.2.2.1" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html#predictions"><i class="fa fa-check"></i><b>10.2.2.1</b> Predictions</a></li>
</ul></li>
<li class="chapter" data-level="10.2.3" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html#posterior-distribution-simulation"><i class="fa fa-check"></i><b>10.2.3</b> Posterior distribution simulation</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html#aggregation-to-area-units-of-interest-and-uncertainty-quantification"><i class="fa fa-check"></i><b>10.3</b> Aggregation to area units of interest and uncertainty quantification</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html#rasterising-the-predictions-at-grid-cell-level"><i class="fa fa-check"></i><b>10.3.1</b> Rasterising the predictions at grid cell level</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html#useful-resources-8"><i class="fa fa-check"></i><b>10.4</b> Useful resources</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="age-sex-disaggregation.html"><a href="age-sex-disaggregation.html"><i class="fa fa-check"></i><b>11</b> Age-Sex Disaggregation</a>
<ul>
<li class="chapter" data-level="11.1" data-path="age-sex-disaggregation.html"><a href="age-sex-disaggregation.html#disaggregation-of-population-totals-by-age-sex-proportions"><i class="fa fa-check"></i><b>11.1</b> Disaggregation of population totals by age-sex proportions</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="age-sex-disaggregation.html"><a href="age-sex-disaggregation.html#unavailable-age-sex-data"><i class="fa fa-check"></i><b>11.1.1</b> Unavailable age-sex data</a></li>
<li class="chapter" data-level="11.1.2" data-path="age-sex-disaggregation.html"><a href="age-sex-disaggregation.html#available-age-sex-data"><i class="fa fa-check"></i><b>11.1.2</b> Available age-sex data</a>
<ul>
<li class="chapter" data-level="11.1.2.1" data-path="age-sex-disaggregation.html"><a href="age-sex-disaggregation.html#age-sex-disaggregation-1"><i class="fa fa-check"></i><b>11.1.2.1</b> Age-sex disaggregation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="age-sex-disaggregation.html"><a href="age-sex-disaggregation.html#useful-resources-9"><i class="fa fa-check"></i><b>11.2</b> Useful resources</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html"><i class="fa fa-check"></i><b>12</b> Exercise Solutions by Module</a>
<ul>
<li class="chapter" data-level="12.1" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#module-1"><i class="fa fa-check"></i><b>12.1</b> Module 1</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#general-exercises"><i class="fa fa-check"></i><b>12.1.1</b> General exercises</a></li>
<li class="chapter" data-level="12.1.2" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#end-of-module-exercises-3"><i class="fa fa-check"></i><b>12.1.2</b> End of module exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#module-2"><i class="fa fa-check"></i><b>12.2</b> Module 2</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#general-exercises-1"><i class="fa fa-check"></i><b>12.2.1</b> General exercises</a></li>
<li class="chapter" data-level="12.2.2" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#end-of-module-exercises-4"><i class="fa fa-check"></i><b>12.2.2</b> End of module exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#module-3"><i class="fa fa-check"></i><b>12.3</b> Module 3</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#general-exercises-2"><i class="fa fa-check"></i><b>12.3.1</b> General exercises</a></li>
<li class="chapter" data-level="12.3.2" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#end-of-module-exercises-5"><i class="fa fa-check"></i><b>12.3.2</b> End of module exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#module-4"><i class="fa fa-check"></i><b>12.4</b> Module 4</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#general-exercises-3"><i class="fa fa-check"></i><b>12.4.1</b> General exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#module-5"><i class="fa fa-check"></i><b>12.5</b> Module 5</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#general-exercises-4"><i class="fa fa-check"></i><b>12.5.1</b> General exercises</a></li>
<li class="chapter" data-level="12.5.2" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#general-exercises-5"><i class="fa fa-check"></i><b>12.5.2</b> General exercises</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">WorldPop Population Modelling Training Manual, Vol. I</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="population-prediction-and-uncertainty-quantification" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">10</span> Population Prediction and Uncertainty Quantification<a href="population-prediction-and-uncertainty-quantification.html#population-prediction-and-uncertainty-quantification" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This module looks at population prediction methods and associated uncertainty quantification methodology, starting with covariate stacking. Module 10 also covers posterior distribution simulation, aggregation to area units of interest and grid cell/level prediction.</p>
<div class="sourceCode" id="cb809"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb809-1"><a href="population-prediction-and-uncertainty-quantification.html#cb809-1" tabindex="-1"></a><span class="co">#install raster processing packages</span></span>
<span id="cb809-2"><a href="population-prediction-and-uncertainty-quantification.html#cb809-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;terra&quot;</span>)</span>
<span id="cb809-3"><a href="population-prediction-and-uncertainty-quantification.html#cb809-3" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tictoc&quot;</span>)</span>
<span id="cb809-4"><a href="population-prediction-and-uncertainty-quantification.html#cb809-4" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;exactextractr&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb810"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb810-1"><a href="population-prediction-and-uncertainty-quantification.html#cb810-1" tabindex="-1"></a><span class="co">#load raster processing packages</span></span>
<span id="cb810-2"><a href="population-prediction-and-uncertainty-quantification.html#cb810-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb810-3"><a href="population-prediction-and-uncertainty-quantification.html#cb810-3" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb810-4"><a href="population-prediction-and-uncertainty-quantification.html#cb810-4" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;tictoc&quot;</span>)</span>
<span id="cb810-5"><a href="population-prediction-and-uncertainty-quantification.html#cb810-5" tabindex="-1"></a><span class="fu">library</span>(feather)</span>
<span id="cb810-6"><a href="population-prediction-and-uncertainty-quantification.html#cb810-6" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code></pre></div>
<div id="covariate-stacking" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Covariate stacking<a href="population-prediction-and-uncertainty-quantification.html#covariate-stacking" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In order to predict population values across the entire population across the entire country, the covariates available require stacking and the corresponding values of the covariates extracting. However, given that across a country, the entire area is not inhabited, only those points which are settled (inhabited) are of interest, so the covariate information extracted requires some manipulation to obtain only the settled raster values. This section explores these methods for the Cameroon dataset.</p>
<p>Firstly, the rasters available that are going to be stacked need to be imported into the R environment.</p>
<div class="sourceCode" id="cb811"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb811-1"><a href="population-prediction-and-uncertainty-quantification.html#cb811-1" tabindex="-1"></a><span class="co">#import all rasters</span></span>
<span id="cb811-2"><a href="population-prediction-and-uncertainty-quantification.html#cb811-2" tabindex="-1"></a>raster_list <span class="ot">&lt;-</span><span class="fu">list.files</span>(<span class="at">path =</span> raster_path4, <span class="at">pattern =</span> <span class="st">&quot;.tif$&quot;</span>, </span>
<span id="cb811-3"><a href="population-prediction-and-uncertainty-quantification.html#cb811-3" tabindex="-1"></a>                         <span class="at">all.files =</span> <span class="cn">TRUE</span>, <span class="at">full.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb811-4"><a href="population-prediction-and-uncertainty-quantification.html#cb811-4" tabindex="-1"></a></span>
<span id="cb811-5"><a href="population-prediction-and-uncertainty-quantification.html#cb811-5" tabindex="-1"></a><span class="co">#see the rasters in the list</span></span>
<span id="cb811-6"><a href="population-prediction-and-uncertainty-quantification.html#cb811-6" tabindex="-1"></a>raster_list</span></code></pre></div>
<pre><code>##  [1] &quot;acled_conflict_data_2021_CMR_ed_masked.tif&quot; &quot;CMR_buildings_count.tif&quot;                   
##  [3] &quot;CMR_buildings_total_area.tif&quot;               &quot;CMR_Department.tif&quot;                        
##  [5] &quot;CMR_dst_in_water_100m_2000_2012.tif&quot;        &quot;CMR_esaccilc_dst140_100m_2015.tif&quot;         
##  [7] &quot;CMR_esaccilc_dst200_100m_2015.tif&quot;          &quot;CMR_osm_dst_localroads.tif&quot;                
##  [9] &quot;CMR_osm_dst_railways.tif&quot;                   &quot;CMR_Regions.tif&quot;                           
## [11] &quot;CMR_Settlement_Classification.tif&quot;          &quot;CMR_viirs_100m_2020.tif&quot;</code></pre>
<p>There are two approaches to stacking the covariates in R available. The first is to stack all the covariates together at once and then get the relevant raster values with the <code>values()</code> function from the <code>terra</code> package, including the covariate stack as an argument and specifying <code>dataframe = TRUE</code> to return the values as a data frame. This option however, is not always appropriate as extracting the values at once can take a long time and particularly in cases where there are more than a few covariates available, the code can be too much for many computers to handle.</p>
<div class="sourceCode" id="cb813"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb813-1"><a href="population-prediction-and-uncertainty-quantification.html#cb813-1" tabindex="-1"></a><span class="co">#stack all rasters</span></span>
<span id="cb813-2"><a href="population-prediction-and-uncertainty-quantification.html#cb813-2" tabindex="-1"></a>stack_covariates <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">paste0</span>(raster_path4, <span class="fu">c</span>(raster_list)))</span>
<span id="cb813-3"><a href="population-prediction-and-uncertainty-quantification.html#cb813-3" tabindex="-1"></a></span>
<span id="cb813-4"><a href="population-prediction-and-uncertainty-quantification.html#cb813-4" tabindex="-1"></a><span class="co">#get raster values</span></span>
<span id="cb813-5"><a href="population-prediction-and-uncertainty-quantification.html#cb813-5" tabindex="-1"></a>covs_raster_values <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">values</span>(stack_covariates, <span class="at">dataframe =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Alternatively, the covariates can be stacked in batches, which is the preferred method of covariate stacking as it does not have as high of a computational burden associated. To use this approach, first the desired size of the batches must be specified, in this case, the size is 2. Then, to cycle through each of the covariates available, a <code>for()</code> loop can be used to make the process more automated and hence more efficient.</p>
<div class="sourceCode" id="cb814"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb814-1"><a href="population-prediction-and-uncertainty-quantification.html#cb814-1" tabindex="-1"></a><span class="co">#define batch size</span></span>
<span id="cb814-2"><a href="population-prediction-and-uncertainty-quantification.html#cb814-2" tabindex="-1"></a>batch_size <span class="ot">&lt;-</span> <span class="dv">2</span></span></code></pre></div>
<p>However, before starting the loop, to write only the settled pixels (covariate values which are associated with a pixel where there is a building present) to file, the raster file for the building count can first be processed, with the building count values obtained with the <code>values()</code> function. Once the values are obtained, this covariate should be removed from the raster list to not repeat the processing in the loop.</p>
<div class="sourceCode" id="cb815"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb815-1"><a href="population-prediction-and-uncertainty-quantification.html#cb815-1" tabindex="-1"></a><span class="co">#read building count raster and get values</span></span>
<span id="cb815-2"><a href="population-prediction-and-uncertainty-quantification.html#cb815-2" tabindex="-1"></a>b_count <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">paste0</span>(raster_path4, <span class="st">&quot;CMR_buildings_count.tif&quot;</span>))</span>
<span id="cb815-3"><a href="population-prediction-and-uncertainty-quantification.html#cb815-3" tabindex="-1"></a>b_count <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">values</span>(b_count, <span class="at">dataframe =</span> <span class="cn">TRUE</span>)</span>
<span id="cb815-4"><a href="population-prediction-and-uncertainty-quantification.html#cb815-4" tabindex="-1"></a></span>
<span id="cb815-5"><a href="population-prediction-and-uncertainty-quantification.html#cb815-5" tabindex="-1"></a><span class="co">#remove &quot;CMR_buildings_count.tif&quot; from list</span></span>
<span id="cb815-6"><a href="population-prediction-and-uncertainty-quantification.html#cb815-6" tabindex="-1"></a>process_rasters_list <span class="ot">&lt;-</span> raster_list[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">2</span>)]</span>
<span id="cb815-7"><a href="population-prediction-and-uncertainty-quantification.html#cb815-7" tabindex="-1"></a>process_rasters_list</span></code></pre></div>
<pre><code>##  [1] &quot;acled_conflict_data_2021_CMR_ed_masked.tif&quot; &quot;CMR_buildings_total_area.tif&quot;              
##  [3] &quot;CMR_Department.tif&quot;                         &quot;CMR_dst_in_water_100m_2000_2012.tif&quot;       
##  [5] &quot;CMR_esaccilc_dst140_100m_2015.tif&quot;          &quot;CMR_esaccilc_dst200_100m_2015.tif&quot;         
##  [7] &quot;CMR_osm_dst_localroads.tif&quot;                 &quot;CMR_osm_dst_railways.tif&quot;                  
##  [9] &quot;CMR_Regions.tif&quot;                            &quot;CMR_Settlement_Classification.tif&quot;         
## [11] &quot;CMR_viirs_100m_2020.tif&quot;</code></pre>
<p>The first step in the loop is to subset the available rasters to select your ‘batch’. Once you have the subset, the <code>rast()</code> function can be used to load that batch of covariates. As with the first approach, to obtain the raster values, the <code>values()</code> function is used. Since only the settled points are wanting to be written to file, the <code>filter()</code> and <code>select()</code> functions can be used to subset the covariate values and keep only those which correspond to settled points, using the building count raster and corresponding values as a reference. The final results can then be exported as a <code>.feather</code> file with the <code>write_feather()</code> function from the <code>feather</code> package. Whilst it it is not a necessity, the <code>rm()</code> function can be used to free up memory for the raster batches and their values created within the loop to help R work more efficiently.</p>
<div class="sourceCode" id="cb817"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb817-1"><a href="population-prediction-and-uncertainty-quantification.html#cb817-1" tabindex="-1"></a><span class="co">#loop through covariates in batches</span></span>
<span id="cb817-2"><a href="population-prediction-and-uncertainty-quantification.html#cb817-2" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">length</span>(process_rasters_list), batch_size)) {</span>
<span id="cb817-3"><a href="population-prediction-and-uncertainty-quantification.html#cb817-3" tabindex="-1"></a>  batch_covs <span class="ot">&lt;-</span> process_rasters_list[i<span class="sc">:</span><span class="fu">min</span>(i <span class="sc">+</span> batch_size <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb817-4"><a href="population-prediction-and-uncertainty-quantification.html#cb817-4" tabindex="-1"></a>                                           <span class="fu">length</span>(process_rasters_list))]</span>
<span id="cb817-5"><a href="population-prediction-and-uncertainty-quantification.html#cb817-5" tabindex="-1"></a>  </span>
<span id="cb817-6"><a href="population-prediction-and-uncertainty-quantification.html#cb817-6" tabindex="-1"></a>  <span class="co">#load batch of covariates rasters</span></span>
<span id="cb817-7"><a href="population-prediction-and-uncertainty-quantification.html#cb817-7" tabindex="-1"></a>  covs_raster <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">paste0</span>(raster_path4, batch_covs))</span>
<span id="cb817-8"><a href="population-prediction-and-uncertainty-quantification.html#cb817-8" tabindex="-1"></a>  </span>
<span id="cb817-9"><a href="population-prediction-and-uncertainty-quantification.html#cb817-9" tabindex="-1"></a>  <span class="co">#get raster values</span></span>
<span id="cb817-10"><a href="population-prediction-and-uncertainty-quantification.html#cb817-10" tabindex="-1"></a>  covs_raster_values <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">values</span>(covs_raster, <span class="at">dataframe =</span> <span class="cn">TRUE</span>)</span>
<span id="cb817-11"><a href="population-prediction-and-uncertainty-quantification.html#cb817-11" tabindex="-1"></a>  </span>
<span id="cb817-12"><a href="population-prediction-and-uncertainty-quantification.html#cb817-12" tabindex="-1"></a>  <span class="co">#write only settled pixels to file</span></span>
<span id="cb817-13"><a href="population-prediction-and-uncertainty-quantification.html#cb817-13" tabindex="-1"></a>  covs_raster_values <span class="ot">&lt;-</span> covs_raster_values <span class="sc">%&gt;%</span> </span>
<span id="cb817-14"><a href="population-prediction-and-uncertainty-quantification.html#cb817-14" tabindex="-1"></a>    <span class="fu">cbind</span>(b_count) <span class="sc">%&gt;%</span> </span>
<span id="cb817-15"><a href="population-prediction-and-uncertainty-quantification.html#cb817-15" tabindex="-1"></a>    <span class="fu">filter</span>(CMR_buildings_count <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb817-16"><a href="population-prediction-and-uncertainty-quantification.html#cb817-16" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>CMR_buildings_count)</span>
<span id="cb817-17"><a href="population-prediction-and-uncertainty-quantification.html#cb817-17" tabindex="-1"></a>  </span>
<span id="cb817-18"><a href="population-prediction-and-uncertainty-quantification.html#cb817-18" tabindex="-1"></a>  <span class="co">#write processed covariate values to a feather file</span></span>
<span id="cb817-19"><a href="population-prediction-and-uncertainty-quantification.html#cb817-19" tabindex="-1"></a>  feather_output_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(output_path, <span class="st">&quot;Processed_Covariates_&quot;</span>, i, <span class="st">&quot;_to_&quot;</span>,</span>
<span id="cb817-20"><a href="population-prediction-and-uncertainty-quantification.html#cb817-20" tabindex="-1"></a>                                <span class="fu">min</span>(i <span class="sc">+</span> batch_size <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb817-21"><a href="population-prediction-and-uncertainty-quantification.html#cb817-21" tabindex="-1"></a>                                    <span class="fu">length</span>(process_rasters_list)), <span class="st">&quot;.feather&quot;</span>)</span>
<span id="cb817-22"><a href="population-prediction-and-uncertainty-quantification.html#cb817-22" tabindex="-1"></a>  feather<span class="sc">::</span><span class="fu">write_feather</span>(covs_raster_values, feather_output_path)</span>
<span id="cb817-23"><a href="population-prediction-and-uncertainty-quantification.html#cb817-23" tabindex="-1"></a>  </span>
<span id="cb817-24"><a href="population-prediction-and-uncertainty-quantification.html#cb817-24" tabindex="-1"></a>  <span class="co">#free up memory</span></span>
<span id="cb817-25"><a href="population-prediction-and-uncertainty-quantification.html#cb817-25" tabindex="-1"></a>  <span class="fu">rm</span>(covs_raster, covs_raster_values); <span class="fu">gc</span>()</span>
<span id="cb817-26"><a href="population-prediction-and-uncertainty-quantification.html#cb817-26" tabindex="-1"></a>}</span></code></pre></div>
<p>Once the raster values have been obtained, the files can be read back to the memory with the <code>dir()</code> function and then bound together.</p>
<div class="sourceCode" id="cb818"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb818-1"><a href="population-prediction-and-uncertainty-quantification.html#cb818-1" tabindex="-1"></a><span class="co">#read all files back to memory</span></span>
<span id="cb818-2"><a href="population-prediction-and-uncertainty-quantification.html#cb818-2" tabindex="-1"></a>myfiles <span class="ot">&lt;-</span><span class="fu">dir</span>(output_path,<span class="at">pattern =</span> <span class="st">&quot;*.feather&quot;</span>)</span>
<span id="cb818-3"><a href="population-prediction-and-uncertainty-quantification.html#cb818-3" tabindex="-1"></a>myfiles</span></code></pre></div>
<pre><code>## [1] &quot;Processed_Covariates_1_to_2.feather&quot;   &quot;Processed_Covariates_11_to_11.feather&quot;
## [3] &quot;Processed_Covariates_3_to_4.feather&quot;   &quot;Processed_Covariates_5_to_6.feather&quot;  
## [5] &quot;Processed_Covariates_7_to_8.feather&quot;   &quot;Processed_Covariates_9_to_10.feather&quot;</code></pre>
<div class="sourceCode" id="cb820"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb820-1"><a href="population-prediction-and-uncertainty-quantification.html#cb820-1" tabindex="-1"></a><span class="co">#bind the files</span></span>
<span id="cb820-2"><a href="population-prediction-and-uncertainty-quantification.html#cb820-2" tabindex="-1"></a>raster_values <span class="ot">&lt;-</span> myfiles <span class="sc">%&gt;%</span> </span>
<span id="cb820-3"><a href="population-prediction-and-uncertainty-quantification.html#cb820-3" tabindex="-1"></a>  <span class="fu">map</span>(<span class="cf">function</span>(x) <span class="fu">read_feather</span>(<span class="fu">file.path</span>(output_path, x))) <span class="sc">%&gt;%</span> </span>
<span id="cb820-4"><a href="population-prediction-and-uncertainty-quantification.html#cb820-4" tabindex="-1"></a>  <span class="fu">reduce</span>(cbind) </span></code></pre></div>
<p>From the modelling in Module 8, it was found that for the Cameroon data, the covariates <code>x2, x16, x20, x24, x31, x36, x40</code> were all statistically significant and had a notable relationship with the population density. Therefore, these are the covariates that are of interest for prediction. However, the names of <code>x(.)</code> are arbitrary, so the significant variables should be renamed for ease of understanding and aid in the interpretation of any results. The names of the variables can be obtained from the <code>var_names.csv</code> and manually input as below.</p>
<div class="sourceCode" id="cb821"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb821-1"><a href="population-prediction-and-uncertainty-quantification.html#cb821-1" tabindex="-1"></a><span class="co">#load the variable names file</span></span>
<span id="cb821-2"><a href="population-prediction-and-uncertainty-quantification.html#cb821-2" tabindex="-1"></a>var_names <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(data_path,<span class="st">&quot;var_names.csv&quot;</span>)) </span>
<span id="cb821-3"><a href="population-prediction-and-uncertainty-quantification.html#cb821-3" tabindex="-1"></a>var_names[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">24</span>, <span class="dv">31</span>, <span class="dv">36</span>, <span class="dv">40</span>),]</span></code></pre></div>
<pre><code>##     X                                   var_names var_names2
## 2   2 mean.acled_conflict_data_2021_CMR_ed_masked         x2
## 16 16        mean.CMR_dst_in_water_100m_2000_2012        x16
## 20 20          mean.CMR_esaccilc_dst140_100m_2015        x20
## 24 24          mean.CMR_esaccilc_dst200_100m_2015        x24
## 31 31                 mean.CMR_osm_dst_localroads        x31
## 36 36                   mean.CMR_osm_dst_railways        x36
## 40 40                    mean.CMR_viirs_100m_2020        x40</code></pre>
<div class="sourceCode" id="cb823"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb823-1"><a href="population-prediction-and-uncertainty-quantification.html#cb823-1" tabindex="-1"></a><span class="co">#rename variables</span></span>
<span id="cb823-2"><a href="population-prediction-and-uncertainty-quantification.html#cb823-2" tabindex="-1"></a>raster_values1 <span class="ot">&lt;-</span> raster_values <span class="sc">%&gt;%</span></span>
<span id="cb823-3"><a href="population-prediction-and-uncertainty-quantification.html#cb823-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x2 =</span> acled_conflict_data_2021_CMR_ed_masked,</span>
<span id="cb823-4"><a href="population-prediction-and-uncertainty-quantification.html#cb823-4" tabindex="-1"></a>         <span class="at">x16 =</span> CMR_dst_in_water_100m_2000_2012,</span>
<span id="cb823-5"><a href="population-prediction-and-uncertainty-quantification.html#cb823-5" tabindex="-1"></a>         <span class="at">x20 =</span> CMR_esaccilc_dst140_100m_2015,</span>
<span id="cb823-6"><a href="population-prediction-and-uncertainty-quantification.html#cb823-6" tabindex="-1"></a>         <span class="at">x24 =</span> CMR_esaccilc_dst200_100m_2015,</span>
<span id="cb823-7"><a href="population-prediction-and-uncertainty-quantification.html#cb823-7" tabindex="-1"></a>         <span class="at">x31 =</span> CMR_osm_dst_localroads, </span>
<span id="cb823-8"><a href="population-prediction-and-uncertainty-quantification.html#cb823-8" tabindex="-1"></a>         <span class="at">x36 =</span> CMR_osm_dst_railways,</span>
<span id="cb823-9"><a href="population-prediction-and-uncertainty-quantification.html#cb823-9" tabindex="-1"></a>         <span class="at">x40 =</span> CMR_viirs_100m_2020)</span></code></pre></div>
<p>To estimate the population for the settled points, the x,y-coordinates of the centroids of each settled pixel needs to be obtained from the building count dataset. To obtain these coordinates, the raster with the building counts must be read into the environment and then used with the function <code>xyFromCell()</code> with arguments for the building count raster and a sequence from 1 to the number of cells in the raster.</p>
<div class="sourceCode" id="cb824"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb824-1"><a href="population-prediction-and-uncertainty-quantification.html#cb824-1" tabindex="-1"></a><span class="co">#read raster</span></span>
<span id="cb824-2"><a href="population-prediction-and-uncertainty-quantification.html#cb824-2" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">paste0</span>(raster_path4, <span class="st">&quot;CMR_buildings_count.tif&quot;</span>))</span>
<span id="cb824-3"><a href="population-prediction-and-uncertainty-quantification.html#cb824-3" tabindex="-1"></a></span>
<span id="cb824-4"><a href="population-prediction-and-uncertainty-quantification.html#cb824-4" tabindex="-1"></a><span class="co">#get the xy coordinate of the centroid of each pixel as a data frame</span></span>
<span id="cb824-5"><a href="population-prediction-and-uncertainty-quantification.html#cb824-5" tabindex="-1"></a>coord <span class="ot">&lt;-</span> <span class="fu">xyFromCell</span>(r1, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncell</span>(r1))</span>
<span id="cb824-6"><a href="population-prediction-and-uncertainty-quantification.html#cb824-6" tabindex="-1"></a><span class="fu">head</span>(coord)</span></code></pre></div>
<pre><code>##             x       y
## [1,] 8.498333 13.0775
## [2,] 8.499167 13.0775
## [3,] 8.500000 13.0775
## [4,] 8.500833 13.0775
## [5,] 8.501667 13.0775
## [6,] 8.502500 13.0775</code></pre>
<p>The coordinates can then be combined using the <code>cbind()</code> function with the building count values obtained above, before removing the unwanted objects (the values created above for <code>r1</code>, <code>coord</code> and <code>b_count</code>) from the R environment as they take up a lot of memory, making the processes less efficient.</p>
<div class="sourceCode" id="cb826"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb826-1"><a href="population-prediction-and-uncertainty-quantification.html#cb826-1" tabindex="-1"></a><span class="co">#cbind building count to coordinates</span></span>
<span id="cb826-2"><a href="population-prediction-and-uncertainty-quantification.html#cb826-2" tabindex="-1"></a>stack_coord <span class="ot">&lt;-</span> <span class="fu">cbind</span>(b_count, coord)</span>
<span id="cb826-3"><a href="population-prediction-and-uncertainty-quantification.html#cb826-3" tabindex="-1"></a></span>
<span id="cb826-4"><a href="population-prediction-and-uncertainty-quantification.html#cb826-4" tabindex="-1"></a><span class="co">#remove unwanted object from memory</span></span>
<span id="cb826-5"><a href="population-prediction-and-uncertainty-quantification.html#cb826-5" tabindex="-1"></a><span class="fu">rm</span>(r1, coord, b_count); <span class="fu">gc</span>()</span></code></pre></div>
<pre><code>##             used   (Mb) gc trigger    (Mb)   max used    (Mb)
## Ncells   8487207  453.3   22837581  1219.7   22837581  1219.7
## Vcells 690256478 5266.3 1408294652 10744.5 2195989792 16754.1</code></pre>
<p>Once the coordinates and corresponding building counts are combined, the <code>filter()</code> function can be used to filter out the desired (settled), so only the pixels containing buildings remain.</p>
<div class="sourceCode" id="cb828"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb828-1"><a href="population-prediction-and-uncertainty-quantification.html#cb828-1" tabindex="-1"></a><span class="co">#filter out only settled pixels</span></span>
<span id="cb828-2"><a href="population-prediction-and-uncertainty-quantification.html#cb828-2" tabindex="-1"></a>stack_coord <span class="ot">&lt;-</span> stack_coord <span class="sc">%&gt;%</span> </span>
<span id="cb828-3"><a href="population-prediction-and-uncertainty-quantification.html#cb828-3" tabindex="-1"></a>  <span class="fu">filter</span>(CMR_buildings_count <span class="sc">&gt;</span> <span class="dv">0</span>) </span></code></pre></div>
<p>To predict the population (either using only the intercept or also using covariates) the stack of building count values and corresponding coordinates need to be added to the original dataset, in this case done with the <code>cbind()</code> function.</p>
<div class="sourceCode" id="cb829"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb829-1"><a href="population-prediction-and-uncertainty-quantification.html#cb829-1" tabindex="-1"></a><span class="co">#cbind coordinates to original data</span></span>
<span id="cb829-2"><a href="population-prediction-and-uncertainty-quantification.html#cb829-2" tabindex="-1"></a>raster_values1 <span class="ot">&lt;-</span> raster_values1 <span class="sc">%&gt;%</span> </span>
<span id="cb829-3"><a href="population-prediction-and-uncertainty-quantification.html#cb829-3" tabindex="-1"></a>  <span class="fu">cbind</span>(stack_coord)</span></code></pre></div>
<div id="admin-names" class="section level3 hasAnchor" number="10.1.1">
<h3><span class="header-section-number">10.1.1</span> Admin names<a href="population-prediction-and-uncertainty-quantification.html#admin-names" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It is often of interest to identify the population size in different areas of a country, such as in a specific region or department, rather than as the country as a whole. For ease of interpreting the results, it is beneficial to obtain the admin names and add them to the dataset.</p>
<p>To add these admin names to the dataset, first the shapefiles containing the relevant information needs to be read into the R environment.</p>
<div class="sourceCode" id="cb830"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb830-1"><a href="population-prediction-and-uncertainty-quantification.html#cb830-1" tabindex="-1"></a><span class="co">#read in the regions and department datasets</span></span>
<span id="cb830-2"><a href="population-prediction-and-uncertainty-quantification.html#cb830-2" tabindex="-1"></a>regions <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">paste0</span>(shapefile_path, <span class="st">&quot;Region_SHP.shp&quot;</span>))</span></code></pre></div>
<pre><code>## Reading layer `Region_SHP&#39; from data source 
##   `F:\Study\WorldPop Training Materials\GitBook\wp_training_manual\data\CMR\Shapefiles\Region_SHP.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 10 features and 2 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 945997.2 ymin: 182845.8 xmax: 1802307 ymax: 1458913
## Projected CRS: WGS 84 / World Mercator</code></pre>
<div class="sourceCode" id="cb832"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb832-1"><a href="population-prediction-and-uncertainty-quantification.html#cb832-1" tabindex="-1"></a>dept <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">paste0</span>(shapefile_path, <span class="st">&quot;Departement_SHP.shp&quot;</span>))</span></code></pre></div>
<pre><code>## Reading layer `Departement_SHP&#39; from data source 
##   `F:\Study\WorldPop Training Materials\GitBook\wp_training_manual\data\CMR\Shapefiles\Departement_SHP.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 58 features and 3 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 945997.2 ymin: 182845.8 xmax: 1802307 ymax: 1458913
## Projected CRS: WGS 84 / World Mercator</code></pre>
<p>The shapefiles containing the admin names need to be converted to a data frame to obtain the ID and region label (denoted in French as <em>libelle</em> for the Cameroon dataset).</p>
<div class="sourceCode" id="cb834"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb834-1"><a href="population-prediction-and-uncertainty-quantification.html#cb834-1" tabindex="-1"></a><span class="co">#convert region shapefile to data frame and get id and &#39;libelle&#39;</span></span>
<span id="cb834-2"><a href="population-prediction-and-uncertainty-quantification.html#cb834-2" tabindex="-1"></a>regions <span class="ot">&lt;-</span> regions <span class="sc">%&gt;%</span> </span>
<span id="cb834-3"><a href="population-prediction-and-uncertainty-quantification.html#cb834-3" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb834-4"><a href="population-prediction-and-uncertainty-quantification.html#cb834-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id, libelle) <span class="sc">%&gt;%</span> </span>
<span id="cb834-5"><a href="population-prediction-and-uncertainty-quantification.html#cb834-5" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Regions =</span> id, <span class="at">Regions_libelle =</span> libelle)   <span class="co">#rename id as regions</span></span>
<span id="cb834-6"><a href="population-prediction-and-uncertainty-quantification.html#cb834-6" tabindex="-1"></a></span>
<span id="cb834-7"><a href="population-prediction-and-uncertainty-quantification.html#cb834-7" tabindex="-1"></a><span class="co">#convert department shapefile to data frame and get id and &#39;libelle&#39;</span></span>
<span id="cb834-8"><a href="population-prediction-and-uncertainty-quantification.html#cb834-8" tabindex="-1"></a>dept <span class="ot">&lt;-</span> dept <span class="sc">%&gt;%</span> </span>
<span id="cb834-9"><a href="population-prediction-and-uncertainty-quantification.html#cb834-9" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb834-10"><a href="population-prediction-and-uncertainty-quantification.html#cb834-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id, libelle) <span class="sc">%&gt;%</span> </span>
<span id="cb834-11"><a href="population-prediction-and-uncertainty-quantification.html#cb834-11" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Department =</span> id, <span class="at">Department_libelle =</span> libelle) <span class="co">#rename variables</span></span></code></pre></div>
<p>The data frames for region and department can then be joined with the dataset using the function <code>full_join()</code>.</p>
<div class="sourceCode" id="cb835"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb835-1"><a href="population-prediction-and-uncertainty-quantification.html#cb835-1" tabindex="-1"></a><span class="co">#join regions to data</span></span>
<span id="cb835-2"><a href="population-prediction-and-uncertainty-quantification.html#cb835-2" tabindex="-1"></a>prediction_covs <span class="ot">&lt;-</span> <span class="fu">full_join</span>(raster_values1, regions, <span class="at">by =</span> <span class="st">&quot;Regions&quot;</span>)</span>
<span id="cb835-3"><a href="population-prediction-and-uncertainty-quantification.html#cb835-3" tabindex="-1"></a></span>
<span id="cb835-4"><a href="population-prediction-and-uncertainty-quantification.html#cb835-4" tabindex="-1"></a><span class="co">#join department to data</span></span>
<span id="cb835-5"><a href="population-prediction-and-uncertainty-quantification.html#cb835-5" tabindex="-1"></a>prediction_covs <span class="ot">&lt;-</span> <span class="fu">full_join</span>(prediction_covs, dept, <span class="at">by =</span> <span class="st">&quot;Department&quot;</span>)</span></code></pre></div>
<p>The <code>select()</code> function can then be used to sort the data in order as follows.</p>
<div class="sourceCode" id="cb836"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb836-1"><a href="population-prediction-and-uncertainty-quantification.html#cb836-1" tabindex="-1"></a><span class="co">#sort data in order</span></span>
<span id="cb836-2"><a href="population-prediction-and-uncertainty-quantification.html#cb836-2" tabindex="-1"></a>prediction_covs <span class="ot">&lt;-</span> prediction_covs <span class="sc">%&gt;%</span> </span>
<span id="cb836-3"><a href="population-prediction-and-uncertainty-quantification.html#cb836-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Regions, Regions_libelle, Department, Department_libelle, </span>
<span id="cb836-4"><a href="population-prediction-and-uncertainty-quantification.html#cb836-4" tabindex="-1"></a>         CMR_buildings_count, CMR_buildings_total_area, </span>
<span id="cb836-5"><a href="population-prediction-and-uncertainty-quantification.html#cb836-5" tabindex="-1"></a>         CMR_Settlement_Classification,</span>
<span id="cb836-6"><a href="population-prediction-and-uncertainty-quantification.html#cb836-6" tabindex="-1"></a>         <span class="fu">starts_with</span>(<span class="st">&quot;x&quot;</span>), y)</span></code></pre></div>
<p>The <code>x</code> and <code>y</code> variables can be renamed as <code>lat</code> and <code>lon</code> to correspond with the latitude and longitude coordinates with the <code>rename()</code> function and use the <code>filter()</code> function to filter out any rows of data with <code>NA</code> for the settlement classification.</p>
<div class="sourceCode" id="cb837"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb837-1"><a href="population-prediction-and-uncertainty-quantification.html#cb837-1" tabindex="-1"></a><span class="co">#rename x and y as Lat and Lon and filter settlement classification with NA</span></span>
<span id="cb837-2"><a href="population-prediction-and-uncertainty-quantification.html#cb837-2" tabindex="-1"></a>prediction_covs <span class="ot">&lt;-</span> prediction_covs <span class="sc">%&gt;%</span> </span>
<span id="cb837-3"><a href="population-prediction-and-uncertainty-quantification.html#cb837-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Lat =</span> y, <span class="at">Lon =</span> x) <span class="sc">%&gt;%</span> </span>
<span id="cb837-4"><a href="population-prediction-and-uncertainty-quantification.html#cb837-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(CMR_Settlement_Classification)) </span></code></pre></div>
<p>Finally, the <code>write_rds()</code> function can be used to export the data as follows.</p>
<div class="sourceCode" id="cb838"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb838-1"><a href="population-prediction-and-uncertainty-quantification.html#cb838-1" tabindex="-1"></a><span class="co">#export data to file</span></span>
<span id="cb838-2"><a href="population-prediction-and-uncertainty-quantification.html#cb838-2" tabindex="-1"></a><span class="fu">write_rds</span>(prediction_covs, <span class="fu">paste0</span>(output_path, <span class="st">&quot;CMR_prediction_stack.rds&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="grid-cellpixel-level-prediction" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Grid cell/pixel level prediction<a href="population-prediction-and-uncertainty-quantification.html#grid-cellpixel-level-prediction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Gridded population data is beneficial as it allows for the integration with other datasets. Additionally, there is a major benefit that with gridded population data, population estimates can be calculated for various geographic units at a range of scales. For example</p>
<ul>
<li>EAs, wards, constituencies, districts</li>
<li>Health catchments</li>
<li>Within a specified distance of a feature (for example, within 5km of a health facility)</li>
</ul>
<p>The idea here is to use model parameter estimates from the fitted model to make predictions at the grid cell level with the extracted geospatial covariates at 100m resolution. The corresponding uncertainty estimates for the population predictions at various administrative levels can also be obtained.</p>
<p>As with all other methods, the relevant packages should be installed and loaded.</p>
<div class="sourceCode" id="cb839"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb839-1"><a href="population-prediction-and-uncertainty-quantification.html#cb839-1" tabindex="-1"></a><span class="co">#install the relevant packages</span></span>
<span id="cb839-2"><a href="population-prediction-and-uncertainty-quantification.html#cb839-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;kableExtra&quot;</span>)</span>
<span id="cb839-3"><a href="population-prediction-and-uncertainty-quantification.html#cb839-3" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;spdep&quot;</span>)</span>
<span id="cb839-4"><a href="population-prediction-and-uncertainty-quantification.html#cb839-4" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;INLA&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb840"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb840-1"><a href="population-prediction-and-uncertainty-quantification.html#cb840-1" tabindex="-1"></a><span class="co">#load the relevant packages</span></span>
<span id="cb840-2"><a href="population-prediction-and-uncertainty-quantification.html#cb840-2" tabindex="-1"></a><span class="fu">library</span>(INLA)</span>
<span id="cb840-3"><a href="population-prediction-and-uncertainty-quantification.html#cb840-3" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb840-4"><a href="population-prediction-and-uncertainty-quantification.html#cb840-4" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb840-5"><a href="population-prediction-and-uncertainty-quantification.html#cb840-5" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb840-6"><a href="population-prediction-and-uncertainty-quantification.html#cb840-6" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb840-7"><a href="population-prediction-and-uncertainty-quantification.html#cb840-7" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb840-8"><a href="population-prediction-and-uncertainty-quantification.html#cb840-8" tabindex="-1"></a><span class="fu">library</span>(tictoc)</span>
<span id="cb840-9"><a href="population-prediction-and-uncertainty-quantification.html#cb840-9" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb840-10"><a href="population-prediction-and-uncertainty-quantification.html#cb840-10" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<p>For visualisation purposes of the results, the scientific notation for all the variables can be turned off with the following code.</p>
<div class="sourceCode" id="cb841"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb841-1"><a href="population-prediction-and-uncertainty-quantification.html#cb841-1" tabindex="-1"></a><span class="co">#turn off scientific notation</span></span>
<span id="cb841-2"><a href="population-prediction-and-uncertainty-quantification.html#cb841-2" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span></code></pre></div>
<p>In Module 8, various models were fitted, ranging from the simple linear model to the Bayesian hierarchical models. In this section, the INLA SPDE approach is used to demonstrate how to make predictions using the more advanced Bayesian Geostatistical Model.</p>
<div id="pre-processing" class="section level3 hasAnchor" number="10.2.1">
<h3><span class="header-section-number">10.2.1</span> Pre-processing<a href="population-prediction-and-uncertainty-quantification.html#pre-processing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>First the data should be loaded into the R environment.</p>
<div class="sourceCode" id="cb842"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb842-1"><a href="population-prediction-and-uncertainty-quantification.html#cb842-1" tabindex="-1"></a><span class="co">#load csv file</span></span>
<span id="cb842-2"><a href="population-prediction-and-uncertainty-quantification.html#cb842-2" tabindex="-1"></a>Data_CMR <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(data_path,<span class="st">&quot;Pop_Data_Complete.csv&quot;</span>))</span>
<span id="cb842-3"><a href="population-prediction-and-uncertainty-quantification.html#cb842-3" tabindex="-1"></a></span>
<span id="cb842-4"><a href="population-prediction-and-uncertainty-quantification.html#cb842-4" tabindex="-1"></a><span class="co">#EA shapefile</span></span>
<span id="cb842-5"><a href="population-prediction-and-uncertainty-quantification.html#cb842-5" tabindex="-1"></a>ea_shp <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">paste0</span>(data_path ,<span class="st">&quot;Pop_Data_Complete.gpkg&quot;</span>)) </span></code></pre></div>
<pre><code>## Reading layer `Pop_Data_Complete&#39; from data source 
##   `F:\Study\WorldPop Training Materials\GitBook\wp_training_manual\data\CMR\Pop_Data_Complete.gpkg&#39; 
##   using driver `GPKG&#39;
## Simple feature collection with 1592 features and 50 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 8.498025 ymin: 1.653369 xmax: 16.1904 ymax: 12.96129
## Geodetic CRS:  WGS 84</code></pre>
<p>The centroid of the EA shapefile needs to be extracted as latitude and longitude coordinates and added into the Data_CMR <code>.csv</code> file. This can be done using the <code>as()</code> and <code>st_geometry()</code> functions to convert the shapefile to a spatial object and using the <code>coordinates()</code> function to extract and add the coordinates to the demographic data.</p>
<div class="sourceCode" id="cb844"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb844-1"><a href="population-prediction-and-uncertainty-quantification.html#cb844-1" tabindex="-1"></a><span class="co">#convert shapefile to a spatial object</span></span>
<span id="cb844-2"><a href="population-prediction-and-uncertainty-quantification.html#cb844-2" tabindex="-1"></a>shp <span class="ot">&lt;-</span> <span class="fu">as</span>(<span class="fu">st_geometry</span>(ea_shp), <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb844-3"><a href="population-prediction-and-uncertainty-quantification.html#cb844-3" tabindex="-1"></a></span>
<span id="cb844-4"><a href="population-prediction-and-uncertainty-quantification.html#cb844-4" tabindex="-1"></a><span class="co">#add the lat-long coordinates to the data</span></span>
<span id="cb844-5"><a href="population-prediction-and-uncertainty-quantification.html#cb844-5" tabindex="-1"></a>Data_CMR<span class="sc">$</span>long <span class="ot">&lt;-</span> <span class="fu">coordinates</span>(shp)[,<span class="dv">1</span>] <span class="co">#extract and add the longitude to the data</span></span>
<span id="cb844-6"><a href="population-prediction-and-uncertainty-quantification.html#cb844-6" tabindex="-1"></a>Data_CMR<span class="sc">$</span>lat <span class="ot">&lt;-</span> <span class="fu">coordinates</span>(shp)[,<span class="dv">2</span>] <span class="co">#extract and add the latitude to the data</span></span>
<span id="cb844-7"><a href="population-prediction-and-uncertainty-quantification.html#cb844-7" tabindex="-1"></a></span>
<span id="cb844-8"><a href="population-prediction-and-uncertainty-quantification.html#cb844-8" tabindex="-1"></a><span class="co">#view first six rows of the data as a summary</span></span>
<span id="cb844-9"><a href="population-prediction-and-uncertainty-quantification.html#cb844-9" tabindex="-1"></a><span class="fu">head</span>(Data_CMR, <span class="dv">6</span>)</span></code></pre></div>
<pre><code>##   X           EA_ID Department     dept_libelle Regions region_libelle Total_Pop Settlement_Type
## 1 1 ABONG - MBANG_6         30       Haut Nyong       3            Est       890               1
## 2 2    AFANLOUM_702          3  Mefou et Afamba       2         Centre       815               4
## 3 3       AKOEMAN_3         49     Nyong et Soo       2         Centre       764               4
## 4 4     AKOM II_702         25            Ocean      10            Sud       746               4
## 5 5   AKONOLINGA_18         50 Nyong et Mfoumou       2         Centre      1109               4
## 6 6  AKONOLINGA_700         50 Nyong et Mfoumou       2         Centre      1357               4
##   Total_Building_Count Total_Building_Area       x1       x2       x3        x4       x5        x6
## 1                  286            32018.38 240337.7 86203.41 413765.8 139978.61 86203.41 184933.17
## 2                  395            38397.15 338154.9 36501.53 317968.1  36501.53 36501.53  74746.61
## 3                  367            33433.51 437903.8 54406.30 278816.8  72425.01 54406.30  72425.01
## 4                  269            24597.57 572474.0 65059.10 207275.2 167467.12 65059.10 171884.52
## 5                  286            39113.68 346930.5 47410.98 334817.6  80121.03 47410.98  80121.03
## 6                  402            30872.22 344902.1 55245.77 333230.8  76245.29 55245.77  78916.31
##          x7        x8        x9       x10       x11       x12      x13       x14       x15        x16
## 1 184933.17  49.00933 0.8580208 0.5127055 1874.8511 124.96131 43.36115 663.00330 369.54599 66.4226456
## 2  74746.61  94.78092 0.3557110 0.2034208  294.0987 102.34338 39.95544  96.79045 264.67972 28.3830357
## 3  72425.01  88.32083 0.3629119 0.2126397  328.2499  90.47405 36.73468 104.04270 177.91858 22.1087456
## 4 171884.52 399.27695 0.3817135 0.2085105  403.9308 100.72127 39.06967 128.10530  63.06371 29.8604965
## 5  80121.03  65.29633 0.5584586 0.3535644 1485.4635 132.72063 45.55459 590.01727 262.23849  0.5587888
## 6  78916.31  60.77288 0.3845364 0.2158287  318.3337  79.70691 34.87637  92.70645 264.28845  4.6560779
##         x17        x18        x19       x20      x21       x22         x23       x24         x25
## 1 0.2506842  0.2168530  0.8513528 53.339569 571.1937  1.780275 -0.05533693 118.72293 0.001490207
## 2 0.3522204 -0.2481708 11.8486433 11.467803 493.3647 30.267328 26.14026642  77.73151 0.023819378
## 3 2.0923870 -1.9790570 33.6847458 55.099686 515.8448 38.471977 22.51198578 201.92075 0.024310285
## 4 7.1534176 -7.0361733 65.0350876 65.647385 483.9221 62.489433 34.99201965 320.03601 0.045389920
## 5 0.6619807 -0.3192018  0.7926053  1.597502 531.0815  4.531395  0.59316117 115.86395 0.014609964
## 6 0.4313623 -0.3258749  8.7227964  5.226479 525.6237  9.087230  7.94695139 107.66605 0.018198114
##          x26           x27      x28       x29        x30         x31        x32        x33        x34
## 1 0.01200000 0.00004149579 297.4118  2296.646   288.1877    14.69919   225.3033   390.2323   476.4956
## 2 0.02870464 0.00004402846 297.6783 35368.785 47777.6641 11518.32129  8068.7568 48683.5234 26756.2227
## 3 0.02861884 0.00005605924 297.4679 21204.406 28928.2246  1605.29187 38670.0625 40177.6914 31366.0879
## 4 0.04607061 0.00010642956 298.1458 34093.812 40311.1211  9626.27930  6508.7632 35146.3125 43208.0781
## 5 0.03405531 0.00004095252 297.7811  1161.185  1691.4470   630.90527 37276.1211  1713.5939  2773.5483
## 6 0.02470175 0.00004092990 297.7823  7917.528  8837.5303   996.53833 29232.8477  9127.7480  9087.2295
##         x35       x36         x37        x38      x39       x40      x41     long      lat
## 1  2.410922  99782.04   435.05762   722.6469 694.9709 0.8488668 499.7907 13.17765 3.985047
## 2  8.193155  34135.90  6064.46387 20564.3906 732.0835 0.1883050 387.9030 12.10438 4.195674
## 3 14.047594  51499.27 10335.01562  5314.2729 684.1978 0.1645098 315.3396 11.57054 3.214603
## 4 13.598531 102436.87 23514.07422  8531.0508 603.2908 0.2087497 201.3288 10.45882 2.733207
## 5  1.513200  77467.59    87.84882   354.3566 647.6537 0.3821937 392.5313 12.23236 3.776276
## 6  3.314217  73533.62  3984.64355  4101.4194 691.9840 0.2072315 393.2006 12.22670 3.853698</code></pre>
<p>Using the piper operator and the <code>mutate()</code> function, the population density can be calculated, which is required later in the process, for example, in the model fitting.</p>
<div class="sourceCode" id="cb846"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb846-1"><a href="population-prediction-and-uncertainty-quantification.html#cb846-1" tabindex="-1"></a><span class="co">#compute the density</span></span>
<span id="cb846-2"><a href="population-prediction-and-uncertainty-quantification.html#cb846-2" tabindex="-1"></a>Data_CMR <span class="ot">&lt;-</span> Data_CMR <span class="sc">%&gt;%</span> </span>
<span id="cb846-3"><a href="population-prediction-and-uncertainty-quantification.html#cb846-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Density =</span> Total_Pop<span class="sc">/</span>Total_Building_Count)</span></code></pre></div>
<p>As seen previously, the covariates need to be standardised so that they are on the same scale, which will aid in the modelling process. The same function as seen in Module 8 (Section 4.2) is given below, and can then be applied to standardise the covariates. This resulting value is also known as a <strong>z-score</strong>.</p>
<div class="sourceCode" id="cb847"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb847-1"><a href="population-prediction-and-uncertainty-quantification.html#cb847-1" tabindex="-1"></a><span class="co">#standardisation function for model covariates</span></span>
<span id="cb847-2"><a href="population-prediction-and-uncertainty-quantification.html#cb847-2" tabindex="-1"></a>stdise <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb847-3"><a href="population-prediction-and-uncertainty-quantification.html#cb847-3" tabindex="-1"></a>{</span>
<span id="cb847-4"><a href="population-prediction-and-uncertainty-quantification.html#cb847-4" tabindex="-1"></a>  stds <span class="ot">&lt;-</span> (x <span class="sc">-</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))<span class="sc">/</span><span class="fu">sd</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb847-5"><a href="population-prediction-and-uncertainty-quantification.html#cb847-5" tabindex="-1"></a>  <span class="fu">return</span>(stds)</span>
<span id="cb847-6"><a href="population-prediction-and-uncertainty-quantification.html#cb847-6" tabindex="-1"></a>}</span>
<span id="cb847-7"><a href="population-prediction-and-uncertainty-quantification.html#cb847-7" tabindex="-1"></a></span>
<span id="cb847-8"><a href="population-prediction-and-uncertainty-quantification.html#cb847-8" tabindex="-1"></a><span class="co">#create new data frame to contain standardised covariates</span></span>
<span id="cb847-9"><a href="population-prediction-and-uncertainty-quantification.html#cb847-9" tabindex="-1"></a>Data_CMR_std <span class="ot">&lt;-</span> Data_CMR</span>
<span id="cb847-10"><a href="population-prediction-and-uncertainty-quantification.html#cb847-10" tabindex="-1"></a></span>
<span id="cb847-11"><a href="population-prediction-and-uncertainty-quantification.html#cb847-11" tabindex="-1"></a><span class="co">#standardise the covariates only</span></span>
<span id="cb847-12"><a href="population-prediction-and-uncertainty-quantification.html#cb847-12" tabindex="-1"></a>cov_vars <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;x&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">41</span>) </span>
<span id="cb847-13"><a href="population-prediction-and-uncertainty-quantification.html#cb847-13" tabindex="-1"></a>Data_CMR_std[, cov_vars] <span class="ot">&lt;-</span> <span class="fu">apply</span>(Data_CMR[, cov_vars], <span class="dv">2</span>, stdise)</span>
<span id="cb847-14"><a href="population-prediction-and-uncertainty-quantification.html#cb847-14" tabindex="-1"></a></span>
<span id="cb847-15"><a href="population-prediction-and-uncertainty-quantification.html#cb847-15" tabindex="-1"></a><span class="co">#summary of covariates before and after standardisation</span></span>
<span id="cb847-16"><a href="population-prediction-and-uncertainty-quantification.html#cb847-16" tabindex="-1"></a><span class="fu">head</span>(Data_CMR[,cov_vars[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]])</span></code></pre></div>
<pre><code>##         x1       x2       x3        x4       x5
## 1 240337.7 86203.41 413765.8 139978.61 86203.41
## 2 338154.9 36501.53 317968.1  36501.53 36501.53
## 3 437903.8 54406.30 278816.8  72425.01 54406.30
## 4 572474.0 65059.10 207275.2 167467.12 65059.10
## 5 346930.5 47410.98 334817.6  80121.03 47410.98
## 6 344902.1 55245.77 333230.8  76245.29 55245.77</code></pre>
<div class="sourceCode" id="cb849"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb849-1"><a href="population-prediction-and-uncertainty-quantification.html#cb849-1" tabindex="-1"></a><span class="fu">head</span>(Data_CMR_std[,cov_vars[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]])</span></code></pre></div>
<pre><code>##            x1          x2         x3         x4          x5
## 1 -0.62880443  1.10518418  1.5292650  0.2777396  0.89020837
## 2 -0.13168532 -0.01029845  0.7477583 -0.8029266 -0.09342136
## 3  0.37525087  0.39154679  0.4283667 -0.4277586  0.26092475
## 4  1.05915270  0.63063252 -0.1552609  0.5648168  0.47174994
## 5 -0.08708668  0.23454744  0.8852148 -0.3473849  0.12248313
## 6 -0.09739513  0.41038730  0.8722700 -0.3878613  0.27753826</code></pre>
<p>For the processes later, it is important that there are no NA values for the population density. Therefore, from the (standardised) demographic data, the NA values should be removed from the <code>Density</code>, which can be done using the <code>drop_na()</code> function.</p>
<div class="sourceCode" id="cb851"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb851-1"><a href="population-prediction-and-uncertainty-quantification.html#cb851-1" tabindex="-1"></a><span class="co">#remove NA values in Density</span></span>
<span id="cb851-2"><a href="population-prediction-and-uncertainty-quantification.html#cb851-2" tabindex="-1"></a>Data_CMR_std <span class="ot">&lt;-</span> Data_CMR_std <span class="sc">%&gt;%</span> </span>
<span id="cb851-3"><a href="population-prediction-and-uncertainty-quantification.html#cb851-3" tabindex="-1"></a>  <span class="fu">drop_na</span>(Density)</span></code></pre></div>
</div>
<div id="inla-spde-approach" class="section level3 hasAnchor" number="10.2.2">
<h3><span class="header-section-number">10.2.2</span> INLA-SPDE approach<a href="population-prediction-and-uncertainty-quantification.html#inla-spde-approach" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In order to fit the Bayesian SPDE model with INLA, a mesh needs to be constructed using the same approach as in Module 8 (Section 6.1).</p>
<p>To begin with, the coordinates of the centroids should be defined.</p>
<div class="sourceCode" id="cb852"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb852-1"><a href="population-prediction-and-uncertainty-quantification.html#cb852-1" tabindex="-1"></a><span class="co">#define centroid coordinates</span></span>
<span id="cb852-2"><a href="population-prediction-and-uncertainty-quantification.html#cb852-2" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Data_CMR_std<span class="sc">$</span>long, Data_CMR_std<span class="sc">$</span>lat) </span>
<span id="cb852-3"><a href="population-prediction-and-uncertainty-quantification.html#cb852-3" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">dist</span>(coords))</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   0.000   1.681   2.784   3.540   5.523  11.214</code></pre>
<p>Then the <code>inla.nonconvex.hull()</code> function can be used to define the boundary with the arguments for <code>points</code> (the 2D point coordinates), <code>convex</code> (the desired extension radius), <code>concave</code> (the minimal concave curvature radius) and <code>resolution</code> (the internal computation resolution). This is then followed by the <code>inla.mesh.2d()</code> function with arguments for the <code>boundary</code> (defined with <code>inla.nonconvex.hull()</code>), <code>max.edge</code> (adjusts the mesh node sizes between the inner and outer meshes), <code>offset</code> (adjusts the distance between the outer and inner meshes), <code>cutoff</code> (controls the minimum size of the triangles allowed).</p>
<div class="sourceCode" id="cb854"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb854-1"><a href="population-prediction-and-uncertainty-quantification.html#cb854-1" tabindex="-1"></a><span class="co">#boundary construction</span></span>
<span id="cb854-2"><a href="population-prediction-and-uncertainty-quantification.html#cb854-2" tabindex="-1"></a>bnd <span class="ot">&lt;-</span> <span class="fu">inla.nonconvex.hull</span>(<span class="at">points =</span> coords,</span>
<span id="cb854-3"><a href="population-prediction-and-uncertainty-quantification.html#cb854-3" tabindex="-1"></a>                           <span class="at">convex =</span> <span class="sc">-</span><span class="fl">0.03</span>, </span>
<span id="cb854-4"><a href="population-prediction-and-uncertainty-quantification.html#cb854-4" tabindex="-1"></a>                           <span class="at">concave =</span> <span class="sc">-</span><span class="fl">0.05</span>,</span>
<span id="cb854-5"><a href="population-prediction-and-uncertainty-quantification.html#cb854-5" tabindex="-1"></a>                           <span class="at">resolution =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">100</span>))</span>
<span id="cb854-6"><a href="population-prediction-and-uncertainty-quantification.html#cb854-6" tabindex="-1"></a></span>
<span id="cb854-7"><a href="population-prediction-and-uncertainty-quantification.html#cb854-7" tabindex="-1"></a><span class="co">#mesh construction</span></span>
<span id="cb854-8"><a href="population-prediction-and-uncertainty-quantification.html#cb854-8" tabindex="-1"></a>meshb <span class="ot">&lt;-</span> <span class="fu">inla.mesh.2d</span>(<span class="at">boundary =</span> bnd,</span>
<span id="cb854-9"><a href="population-prediction-and-uncertainty-quantification.html#cb854-9" tabindex="-1"></a>                      <span class="at">max.edge =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>),</span>
<span id="cb854-10"><a href="population-prediction-and-uncertainty-quantification.html#cb854-10" tabindex="-1"></a>                      <span class="at">offset =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="dv">1</span>),</span>
<span id="cb854-11"><a href="population-prediction-and-uncertainty-quantification.html#cb854-11" tabindex="-1"></a>                      <span class="at">cutoff =</span> <span class="fl">0.003</span>)</span></code></pre></div>
<p>The resulting mesh can be plotted with the <code>plot()</code> function. Here it can be seen visually if the values in the above functions need to be adjusted to be more suitable.</p>
<div class="sourceCode" id="cb855"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb855-1"><a href="population-prediction-and-uncertainty-quantification.html#cb855-1" tabindex="-1"></a><span class="co">#plot mesh</span></span>
<span id="cb855-2"><a href="population-prediction-and-uncertainty-quantification.html#cb855-2" tabindex="-1"></a><span class="fu">plot</span>(meshb)</span>
<span id="cb855-3"><a href="population-prediction-and-uncertainty-quantification.html#cb855-3" tabindex="-1"></a><span class="fu">points</span>(coords, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="WorldPop_Training_Manual_files/figure-html/plot%20mesh-1.png" width="672" /></p>
<div class="sourceCode" id="cb856"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb856-1"><a href="population-prediction-and-uncertainty-quantification.html#cb856-1" tabindex="-1"></a><span class="co">#number of vertices</span></span>
<span id="cb856-2"><a href="population-prediction-and-uncertainty-quantification.html#cb856-2" tabindex="-1"></a>meshb<span class="sc">$</span>n </span></code></pre></div>
<pre><code>## [1] 11692</code></pre>
<p>As in Module 8, Section 6, once the mesh is constructed, the SPDE can be built using the <code>inla.spde2.matern()</code> function, with the <code>mesh</code> constructed above as an argument, along with the arguments <code>alpha</code> and <code>constr</code>.</p>
<div class="sourceCode" id="cb858"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb858-1"><a href="population-prediction-and-uncertainty-quantification.html#cb858-1" tabindex="-1"></a><span class="co">#build the SPDE</span></span>
<span id="cb858-2"><a href="population-prediction-and-uncertainty-quantification.html#cb858-2" tabindex="-1"></a>spde <span class="ot">&lt;-</span> <span class="fu">inla.spde2.matern</span>(<span class="at">mesh =</span> meshb, <span class="at">alpha =</span> <span class="dv">2</span>, <span class="at">constr =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>The next step laid out in Module 8 is to create the projection matrix with the <code>inla.spde.make.A()</code> function as follows.</p>
<div class="sourceCode" id="cb859"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb859-1"><a href="population-prediction-and-uncertainty-quantification.html#cb859-1" tabindex="-1"></a><span class="co">#construct the projection matrix</span></span>
<span id="cb859-2"><a href="population-prediction-and-uncertainty-quantification.html#cb859-2" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">inla.spde.make.A</span>(<span class="at">mesh =</span> meshb, <span class="at">loc =</span> coords)</span></code></pre></div>
<p>The next step in the posterior distribution simulation process is to specify the spatial effect. This is done through using the function <code>inla.spde.make.index()</code> with an argument specifying the base <code>name</code> of the effect (in this case <code>"spatial_effect"</code>), and <code>n.spde</code> (the size of the model, extracted from the <code>spde</code> constructed above).</p>
<div class="sourceCode" id="cb860"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb860-1"><a href="population-prediction-and-uncertainty-quantification.html#cb860-1" tabindex="-1"></a><span class="co">#specify the spatial effect </span></span>
<span id="cb860-2"><a href="population-prediction-and-uncertainty-quantification.html#cb860-2" tabindex="-1"></a>indexs <span class="ot">&lt;-</span> <span class="fu">inla.spde.make.index</span>(<span class="at">name =</span> <span class="st">&quot;spatial_effect&quot;</span>,</span>
<span id="cb860-3"><a href="population-prediction-and-uncertainty-quantification.html#cb860-3" tabindex="-1"></a>                               <span class="at">n.spde =</span> spde<span class="sc">$</span>n.spde)</span></code></pre></div>
<p>From the covariate selection process, the covariate that were chosen as the most significant or “best” can be extracted from the (standardised) demographic dataset and added to a new variable for the covariates with the <code>select()</code> function from the <code>dplyr</code> package. Below, there is an additional covariate selected for <code>Settlement_Type</code> which is used as a random effect in the subsequent modelling.</p>
<div class="sourceCode" id="cb861"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb861-1"><a href="population-prediction-and-uncertainty-quantification.html#cb861-1" tabindex="-1"></a><span class="co">#select covariates</span></span>
<span id="cb861-2"><a href="population-prediction-and-uncertainty-quantification.html#cb861-2" tabindex="-1"></a>covs <span class="ot">&lt;-</span> Data_CMR_std <span class="sc">%&gt;%</span></span>
<span id="cb861-3"><a href="population-prediction-and-uncertainty-quantification.html#cb861-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(x3, x4, x7, x16, x20, x31, x37, x40, Settlement_Type)</span></code></pre></div>
<p>The <code>inla.stack()</code> function can then be used to stack the data, ready for model fitting, with the arguments <code>data</code> (a list containing the response variable), <code>A</code> (a list containing the projection <code>A</code> matrix created earlier and <code>1</code> to make the list of covariates), <code>effects</code> (a list containing the <code>Intercept</code>, the spatial index and the list of covariates) and <code>tag</code> (a quick name to call upon).</p>
<div class="sourceCode" id="cb862"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb862-1"><a href="population-prediction-and-uncertainty-quantification.html#cb862-1" tabindex="-1"></a><span class="co">#stack the data for model fitting</span></span>
<span id="cb862-2"><a href="population-prediction-and-uncertainty-quantification.html#cb862-2" tabindex="-1"></a>stk.e <span class="ot">&lt;-</span> <span class="fu">inla.stack</span>(<span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> Data_CMR_std<span class="sc">$</span>Density), </span>
<span id="cb862-3"><a href="population-prediction-and-uncertainty-quantification.html#cb862-3" tabindex="-1"></a>                    <span class="at">A =</span> <span class="fu">list</span>(A,<span class="dv">1</span>),  </span>
<span id="cb862-4"><a href="population-prediction-and-uncertainty-quantification.html#cb862-4" tabindex="-1"></a>                    <span class="at">effects =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="fu">list</span>(<span class="at">Intercept =</span> <span class="dv">1</span>), </span>
<span id="cb862-5"><a href="population-prediction-and-uncertainty-quantification.html#cb862-5" tabindex="-1"></a>                                   indexs),  </span>
<span id="cb862-6"><a href="population-prediction-and-uncertainty-quantification.html#cb862-6" tabindex="-1"></a>                                 <span class="fu">list</span>(covs)</span>
<span id="cb862-7"><a href="population-prediction-and-uncertainty-quantification.html#cb862-7" tabindex="-1"></a>                    ),</span>
<span id="cb862-8"><a href="population-prediction-and-uncertainty-quantification.html#cb862-8" tabindex="-1"></a>                    <span class="at">tag =</span> <span class="st">&#39;est&#39;</span>) </span></code></pre></div>
<p>Before fitting the INLA model, it is best to specify the model formula as seen before, in this case, there are the selected covariates, as well as random effects for the <code>spatial_effect</code> and the <code>Settlement_Type</code>. Following the model formula specification, the model is fitted with the <code>inla()</code> function, specifying the following arguments.</p>
<ul>
<li><code>formula</code>: the pre-defined model formula.</li>
<li><code>data</code>: the data stack.</li>
<li><code>family</code>: the likelihood family, in this case a gamma distribution is used, however, a lognormal distribution could also be used.</li>
<li><code>control.predictor</code>: computes the marginals of the linear predictor.</li>
<li><code>control.compute</code>: a list of logical statements for computing model diagnostics.</li>
<li><code>verbose</code>: logical statement indicating whether the function should run in a verbose mode.</li>
<li><code>control.inla</code>: a list containing the control variables.</li>
</ul>
<div class="sourceCode" id="cb863"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb863-1"><a href="population-prediction-and-uncertainty-quantification.html#cb863-1" tabindex="-1"></a><span class="co">#specify model </span></span>
<span id="cb863-2"><a href="population-prediction-and-uncertainty-quantification.html#cb863-2" tabindex="-1"></a>formula <span class="ot">&lt;-</span> y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> Intercept <span class="sc">+</span> x3 <span class="sc">+</span> x4 <span class="sc">+</span> x7 <span class="sc">+</span> x16 <span class="sc">+</span> x20 <span class="sc">+</span> x31 <span class="sc">+</span> x37 <span class="sc">+</span>x40 <span class="sc">+</span></span>
<span id="cb863-3"><a href="population-prediction-and-uncertainty-quantification.html#cb863-3" tabindex="-1"></a>  <span class="fu">f</span>(spatial_effect, <span class="at">model =</span> spde)<span class="sc">+</span></span>
<span id="cb863-4"><a href="population-prediction-and-uncertainty-quantification.html#cb863-4" tabindex="-1"></a>  <span class="fu">f</span>(Settlement_Type, <span class="at">model =</span> <span class="st">&quot;iid&quot;</span>)</span>
<span id="cb863-5"><a href="population-prediction-and-uncertainty-quantification.html#cb863-5" tabindex="-1"></a></span>
<span id="cb863-6"><a href="population-prediction-and-uncertainty-quantification.html#cb863-6" tabindex="-1"></a><span class="co">#fit the inla model with a gamma distribution</span></span>
<span id="cb863-7"><a href="population-prediction-and-uncertainty-quantification.html#cb863-7" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">inla</span>(<span class="at">formula =</span> formula, </span>
<span id="cb863-8"><a href="population-prediction-and-uncertainty-quantification.html#cb863-8" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">inla.stack.data</span>(stk.e, <span class="at">spde =</span> spde), </span>
<span id="cb863-9"><a href="population-prediction-and-uncertainty-quantification.html#cb863-9" tabindex="-1"></a>            <span class="at">family =</span> <span class="st">&#39;gamma&#39;</span>,  </span>
<span id="cb863-10"><a href="population-prediction-and-uncertainty-quantification.html#cb863-10" tabindex="-1"></a>            <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="fu">inla.stack.A</span>(stk.e), <span class="at">compute =</span> <span class="cn">TRUE</span>), </span>
<span id="cb863-11"><a href="population-prediction-and-uncertainty-quantification.html#cb863-11" tabindex="-1"></a>            <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>, <span class="at">waic =</span> <span class="cn">TRUE</span>, <span class="at">cpo =</span> <span class="cn">TRUE</span>,</span>
<span id="cb863-12"><a href="population-prediction-and-uncertainty-quantification.html#cb863-12" tabindex="-1"></a>                                   <span class="at">config =</span> <span class="cn">TRUE</span>), </span>
<span id="cb863-13"><a href="population-prediction-and-uncertainty-quantification.html#cb863-13" tabindex="-1"></a>            <span class="at">verbose =</span> <span class="cn">FALSE</span>, </span>
<span id="cb863-14"><a href="population-prediction-and-uncertainty-quantification.html#cb863-14" tabindex="-1"></a>            <span class="at">control.inla=</span><span class="fu">list</span>(<span class="at">int.strategy =</span> <span class="st">&quot;grid&quot;</span>, <span class="at">diff.logdens =</span> <span class="dv">4</span>,</span>
<span id="cb863-15"><a href="population-prediction-and-uncertainty-quantification.html#cb863-15" tabindex="-1"></a>                              <span class="at">strategy =</span> <span class="st">&quot;laplace&quot;</span>, <span class="at">npoints =</span> <span class="dv">21</span>))</span>
<span id="cb863-16"><a href="population-prediction-and-uncertainty-quantification.html#cb863-16" tabindex="-1"></a></span>
<span id="cb863-17"><a href="population-prediction-and-uncertainty-quantification.html#cb863-17" tabindex="-1"></a><span class="fu">summary</span>(res)</span></code></pre></div>
<pre><code>## Time used:
##     Pre = 1.15, Running = 98.2, Post = 1.4, Total = 101 
## Fixed effects:
##             mean    sd 0.025quant 0.5quant 0.975quant   mode kld
## Intercept  1.185 0.080      1.031    1.184      1.345  1.184   0
## x3        -0.034 0.059     -0.149   -0.034      0.083 -0.034   0
## x4        -0.107 0.057     -0.220   -0.107      0.006 -0.107   0
## x7        -0.102 0.066     -0.233   -0.102      0.025 -0.102   0
## x16       -0.061 0.035     -0.130   -0.061      0.007 -0.061   0
## x20        0.105 0.037      0.032    0.105      0.177  0.105   0
## x31       -0.061 0.025     -0.110   -0.061     -0.011 -0.061   0
## x37       -0.036 0.031     -0.096   -0.036      0.025 -0.036   0
## x40        0.032 0.038     -0.043    0.032      0.106  0.032   0
## 
## Random effects:
##   Name     Model
##     spatial_effect SPDE2 model
##    Settlement_Type IID model
## 
## Model hyperparameters:
##                                                   mean       sd 0.025quant 0.5quant 0.975quant   mode
## Precision-parameter for the Gamma observations    3.42    0.143       3.17     3.41       3.73   3.37
## Theta1 for spatial_effect                        -2.88    0.130      -3.14    -2.88      -2.63  -2.88
## Theta2 for spatial_effect                         2.12    0.141       1.84     2.12       2.40   2.12
## Precision for Settlement_Type                  1043.92 1934.071      80.42   514.99    5397.20 189.05
## 
## Deviance Information Criterion (DIC) ...............: 6611.44
## Deviance Information Criterion (DIC, saturated) ....: 1966.32
## Effective number of parameters .....................: 313.78
## 
## Watanabe-Akaike information criterion (WAIC) ...: 6798.76
## Effective number of parameters .................: 352.24
## 
## Marginal log-Likelihood:  -3493.70 
## CPO, PIT is computed 
## Posterior summaries for the linear predictor and the fitted values are computed
## (Posterior marginals needs also &#39;control.compute=list(return.marginals.predictor=TRUE)&#39;)</code></pre>
<div id="predictions" class="section level4 hasAnchor" number="10.2.2.1">
<h4><span class="header-section-number">10.2.2.1</span> Predictions<a href="population-prediction-and-uncertainty-quantification.html#predictions" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In-sample predictions can be extracted using the <code>inla.stack.index()</code> function and the corresponding predicted density (computed through extracting <code>summary.linear predictor[index, "mean"]</code> from the above model) added into a new data frame with the <code>data.frame()</code> function.</p>
<div class="sourceCode" id="cb865"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb865-1"><a href="population-prediction-and-uncertainty-quantification.html#cb865-1" tabindex="-1"></a><span class="co">#extract predictions</span></span>
<span id="cb865-2"><a href="population-prediction-and-uncertainty-quantification.html#cb865-2" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">inla.stack.index</span>(stk.e, <span class="st">&quot;est&quot;</span>)<span class="sc">$</span>data</span>
<span id="cb865-3"><a href="population-prediction-and-uncertainty-quantification.html#cb865-3" tabindex="-1"></a></span>
<span id="cb865-4"><a href="population-prediction-and-uncertainty-quantification.html#cb865-4" tabindex="-1"></a><span class="co">#compute predicted density and include in new data frame</span></span>
<span id="cb865-5"><a href="population-prediction-and-uncertainty-quantification.html#cb865-5" tabindex="-1"></a>in_sample <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">predicted_density =</span> </span>
<span id="cb865-6"><a href="population-prediction-and-uncertainty-quantification.html#cb865-6" tabindex="-1"></a>                          <span class="fu">exp</span>(res<span class="sc">$</span>summary.linear.predictor[index, <span class="st">&quot;mean&quot;</span>]))</span></code></pre></div>
<p>The observed population and observed density values from the (standardised) demographic data can be selected in order to be used later in the in-sample model metric assessment.</p>
<div class="sourceCode" id="cb866"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb866-1"><a href="population-prediction-and-uncertainty-quantification.html#cb866-1" tabindex="-1"></a><span class="co">#select observed population, density and building count</span></span>
<span id="cb866-2"><a href="population-prediction-and-uncertainty-quantification.html#cb866-2" tabindex="-1"></a>metrics_data <span class="ot">&lt;-</span> Data_CMR_std <span class="sc">%&gt;%</span> </span>
<span id="cb866-3"><a href="population-prediction-and-uncertainty-quantification.html#cb866-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Total_Pop, Density, Total_Building_Count) <span class="sc">%&gt;%</span> </span>
<span id="cb866-4"><a href="population-prediction-and-uncertainty-quantification.html#cb866-4" tabindex="-1"></a>  <span class="fu">cbind</span>(in_sample)</span></code></pre></div>
<p>The predicted density found above is multiplied by the <code>Total_Building_Count</code> extracted from the observed data to obtain the predicted population.</p>
<div class="sourceCode" id="cb867"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb867-1"><a href="population-prediction-and-uncertainty-quantification.html#cb867-1" tabindex="-1"></a><span class="co">#predicted population = predicted density x observed total building count</span></span>
<span id="cb867-2"><a href="population-prediction-and-uncertainty-quantification.html#cb867-2" tabindex="-1"></a>metrics_data <span class="ot">&lt;-</span> metrics_data <span class="sc">%&gt;%</span> </span>
<span id="cb867-3"><a href="population-prediction-and-uncertainty-quantification.html#cb867-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted_population =</span> predicted_density <span class="sc">*</span> Total_Building_Count)</span>
<span id="cb867-4"><a href="population-prediction-and-uncertainty-quantification.html#cb867-4" tabindex="-1"></a></span>
<span id="cb867-5"><a href="population-prediction-and-uncertainty-quantification.html#cb867-5" tabindex="-1"></a><span class="co">#rename variables in proper format</span></span>
<span id="cb867-6"><a href="population-prediction-and-uncertainty-quantification.html#cb867-6" tabindex="-1"></a>metrics_data <span class="ot">&lt;-</span> metrics_data <span class="sc">%&gt;%</span> </span>
<span id="cb867-7"><a href="population-prediction-and-uncertainty-quantification.html#cb867-7" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">observed_population =</span> Total_Pop, <span class="at">observed_density =</span> Density)</span></code></pre></div>
<p>Finally, the model performance metrics can be computed for both the density and total population. Similar to as in Module 9, metrics such as the bias, MSE, RMSE and correlation are of interest, in addition to the inaccuracy and imprecision.</p>
<div class="sourceCode" id="cb868"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb868-1"><a href="population-prediction-and-uncertainty-quantification.html#cb868-1" tabindex="-1"></a><span class="co">#density metrics</span></span>
<span id="cb868-2"><a href="population-prediction-and-uncertainty-quantification.html#cb868-2" tabindex="-1"></a>density_metrics <span class="ot">&lt;-</span> metrics_data <span class="sc">%&gt;%</span> </span>
<span id="cb868-3"><a href="population-prediction-and-uncertainty-quantification.html#cb868-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">residual =</span> observed_density <span class="sc">-</span> predicted_density) <span class="sc">%&gt;%</span> </span>
<span id="cb868-4"><a href="population-prediction-and-uncertainty-quantification.html#cb868-4" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb868-5"><a href="population-prediction-and-uncertainty-quantification.html#cb868-5" tabindex="-1"></a>    <span class="at">Bias=</span> <span class="fu">mean</span>(residual),</span>
<span id="cb868-6"><a href="population-prediction-and-uncertainty-quantification.html#cb868-6" tabindex="-1"></a>    <span class="at">Imprecision =</span> <span class="fu">sd</span>(residual),</span>
<span id="cb868-7"><a href="population-prediction-and-uncertainty-quantification.html#cb868-7" tabindex="-1"></a>    <span class="at">Inaccuracy =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(residual)),</span>
<span id="cb868-8"><a href="population-prediction-and-uncertainty-quantification.html#cb868-8" tabindex="-1"></a>    <span class="at">mse =</span> <span class="fu">mean</span>((residual)<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb868-9"><a href="population-prediction-and-uncertainty-quantification.html#cb868-9" tabindex="-1"></a>    <span class="at">rmse =</span> <span class="fu">sqrt</span>(mse),</span>
<span id="cb868-10"><a href="population-prediction-and-uncertainty-quantification.html#cb868-10" tabindex="-1"></a>    <span class="at">Corr =</span> <span class="fu">cor</span>(observed_density, predicted_density))</span>
<span id="cb868-11"><a href="population-prediction-and-uncertainty-quantification.html#cb868-11" tabindex="-1"></a></span>
<span id="cb868-12"><a href="population-prediction-and-uncertainty-quantification.html#cb868-12" tabindex="-1"></a>density_metrics <span class="sc">%&gt;%</span> </span>
<span id="cb868-13"><a href="population-prediction-and-uncertainty-quantification.html#cb868-13" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">Bias</th>
<th align="right">Imprecision</th>
<th align="right">Inaccuracy</th>
<th align="right">mse</th>
<th align="right">rmse</th>
<th align="right">Corr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.7522486</td>
<td align="right">21.23032</td>
<td align="right">2.618071</td>
<td align="right">451.0086</td>
<td align="right">21.23696</td>
<td align="right">0.8579087</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb869"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb869-1"><a href="population-prediction-and-uncertainty-quantification.html#cb869-1" tabindex="-1"></a><span class="co">#total population metrics</span></span>
<span id="cb869-2"><a href="population-prediction-and-uncertainty-quantification.html#cb869-2" tabindex="-1"></a>pop_metrics <span class="ot">&lt;-</span> metrics_data <span class="sc">%&gt;%</span> </span>
<span id="cb869-3"><a href="population-prediction-and-uncertainty-quantification.html#cb869-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">residual =</span> observed_population <span class="sc">-</span> predicted_population) <span class="sc">%&gt;%</span> </span>
<span id="cb869-4"><a href="population-prediction-and-uncertainty-quantification.html#cb869-4" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb869-5"><a href="population-prediction-and-uncertainty-quantification.html#cb869-5" tabindex="-1"></a>    <span class="at">Bias=</span> <span class="fu">mean</span>(residual),</span>
<span id="cb869-6"><a href="population-prediction-and-uncertainty-quantification.html#cb869-6" tabindex="-1"></a>    <span class="at">Imprecision =</span> <span class="fu">sd</span>(residual),</span>
<span id="cb869-7"><a href="population-prediction-and-uncertainty-quantification.html#cb869-7" tabindex="-1"></a>    <span class="at">Inaccuracy =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(residual)),</span>
<span id="cb869-8"><a href="population-prediction-and-uncertainty-quantification.html#cb869-8" tabindex="-1"></a>    <span class="at">mse =</span> <span class="fu">mean</span>((residual)<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb869-9"><a href="population-prediction-and-uncertainty-quantification.html#cb869-9" tabindex="-1"></a>    <span class="at">rmse =</span> <span class="fu">sqrt</span>(mse),</span>
<span id="cb869-10"><a href="population-prediction-and-uncertainty-quantification.html#cb869-10" tabindex="-1"></a>    <span class="at">Corr =</span> <span class="fu">cor</span>(observed_population, predicted_population))</span>
<span id="cb869-11"><a href="population-prediction-and-uncertainty-quantification.html#cb869-11" tabindex="-1"></a></span>
<span id="cb869-12"><a href="population-prediction-and-uncertainty-quantification.html#cb869-12" tabindex="-1"></a>pop_metrics <span class="sc">%&gt;%</span> </span>
<span id="cb869-13"><a href="population-prediction-and-uncertainty-quantification.html#cb869-13" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">Bias</th>
<th align="right">Imprecision</th>
<th align="right">Inaccuracy</th>
<th align="right">mse</th>
<th align="right">rmse</th>
<th align="right">Corr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-157.4186</td>
<td align="right">1335.959</td>
<td align="right">518.6163</td>
<td align="right">1808445</td>
<td align="right">1344.784</td>
<td align="right">0.4172116</td>
</tr>
</tbody>
</table>
<p>Later in this section, the chosen fitted model will be used to make predictions for the whole of Cameroon at 100m resolution. In order to do this, the stacked covariates at the grid cell level are required and hence need to be loaded first.</p>
<div class="sourceCode" id="cb870"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb870-1"><a href="population-prediction-and-uncertainty-quantification.html#cb870-1" tabindex="-1"></a><span class="co">#load our stacked covariate</span></span>
<span id="cb870-2"><a href="population-prediction-and-uncertainty-quantification.html#cb870-2" tabindex="-1"></a>pred_covs <span class="ot">&lt;-</span>  <span class="fu">readRDS</span>(<span class="fu">paste0</span>(data_path, <span class="st">&quot;CMR_prediction_stack.rds&quot;</span>))</span>
<span id="cb870-3"><a href="population-prediction-and-uncertainty-quantification.html#cb870-3" tabindex="-1"></a></span>
<span id="cb870-4"><a href="population-prediction-and-uncertainty-quantification.html#cb870-4" tabindex="-1"></a><span class="co">#check variable names</span></span>
<span id="cb870-5"><a href="population-prediction-and-uncertainty-quantification.html#cb870-5" tabindex="-1"></a><span class="fu">names</span>(pred_covs)</span></code></pre></div>
<pre><code>##  [1] &quot;Country&quot;                  &quot;Regions&quot;                  &quot;Regions_libelle&quot;         
##  [4] &quot;Department&quot;               &quot;Department_libelle&quot;       &quot;CMR_buildings_count&quot;     
##  [7] &quot;CMR_buildings_total_area&quot; &quot;Settlement_Type&quot;          &quot;x3&quot;                      
## [10] &quot;x4&quot;                       &quot;x40&quot;                      &quot;x7&quot;                      
## [13] &quot;x16&quot;                      &quot;x20&quot;                      &quot;x31&quot;                     
## [16] &quot;x37&quot;                      &quot;Long&quot;                     &quot;Lat&quot;</code></pre>
<p>Once the stacked covariates are loaded, they need to be scaled. This can be done using the <code>stdsize()</code> function created earlier.</p>
<div class="sourceCode" id="cb872"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb872-1"><a href="population-prediction-and-uncertainty-quantification.html#cb872-1" tabindex="-1"></a><span class="co">#scale stacked covariates.</span></span>
<span id="cb872-2"><a href="population-prediction-and-uncertainty-quantification.html#cb872-2" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;x3&quot;</span>, <span class="st">&quot;x4&quot;</span>,  <span class="st">&quot;x7&quot;</span>,  <span class="st">&quot;x16&quot;</span>, <span class="st">&quot;x20&quot;</span>, <span class="st">&quot;x31&quot;</span>, <span class="st">&quot;x37&quot;</span>, <span class="st">&quot;x40&quot;</span>)</span>
<span id="cb872-3"><a href="population-prediction-and-uncertainty-quantification.html#cb872-3" tabindex="-1"></a>pred_covs[, vars] <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred_covs[,vars], <span class="dv">2</span>, stdise)</span>
<span id="cb872-4"><a href="population-prediction-and-uncertainty-quantification.html#cb872-4" tabindex="-1"></a></span>
<span id="cb872-5"><a href="population-prediction-and-uncertainty-quantification.html#cb872-5" tabindex="-1"></a><span class="co">#check scaled covariates</span></span>
<span id="cb872-6"><a href="population-prediction-and-uncertainty-quantification.html#cb872-6" tabindex="-1"></a><span class="fu">head</span>(pred_covs)</span></code></pre></div>
<pre><code>##   Country Regions Regions_libelle Department Department_libelle CMR_buildings_count
## 1       1       4    Extrême Nord         27    Logone et Chari                   2
## 2       1       4    Extrême Nord         27    Logone et Chari                   4
## 3       1       4    Extrême Nord         27    Logone et Chari                   4
## 4       1       4    Extrême Nord         27    Logone et Chari                   3
## 5       1       4    Extrême Nord         27    Logone et Chari                   2
## 6       1       4    Extrême Nord         27    Logone et Chari                   1
##   CMR_buildings_total_area Settlement_Type       x3         x4        x40        x7        x16        x20
## 1                 31.92027               4 3.652087 -0.1820496 -0.2584178 0.3503400 -0.9924022 -0.5053741
## 2                 59.91387               4 3.618600 -0.2862564 -0.2450828 0.3398376 -1.2439477 -0.2432839
## 3                 69.81126               4 3.617716 -0.2871699 -0.2450828 0.3398094 -1.2346939 -0.2478792
## 4                 52.94994               4 3.647733 -0.1728132 -0.2523058 0.3305358 -1.1412598 -0.6290872
## 5                 26.55466               4 3.578709 -0.3229593 -0.1988979 0.3473500 -1.2439477 -0.4677334
## 6                 11.27224               4 3.578503 -0.3236958 -0.2096400 0.3463284 -1.2439477 -0.4657714
##        x31        x37     Long      Lat
## 1 6.158775 -0.9666826 14.18500 13.04333
## 2 4.844915 -0.9666826 14.29583 13.03833
## 3 4.874303 -0.9666826 14.29583 13.03750
## 4 6.319944 -0.9666826 14.16500 13.03417
## 5 3.567499 -0.9666826 14.28917 12.99917
## 6 3.567499 -0.9666826 14.29000 12.99917</code></pre>
</div>
</div>
<div id="posterior-distribution-simulation" class="section level3 hasAnchor" number="10.2.3">
<h3><span class="header-section-number">10.2.3</span> Posterior distribution simulation<a href="population-prediction-and-uncertainty-quantification.html#posterior-distribution-simulation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Whilst it is possible to make predictions within INLA through adding covariates to the observed data as seen in Module 8, in this case, the dataset is very large and it is then preferable to make predictions outside of INLA to save computational time.</p>
<p>In order to perform grid cell level prediction, first posterior distribution simulation must take place, simulating posteriors from the parameter estimates from the chosen fitted model above. For demonstrative purposes, here only 100 posteriors will be simulated, however, the default in INLA is to sample 1000 posteriors which takes notably more computational time.</p>
<p>Samples can be taken from the posterior distribution through using the function <code>inla.posterior.sample()</code> with arguments <code>n</code> (the number of samples to be taken), <code>result</code> (the <code>inla</code> object, in this case the <code>inla</code> model <code>res</code>), <code>seed</code> (for reproducible results) and <code>num.threads</code> (the number of outer and inner threads).</p>
<div class="sourceCode" id="cb874"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb874-1"><a href="population-prediction-and-uncertainty-quantification.html#cb874-1" tabindex="-1"></a><span class="co">#sample from posterior in model</span></span>
<span id="cb874-2"><a href="population-prediction-and-uncertainty-quantification.html#cb874-2" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">inla.posterior.sample</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">result =</span> res, <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb874-3"><a href="population-prediction-and-uncertainty-quantification.html#cb874-3" tabindex="-1"></a>                                 <span class="at">num.threads =</span> <span class="st">&quot;1:1&quot;</span>)</span></code></pre></div>
<p>To easily store the various model parameters, a function can be created with the functions <code>inla.posterior.sample.eval()</code> and <code>function()</code>. Within the function, <code>get()</code> can be used, which searches by name for an object, in this case, it is used to search for the covariates of interest.</p>
<div class="sourceCode" id="cb875"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb875-1"><a href="population-prediction-and-uncertainty-quantification.html#cb875-1" tabindex="-1"></a><span class="co">#create a function to store the various model parameters</span></span>
<span id="cb875-2"><a href="population-prediction-and-uncertainty-quantification.html#cb875-2" tabindex="-1"></a>sam.extract <span class="ot">&lt;-</span> <span class="fu">inla.posterior.sample.eval</span>(</span>
<span id="cb875-3"><a href="population-prediction-and-uncertainty-quantification.html#cb875-3" tabindex="-1"></a>  (<span class="cf">function</span>(...) {</span>
<span id="cb875-4"><a href="population-prediction-and-uncertainty-quantification.html#cb875-4" tabindex="-1"></a>    beta<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="st">&quot;x3&quot;</span>)</span>
<span id="cb875-5"><a href="population-prediction-and-uncertainty-quantification.html#cb875-5" tabindex="-1"></a>    beta<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="st">&quot;x4&quot;</span>)</span>
<span id="cb875-6"><a href="population-prediction-and-uncertainty-quantification.html#cb875-6" tabindex="-1"></a>    beta<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="st">&quot;x7&quot;</span>)</span>
<span id="cb875-7"><a href="population-prediction-and-uncertainty-quantification.html#cb875-7" tabindex="-1"></a>    beta<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="st">&quot;x16&quot;</span>)</span>
<span id="cb875-8"><a href="population-prediction-and-uncertainty-quantification.html#cb875-8" tabindex="-1"></a>    beta<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="st">&quot;x20&quot;</span>)</span>
<span id="cb875-9"><a href="population-prediction-and-uncertainty-quantification.html#cb875-9" tabindex="-1"></a>    beta<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="st">&quot;x31&quot;</span>)</span>
<span id="cb875-10"><a href="population-prediction-and-uncertainty-quantification.html#cb875-10" tabindex="-1"></a>    beta<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="st">&quot;x37&quot;</span>)</span>
<span id="cb875-11"><a href="population-prediction-and-uncertainty-quantification.html#cb875-11" tabindex="-1"></a>    beta<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="st">&quot;x40&quot;</span>)</span>
<span id="cb875-12"><a href="population-prediction-and-uncertainty-quantification.html#cb875-12" tabindex="-1"></a>    prec<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="st">&quot;Settlement_Type&quot;</span>)</span>
<span id="cb875-13"><a href="population-prediction-and-uncertainty-quantification.html#cb875-13" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(Intercept, beta<span class="fl">.1</span>, beta<span class="fl">.2</span>,beta<span class="fl">.3</span>, beta<span class="fl">.4</span>, beta<span class="fl">.5</span>, beta<span class="fl">.6</span>, beta<span class="fl">.7</span>,</span>
<span id="cb875-14"><a href="population-prediction-and-uncertainty-quantification.html#cb875-14" tabindex="-1"></a>             beta<span class="fl">.8</span>, prec<span class="fl">.1</span>))</span>
<span id="cb875-15"><a href="population-prediction-and-uncertainty-quantification.html#cb875-15" tabindex="-1"></a>  }), samples)</span></code></pre></div>
<p>Once the function has been created, it can be used to return the summarised posteriors as follows.</p>
<div class="sourceCode" id="cb876"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb876-1"><a href="population-prediction-and-uncertainty-quantification.html#cb876-1" tabindex="-1"></a><span class="co">#summarised posteriors</span></span>
<span id="cb876-2"><a href="population-prediction-and-uncertainty-quantification.html#cb876-2" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(<span class="at">dig =</span> <span class="dv">4</span>, <span class="fu">rowMeans</span>(sam.extract)))  </span></code></pre></div>
<pre><code>##  fun[1]  fun[2]  fun[3]  fun[4]  fun[5]  fun[6]  fun[7]  fun[8]  fun[9] fun[10] fun[11] fun[12] fun[13] 
##  1.1828 -0.0266 -0.1047 -0.1005 -0.0558  0.1056 -0.0622 -0.0428  0.0270  0.0933 -0.0032 -0.0421 -0.0427</code></pre>
<p>The posteriors can then be saved as new objects which will make them easier to identify and use in the later steps. For the random effect for settlement types, an index can be assigned to the posteriors for the 4 different settlement types available in the data.</p>
<div class="sourceCode" id="cb878"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb878-1"><a href="population-prediction-and-uncertainty-quantification.html#cb878-1" tabindex="-1"></a><span class="co">#save posteriors as new object to make them easier to identify</span></span>
<span id="cb878-2"><a href="population-prediction-and-uncertainty-quantification.html#cb878-2" tabindex="-1"></a>Intercept <span class="ot">&lt;-</span> sam.extract[<span class="dv">1</span>, ]<span class="co">#intercept</span></span>
<span id="cb878-3"><a href="population-prediction-and-uncertainty-quantification.html#cb878-3" tabindex="-1"></a>betas <span class="ot">&lt;-</span> sam.extract[<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>, ]<span class="co">#betas</span></span>
<span id="cb878-4"><a href="population-prediction-and-uncertainty-quantification.html#cb878-4" tabindex="-1"></a>alpha_settlement_type <span class="ot">&lt;-</span> sam.extract[<span class="dv">10</span><span class="sc">:</span><span class="dv">13</span>, ]<span class="co">#random effect for settlement types</span></span>
<span id="cb878-5"><a href="population-prediction-and-uncertainty-quantification.html#cb878-5" tabindex="-1"></a></span>
<span id="cb878-6"><a href="population-prediction-and-uncertainty-quantification.html#cb878-6" tabindex="-1"></a><span class="co">#assign index to the posteriors for the settlement type</span></span>
<span id="cb878-7"><a href="population-prediction-and-uncertainty-quantification.html#cb878-7" tabindex="-1"></a>alpha_settlement_type <span class="ot">&lt;-</span> alpha_settlement_type <span class="sc">%&gt;%</span>  </span>
<span id="cb878-8"><a href="population-prediction-and-uncertainty-quantification.html#cb878-8" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb878-9"><a href="population-prediction-and-uncertainty-quantification.html#cb878-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Settlement_Type =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>))</span></code></pre></div>
<p>To make the predictions, posteriors are assigned to <code>Settlement_Type</code> using the <code>select()</code> function from the <code>dpylr</code> package and the <code>left_join()</code> function.</p>
<div class="sourceCode" id="cb879"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb879-1"><a href="population-prediction-and-uncertainty-quantification.html#cb879-1" tabindex="-1"></a><span class="co">#assign posteriors to Settlement_Type</span></span>
<span id="cb879-2"><a href="population-prediction-and-uncertainty-quantification.html#cb879-2" tabindex="-1"></a>predict_settlement_type <span class="ot">&lt;-</span> pred_covs <span class="sc">%&gt;%</span> </span>
<span id="cb879-3"><a href="population-prediction-and-uncertainty-quantification.html#cb879-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Settlement_Type)<span class="sc">%&gt;%</span> </span>
<span id="cb879-4"><a href="population-prediction-and-uncertainty-quantification.html#cb879-4" tabindex="-1"></a>  <span class="fu">left_join</span>(alpha_settlement_type, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Settlement_Type&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb879-5"><a href="population-prediction-and-uncertainty-quantification.html#cb879-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Settlement_Type) </span></code></pre></div>
<p>The spatial random component also needs to be obtained from the chosen fitted model. In order to obtain this component, the longitude (<code>Long</code>) and Latitude (<code>Lat</code>) need to be obtained from the predicted covariates (<code>pred_covs</code>) and then project the mesh (<code>meshb</code>) that was created earlier to these locations.</p>
<div class="sourceCode" id="cb880"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb880-1"><a href="population-prediction-and-uncertainty-quantification.html#cb880-1" tabindex="-1"></a><span class="co">#get the spatial effect parameter in the SPDE xy coordinate of predictions</span></span>
<span id="cb880-2"><a href="population-prediction-and-uncertainty-quantification.html#cb880-2" tabindex="-1"></a>coord1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(pred_covs<span class="sc">$</span>Long, pred_covs<span class="sc">$</span>Lat)</span>
<span id="cb880-3"><a href="population-prediction-and-uncertainty-quantification.html#cb880-3" tabindex="-1"></a></span>
<span id="cb880-4"><a href="population-prediction-and-uncertainty-quantification.html#cb880-4" tabindex="-1"></a><span class="co">#remake the A matrix for prediction</span></span>
<span id="cb880-5"><a href="population-prediction-and-uncertainty-quantification.html#cb880-5" tabindex="-1"></a>Aprediction <span class="ot">&lt;-</span> <span class="fu">inla.spde.make.A</span>(<span class="at">mesh =</span> meshb, <span class="at">loc =</span> <span class="fu">as.matrix</span>(coord1))</span>
<span id="cb880-6"><a href="population-prediction-and-uncertainty-quantification.html#cb880-6" tabindex="-1"></a><span class="fu">dim</span>(Aprediction)</span></code></pre></div>
<pre><code>## [1] 1327458   11692</code></pre>
<p>The next step is to get the spatial effect parameter from the model through, this can be done through extracting the <code>spatial_effect</code> from the <code>summary.random</code> part of the model and specifying that the <code>mean</code> will be subset.</p>
<div class="sourceCode" id="cb882"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb882-1"><a href="population-prediction-and-uncertainty-quantification.html#cb882-1" tabindex="-1"></a><span class="co">#get the spatial effect parameter from the model</span></span>
<span id="cb882-2"><a href="population-prediction-and-uncertainty-quantification.html#cb882-2" tabindex="-1"></a>sfield_nodes <span class="ot">&lt;-</span> res<span class="sc">$</span>summary.random<span class="sc">$</span>spatial_effect[<span class="st">&#39;mean&#39;</span>]</span>
<span id="cb882-3"><a href="population-prediction-and-uncertainty-quantification.html#cb882-3" tabindex="-1"></a><span class="fu">dim</span>(sfield_nodes)</span></code></pre></div>
<pre><code>## [1] 11692     1</code></pre>
<p>The resulting spatial effect parameter can be given as a data frame and combined with the projected matrix <code>Aprediction</code> to estimate the values for the spatial component.</p>
<div class="sourceCode" id="cb884"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb884-1"><a href="population-prediction-and-uncertainty-quantification.html#cb884-1" tabindex="-1"></a><span class="co">#estimate the values for the spatial component in the prediction covs</span></span>
<span id="cb884-2"><a href="population-prediction-and-uncertainty-quantification.html#cb884-2" tabindex="-1"></a>spatial_field <span class="ot">&lt;-</span> (Aprediction <span class="sc">%*%</span> <span class="fu">as.data.frame</span>(sfield_nodes)[, <span class="dv">1</span>])</span></code></pre></div>
<p>Predictions for the covariates using their coefficients (the betas) that were extracted above can then be made, once again through using the <code>select()</code> function to obtain the covariate information. It is important to replace the NA values with 0 as otherwise numerical issues can occur given that R often works better with zeroes than with missing values. Given that anything (the betas in this case) multiplied by 0 is still 0, the final result is not changed by changing the missing values to zero.</p>
<div class="sourceCode" id="cb885"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb885-1"><a href="population-prediction-and-uncertainty-quantification.html#cb885-1" tabindex="-1"></a><span class="co">#extract covariates and convert it to a matrix</span></span>
<span id="cb885-2"><a href="population-prediction-and-uncertainty-quantification.html#cb885-2" tabindex="-1"></a>cov_fixed <span class="ot">&lt;-</span> pred_covs <span class="sc">%&gt;%</span> </span>
<span id="cb885-3"><a href="population-prediction-and-uncertainty-quantification.html#cb885-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(x3, x4, x7, x16, x20, x31, x37, x40) <span class="sc">%&gt;%</span> </span>
<span id="cb885-4"><a href="population-prediction-and-uncertainty-quantification.html#cb885-4" tabindex="-1"></a>  <span class="co">#avoid numerical issues with the following line</span></span>
<span id="cb885-5"><a href="population-prediction-and-uncertainty-quantification.html#cb885-5" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">&quot;x&quot;</span>)), <span class="sc">~</span><span class="fu">replace</span>(., <span class="fu">is.na</span>(.), <span class="dv">0</span>)) <span class="sc">%&gt;%</span>  </span>
<span id="cb885-6"><a href="population-prediction-and-uncertainty-quantification.html#cb885-6" tabindex="-1"></a>  <span class="fu">as.matrix</span>() </span>
<span id="cb885-7"><a href="population-prediction-and-uncertainty-quantification.html#cb885-7" tabindex="-1"></a></span>
<span id="cb885-8"><a href="population-prediction-and-uncertainty-quantification.html#cb885-8" tabindex="-1"></a><span class="fu">dim</span>(cov_fixed)</span></code></pre></div>
<pre><code>## [1] 1327458       8</code></pre>
<p>To predict the (fixed effect) covariates, the estimated beta parameters can be multiplied with their respective covariates and then converted to a data frame with the <code>as_tibble()</code> function.</p>
<div class="sourceCode" id="cb887"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb887-1"><a href="population-prediction-and-uncertainty-quantification.html#cb887-1" tabindex="-1"></a><span class="co">#predict fixed effect covariates</span></span>
<span id="cb887-2"><a href="population-prediction-and-uncertainty-quantification.html#cb887-2" tabindex="-1"></a>cov_fixed <span class="ot">&lt;-</span> cov_fixed <span class="sc">%*%</span> betas </span>
<span id="cb887-3"><a href="population-prediction-and-uncertainty-quantification.html#cb887-3" tabindex="-1"></a></span>
<span id="cb887-4"><a href="population-prediction-and-uncertainty-quantification.html#cb887-4" tabindex="-1"></a><span class="co">#convert to data frame</span></span>
<span id="cb887-5"><a href="population-prediction-and-uncertainty-quantification.html#cb887-5" tabindex="-1"></a>cov_fixed <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(cov_fixed) </span></code></pre></div>
<p>Given that there is now a value for the intercept, fixed effect (based on the covariates), random effect for the settlement type and the spatial random effect, the model component can be added for the prediction.</p>
<p>Since a gamma distribution was used in the fitting of the model, for the predicted posterior density estimates, the predicted density must be back transformed with the exponential function.</p>
<div class="sourceCode" id="cb888"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb888-1"><a href="population-prediction-and-uncertainty-quantification.html#cb888-1" tabindex="-1"></a><span class="co">#predicted posterior density</span></span>
<span id="cb888-2"><a href="population-prediction-and-uncertainty-quantification.html#cb888-2" tabindex="-1"></a>predicted_density <span class="ot">&lt;-</span> <span class="fu">exp</span>(Intercept <span class="sc">+</span> cov_fixed <span class="sc">+</span> predict_settlement_type <span class="sc">+</span> </span>
<span id="cb888-3"><a href="population-prediction-and-uncertainty-quantification.html#cb888-3" tabindex="-1"></a>                           spatial_field[,<span class="dv">1</span>])    </span></code></pre></div>
<p>The <code>mutate()</code> function is then used to add the building count for each grid, followed by estimating the predicted population.</p>
<div class="sourceCode" id="cb889"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb889-1"><a href="population-prediction-and-uncertainty-quantification.html#cb889-1" tabindex="-1"></a><span class="co">#add building count for each grid</span></span>
<span id="cb889-2"><a href="population-prediction-and-uncertainty-quantification.html#cb889-2" tabindex="-1"></a>predicted_density <span class="ot">&lt;-</span> predicted_density <span class="sc">%&gt;%</span> </span>
<span id="cb889-3"><a href="population-prediction-and-uncertainty-quantification.html#cb889-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">buidling_count =</span> pred_covs<span class="sc">$</span>CMR_buildings_count)</span>
<span id="cb889-4"><a href="population-prediction-and-uncertainty-quantification.html#cb889-4" tabindex="-1"></a></span>
<span id="cb889-5"><a href="population-prediction-and-uncertainty-quantification.html#cb889-5" tabindex="-1"></a><span class="co">#estimate predicted population</span></span>
<span id="cb889-6"><a href="population-prediction-and-uncertainty-quantification.html#cb889-6" tabindex="-1"></a>predicted_pop <span class="ot">&lt;-</span> predicted_density <span class="sc">%&gt;%</span></span>
<span id="cb889-7"><a href="population-prediction-and-uncertainty-quantification.html#cb889-7" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">&quot;sample&quot;</span>)), <span class="sc">~</span> . <span class="sc">*</span> buidling_count) <span class="sc">%&gt;%</span> </span>
<span id="cb889-8"><a href="population-prediction-and-uncertainty-quantification.html#cb889-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>buidling_count)</span></code></pre></div>
<p>In order to compute the predicted population for the entire study, the predicted population using the mean needs to be summarised, as well as finding the quantiles which correspond to the uncertainty, where the summarising can be done using the <code>summarise()</code> function.</p>
<div class="sourceCode" id="cb890"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb890-1"><a href="population-prediction-and-uncertainty-quantification.html#cb890-1" tabindex="-1"></a><span class="co">#total predicted population and uncertainty</span></span>
<span id="cb890-2"><a href="population-prediction-and-uncertainty-quantification.html#cb890-2" tabindex="-1"></a>CMR_Total_Pop <span class="ot">&lt;-</span> predicted_pop <span class="sc">%&gt;%</span> </span>
<span id="cb890-3"><a href="population-prediction-and-uncertainty-quantification.html#cb890-3" tabindex="-1"></a>  <span class="fu">apply</span>(<span class="dv">2</span>, sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb890-4"><a href="population-prediction-and-uncertainty-quantification.html#cb890-4" tabindex="-1"></a>  <span class="fu">as_tibble</span>()<span class="sc">%&gt;%</span> </span>
<span id="cb890-5"><a href="population-prediction-and-uncertainty-quantification.html#cb890-5" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_population =</span> <span class="fu">round</span>(<span class="fu">mean</span>(value)),</span>
<span id="cb890-6"><a href="population-prediction-and-uncertainty-quantification.html#cb890-6" tabindex="-1"></a>            <span class="at">upper_quantile =</span> <span class="fu">round</span>(<span class="fu">quantile</span>(value, <span class="at">probs=</span><span class="fl">0.975</span>)),</span>
<span id="cb890-7"><a href="population-prediction-and-uncertainty-quantification.html#cb890-7" tabindex="-1"></a>            <span class="at">lower_quantile =</span> <span class="fu">round</span>(<span class="fu">quantile</span>(value, <span class="at">probs =</span><span class="fl">0.025</span>)))</span>
<span id="cb890-8"><a href="population-prediction-and-uncertainty-quantification.html#cb890-8" tabindex="-1"></a></span>
<span id="cb890-9"><a href="population-prediction-and-uncertainty-quantification.html#cb890-9" tabindex="-1"></a>CMR_Total_Pop <span class="sc">%&gt;%</span> </span>
<span id="cb890-10"><a href="population-prediction-and-uncertainty-quantification.html#cb890-10" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">mean_population</th>
<th align="right">upper_quantile</th>
<th align="right">lower_quantile</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">31438878</td>
<td align="right">35486909</td>
<td align="right">27569181</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="aggregation-to-area-units-of-interest-and-uncertainty-quantification" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">10.3</span> Aggregation to area units of interest and uncertainty quantification<a href="population-prediction-and-uncertainty-quantification.html#aggregation-to-area-units-of-interest-and-uncertainty-quantification" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The focus of this section is on quantifying the uncertainty resulting from high-resolution population estimates through using a Bayesian hierarchical modelling framework. In addition to providing the point estimates, the model generates full posterior distributions for each 100 grid cell which enables a probabilistic understanding of the population size. These uncertainty measures are able to be aggregated across any spatial scale and are crucial for informed decision-making, particularly in regions where the census data is sparse or outdated. Traditional census-based estimates often overlook or fail to report their inherent uncertainties, which may lead users into assuming false precision.</p>
<p>To estimate the population totals and uncertainty at the various admin levels, the following code can be used.</p>
<p>First, obtain the region names and <code>cbind()</code> them to the predicted population.</p>
<div class="sourceCode" id="cb891"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb891-1"><a href="population-prediction-and-uncertainty-quantification.html#cb891-1" tabindex="-1"></a><span class="co">#get region names</span></span>
<span id="cb891-2"><a href="population-prediction-and-uncertainty-quantification.html#cb891-2" tabindex="-1"></a>region_names <span class="ot">&lt;-</span> pred_covs <span class="sc">%&gt;%</span> </span>
<span id="cb891-3"><a href="population-prediction-and-uncertainty-quantification.html#cb891-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Regions_libelle)</span>
<span id="cb891-4"><a href="population-prediction-and-uncertainty-quantification.html#cb891-4" tabindex="-1"></a></span>
<span id="cb891-5"><a href="population-prediction-and-uncertainty-quantification.html#cb891-5" tabindex="-1"></a><span class="co">#cbind names to predictions</span></span>
<span id="cb891-6"><a href="population-prediction-and-uncertainty-quantification.html#cb891-6" tabindex="-1"></a>region_estimates <span class="ot">&lt;-</span> <span class="fu">cbind</span>(predicted_pop, region_names) <span class="sc">%&gt;%</span> </span>
<span id="cb891-7"><a href="population-prediction-and-uncertainty-quantification.html#cb891-7" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<p>Then, for easy processing, the names of the regions can be grouped with the <code>group_by()</code> function and split the data with the <code>group_split()</code> function.</p>
<div class="sourceCode" id="cb892"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb892-1"><a href="population-prediction-and-uncertainty-quantification.html#cb892-1" tabindex="-1"></a><span class="co">#group and split the data</span></span>
<span id="cb892-2"><a href="population-prediction-and-uncertainty-quantification.html#cb892-2" tabindex="-1"></a>region_estimates <span class="ot">&lt;-</span> region_estimates <span class="sc">%&gt;%</span> </span>
<span id="cb892-3"><a href="population-prediction-and-uncertainty-quantification.html#cb892-3" tabindex="-1"></a>  <span class="fu">group_by</span>(Regions_libelle) <span class="sc">%&gt;%</span> </span>
<span id="cb892-4"><a href="population-prediction-and-uncertainty-quantification.html#cb892-4" tabindex="-1"></a>  <span class="fu">group_split</span>()</span></code></pre></div>
<p>The following for loop is then used to get the estimates and and the credible intervals for each of the regions.</p>
<div class="sourceCode" id="cb893"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb893-1"><a href="population-prediction-and-uncertainty-quantification.html#cb893-1" tabindex="-1"></a><span class="co">#get estimates and credible intervals </span></span>
<span id="cb893-2"><a href="population-prediction-and-uncertainty-quantification.html#cb893-2" tabindex="-1"></a>OUT <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb893-3"><a href="population-prediction-and-uncertainty-quantification.html#cb893-3" tabindex="-1"></a><span class="cf">for</span>(dd <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(region_estimates)){</span>
<span id="cb893-4"><a href="population-prediction-and-uncertainty-quantification.html#cb893-4" tabindex="-1"></a>  df <span class="ot">&lt;-</span> region_estimates[[dd]]</span>
<span id="cb893-5"><a href="population-prediction-and-uncertainty-quantification.html#cb893-5" tabindex="-1"></a>  </span>
<span id="cb893-6"><a href="population-prediction-and-uncertainty-quantification.html#cb893-6" tabindex="-1"></a>  <span class="co">#get the ID of the current region being processed</span></span>
<span id="cb893-7"><a href="population-prediction-and-uncertainty-quantification.html#cb893-7" tabindex="-1"></a>  typro <span class="ot">&lt;-</span> <span class="fu">unique</span>(df<span class="sc">$</span>Regions_libelle)</span>
<span id="cb893-8"><a href="population-prediction-and-uncertainty-quantification.html#cb893-8" tabindex="-1"></a>  <span class="fu">print</span>(typro)</span>
<span id="cb893-9"><a href="population-prediction-and-uncertainty-quantification.html#cb893-9" tabindex="-1"></a>  </span>
<span id="cb893-10"><a href="population-prediction-and-uncertainty-quantification.html#cb893-10" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb893-11"><a href="population-prediction-and-uncertainty-quantification.html#cb893-11" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;sample&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb893-12"><a href="population-prediction-and-uncertainty-quantification.html#cb893-12" tabindex="-1"></a>    <span class="fu">apply</span>(<span class="dv">2</span>, sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)  </span>
<span id="cb893-13"><a href="population-prediction-and-uncertainty-quantification.html#cb893-13" tabindex="-1"></a>  </span>
<span id="cb893-14"><a href="population-prediction-and-uncertainty-quantification.html#cb893-14" tabindex="-1"></a>  OUT[[dd]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Health_Area_Names =</span> typro, <span class="at">mean =</span> <span class="fu">mean</span>(df),</span>
<span id="cb893-15"><a href="population-prediction-and-uncertainty-quantification.html#cb893-15" tabindex="-1"></a>                 <span class="at">lower_quantile =</span> <span class="fu">quantile</span>(df, <span class="fl">0.025</span>),</span>
<span id="cb893-16"><a href="population-prediction-and-uncertainty-quantification.html#cb893-16" tabindex="-1"></a>                 <span class="at">upper_quantile =</span> <span class="fu">quantile</span>(df, <span class="fl">0.975</span>),</span>
<span id="cb893-17"><a href="population-prediction-and-uncertainty-quantification.html#cb893-17" tabindex="-1"></a>                 <span class="at">median =</span> <span class="fu">quantile</span>(df, <span class="fl">0.500</span>))</span>
<span id="cb893-18"><a href="population-prediction-and-uncertainty-quantification.html#cb893-18" tabindex="-1"></a>  </span>
<span id="cb893-19"><a href="population-prediction-and-uncertainty-quantification.html#cb893-19" tabindex="-1"></a>  <span class="co">#print(OUT)</span></span>
<span id="cb893-20"><a href="population-prediction-and-uncertainty-quantification.html#cb893-20" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;Adamaoua&quot;
## [1] &quot;Centre&quot;
## [1] &quot;Est&quot;
## [1] &quot;Extrême Nord&quot;
## [1] &quot;Littoral&quot;
## [1] &quot;Nord&quot;
## [1] &quot;Nord Ouest&quot;
## [1] &quot;Ouest&quot;
## [1] &quot;Sud&quot;
## [1] &quot;Sud Ouest&quot;</code></pre>
<div class="sourceCode" id="cb895"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb895-1"><a href="population-prediction-and-uncertainty-quantification.html#cb895-1" tabindex="-1"></a>region_population <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, OUT)</span>
<span id="cb895-2"><a href="population-prediction-and-uncertainty-quantification.html#cb895-2" tabindex="-1"></a>region_population <span class="sc">%&gt;%</span> </span>
<span id="cb895-3"><a href="population-prediction-and-uncertainty-quantification.html#cb895-3" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="19%" />
<col width="18%" />
<col width="21%" />
<col width="22%" />
<col width="18%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Health_Area_Names</th>
<th align="left">mean</th>
<th align="left">lower_quantile.2.5%</th>
<th align="left">upper_quantile.97.5%</th>
<th align="left">median.50%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Adamaoua</td>
<td align="left">1656233.13457392</td>
<td align="left">1397448.19572542</td>
<td align="left">1975569.98280791</td>
<td align="left">1634858.39162699</td>
</tr>
<tr class="even">
<td align="left">Centre</td>
<td align="left">5240829.83168103</td>
<td align="left">4169786.03848485</td>
<td align="left">6728065.26384402</td>
<td align="left">5246897.68185082</td>
</tr>
<tr class="odd">
<td align="left">Est</td>
<td align="left">1469676.34802464</td>
<td align="left">1264836.64270952</td>
<td align="left">1694937.1175424</td>
<td align="left">1460197.68508379</td>
</tr>
<tr class="even">
<td align="left">Extrême Nord</td>
<td align="left">5321809.9097725</td>
<td align="left">4456588.19561609</td>
<td align="left">6295653.85743602</td>
<td align="left">5231717.09842551</td>
</tr>
<tr class="odd">
<td align="left">Littoral</td>
<td align="left">5306061.36502468</td>
<td align="left">3301251.8711992</td>
<td align="left">7325935.42445482</td>
<td align="left">5126804.49795949</td>
</tr>
<tr class="even">
<td align="left">Nord</td>
<td align="left">3464449.10907342</td>
<td align="left">2944790.23293535</td>
<td align="left">4051975.0819395</td>
<td align="left">3447535.52901116</td>
</tr>
<tr class="odd">
<td align="left">Nord Ouest</td>
<td align="left">1410147.10329959</td>
<td align="left">1138622.90622669</td>
<td align="left">1737330.6527433</td>
<td align="left">1394107.61986643</td>
</tr>
<tr class="even">
<td align="left">Ouest</td>
<td align="left">2906398.85726453</td>
<td align="left">2549972.16639807</td>
<td align="left">3297339.00776236</td>
<td align="left">2905888.44559432</td>
</tr>
<tr class="odd">
<td align="left">Sud</td>
<td align="left">1155513.29605593</td>
<td align="left">932777.803044887</td>
<td align="left">1483673.28523653</td>
<td align="left">1148944.86372355</td>
</tr>
<tr class="even">
<td align="left">Sud Ouest</td>
<td align="left">3507758.91094667</td>
<td align="left">2554022.47544692</td>
<td align="left">4698940.44909301</td>
<td align="left">3438697.55742504</td>
</tr>
</tbody>
</table>
<p>Finally, the regional estimates can be exported as a <code>.csv</code> file with the <code>write.csv()</code> function.</p>
<div class="sourceCode" id="cb896"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb896-1"><a href="population-prediction-and-uncertainty-quantification.html#cb896-1" tabindex="-1"></a><span class="co">#export the regional estimate as a .csv file</span></span>
<span id="cb896-2"><a href="population-prediction-and-uncertainty-quantification.html#cb896-2" tabindex="-1"></a><span class="fu">write.csv</span>(region_population, <span class="fu">paste0</span>(output_path, <span class="st">&quot;Regional Estimate.csv&quot;</span>))</span></code></pre></div>
<div id="rasterising-the-predictions-at-grid-cell-level" class="section level3 hasAnchor" number="10.3.1">
<h3><span class="header-section-number">10.3.1</span> Rasterising the predictions at grid cell level<a href="population-prediction-and-uncertainty-quantification.html#rasterising-the-predictions-at-grid-cell-level" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The final stage of grid cell level prediction is to rasterise the resulting predicted population to a 100m resolution and find the corresponding credible intervals for the uncertainty quantification before exporting the results.</p>
<p>To begin with this final stage, the pixel level predictions are summarised as follows.</p>
<div class="sourceCode" id="cb897"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb897-1"><a href="population-prediction-and-uncertainty-quantification.html#cb897-1" tabindex="-1"></a><span class="co">#summarise pixel level predictions</span></span>
<span id="cb897-2"><a href="population-prediction-and-uncertainty-quantification.html#cb897-2" tabindex="-1"></a></span>
<span id="cb897-3"><a href="population-prediction-and-uncertainty-quantification.html#cb897-3" tabindex="-1"></a><span class="co">#mean population</span></span>
<span id="cb897-4"><a href="population-prediction-and-uncertainty-quantification.html#cb897-4" tabindex="-1"></a>mean_population <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(predicted_pop, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb897-5"><a href="population-prediction-and-uncertainty-quantification.html#cb897-5" tabindex="-1"></a><span class="co">#median population</span></span>
<span id="cb897-6"><a href="population-prediction-and-uncertainty-quantification.html#cb897-6" tabindex="-1"></a>median_population <span class="ot">&lt;-</span> <span class="fu">apply</span>(predicted_pop, <span class="dv">1</span>, </span>
<span id="cb897-7"><a href="population-prediction-and-uncertainty-quantification.html#cb897-7" tabindex="-1"></a>                           <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">quantile</span>(x, <span class="at">probs =</span> <span class="fl">0.5</span>, </span>
<span id="cb897-8"><a href="population-prediction-and-uncertainty-quantification.html#cb897-8" tabindex="-1"></a>                                                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb897-9"><a href="population-prediction-and-uncertainty-quantification.html#cb897-9" tabindex="-1"></a><span class="co">#standard deviation of population</span></span>
<span id="cb897-10"><a href="population-prediction-and-uncertainty-quantification.html#cb897-10" tabindex="-1"></a>std_population <span class="ot">&lt;-</span> <span class="fu">apply</span>(predicted_pop, <span class="dv">1</span>, sd)</span>
<span id="cb897-11"><a href="population-prediction-and-uncertainty-quantification.html#cb897-11" tabindex="-1"></a><span class="co">#lower quantile for credible interval</span></span>
<span id="cb897-12"><a href="population-prediction-and-uncertainty-quantification.html#cb897-12" tabindex="-1"></a>lower_quantile <span class="ot">&lt;-</span> <span class="fu">apply</span>(predicted_pop, <span class="dv">1</span>,</span>
<span id="cb897-13"><a href="population-prediction-and-uncertainty-quantification.html#cb897-13" tabindex="-1"></a>                        <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">quantile</span>(x, <span class="at">probs =</span> <span class="fl">0.025</span>, </span>
<span id="cb897-14"><a href="population-prediction-and-uncertainty-quantification.html#cb897-14" tabindex="-1"></a>                                                   <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb897-15"><a href="population-prediction-and-uncertainty-quantification.html#cb897-15" tabindex="-1"></a><span class="co">#upper quantile for credible interval</span></span>
<span id="cb897-16"><a href="population-prediction-and-uncertainty-quantification.html#cb897-16" tabindex="-1"></a>upper_quantile <span class="ot">&lt;-</span> <span class="fu">apply</span>(predicted_pop, <span class="dv">1</span>, </span>
<span id="cb897-17"><a href="population-prediction-and-uncertainty-quantification.html#cb897-17" tabindex="-1"></a>                        <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">quantile</span>(x, <span class="at">probs =</span> <span class="fl">0.975</span>,</span>
<span id="cb897-18"><a href="population-prediction-and-uncertainty-quantification.html#cb897-18" tabindex="-1"></a>                                                   <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb897-19"><a href="population-prediction-and-uncertainty-quantification.html#cb897-19" tabindex="-1"></a><span class="co">#uncertainty quantification</span></span>
<span id="cb897-20"><a href="population-prediction-and-uncertainty-quantification.html#cb897-20" tabindex="-1"></a>uncertainty <span class="ot">=</span> (upper_quantile <span class="sc">-</span> lower_quantile)<span class="sc">/</span>mean_population</span>
<span id="cb897-21"><a href="population-prediction-and-uncertainty-quantification.html#cb897-21" tabindex="-1"></a><span class="co">#coefficient of variation</span></span>
<span id="cb897-22"><a href="population-prediction-and-uncertainty-quantification.html#cb897-22" tabindex="-1"></a>coe_var <span class="ot">=</span> std_population<span class="sc">/</span>mean_population</span></code></pre></div>
<p>The resulting mean and median populations can be summed for the overall population size estimates.</p>
<div class="sourceCode" id="cb898"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb898-1"><a href="population-prediction-and-uncertainty-quantification.html#cb898-1" tabindex="-1"></a><span class="co">#sum predictions</span></span>
<span id="cb898-2"><a href="population-prediction-and-uncertainty-quantification.html#cb898-2" tabindex="-1"></a><span class="fu">sum</span>(median_population, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 30995326</code></pre>
<div class="sourceCode" id="cb900"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb900-1"><a href="population-prediction-and-uncertainty-quantification.html#cb900-1" tabindex="-1"></a><span class="fu">sum</span>(mean_population, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 31438878</code></pre>
<p>Before the rasterisation, the predictions must be combined with the <code>cbind()</code> function to the xy coordinates.</p>
<div class="sourceCode" id="cb902"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb902-1"><a href="population-prediction-and-uncertainty-quantification.html#cb902-1" tabindex="-1"></a><span class="co">#cbind predictions to xy coordinates</span></span>
<span id="cb902-2"><a href="population-prediction-and-uncertainty-quantification.html#cb902-2" tabindex="-1"></a>pixel_predictions <span class="ot">&lt;-</span> <span class="fu">cbind</span>(mean_population, median_population, std_population,</span>
<span id="cb902-3"><a href="population-prediction-and-uncertainty-quantification.html#cb902-3" tabindex="-1"></a>                           lower_quantile, upper_quantile, </span>
<span id="cb902-4"><a href="population-prediction-and-uncertainty-quantification.html#cb902-4" tabindex="-1"></a>                           uncertainty, coe_var) <span class="sc">%&gt;%</span> </span>
<span id="cb902-5"><a href="population-prediction-and-uncertainty-quantification.html#cb902-5" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb902-6"><a href="population-prediction-and-uncertainty-quantification.html#cb902-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> pred_covs<span class="sc">$</span>Long, <span class="at">y =</span> pred_covs<span class="sc">$</span>Lat)</span></code></pre></div>
<p>The country raster can then be loaded and used as a mastergrid for the rasterisation process. It is important to note that this is just one method of carrying out the rasterisation process, and there are other methods available.</p>
<div class="sourceCode" id="cb903"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb903-1"><a href="population-prediction-and-uncertainty-quantification.html#cb903-1" tabindex="-1"></a><span class="co">#load country raster</span></span>
<span id="cb903-2"><a href="population-prediction-and-uncertainty-quantification.html#cb903-2" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">paste0</span>(data_path, <span class="st">&quot;CMR_Regions.tif&quot;</span>))</span>
<span id="cb903-3"><a href="population-prediction-and-uncertainty-quantification.html#cb903-3" tabindex="-1"></a><span class="fu">plot</span>(r1)</span></code></pre></div>
<p><img src="WorldPop_Training_Manual_files/figure-html/load%20country%20raster-1.png" width="672" /></p>
<p>The above predictions are then converted with the <code>st_as_st()</code> function to an sf object and the <code>st_crs()</code> function is used to set the CRS of the resulting sf object.</p>
<div class="sourceCode" id="cb904"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb904-1"><a href="population-prediction-and-uncertainty-quantification.html#cb904-1" tabindex="-1"></a><span class="co">#convert pixel_predictions to an sf object</span></span>
<span id="cb904-2"><a href="population-prediction-and-uncertainty-quantification.html#cb904-2" tabindex="-1"></a>pop_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(pixel_predictions, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>))</span>
<span id="cb904-3"><a href="population-prediction-and-uncertainty-quantification.html#cb904-3" tabindex="-1"></a></span>
<span id="cb904-4"><a href="population-prediction-and-uncertainty-quantification.html#cb904-4" tabindex="-1"></a><span class="co">#set the CRS of the sf object</span></span>
<span id="cb904-5"><a href="population-prediction-and-uncertainty-quantification.html#cb904-5" tabindex="-1"></a><span class="fu">st_crs</span>(pop_sf) <span class="ot">&lt;-</span> <span class="dv">4326</span></span></code></pre></div>
<p>The final step before the rasterisation is to re-project to the raster spatial reference with the <code>st_transform()</code> object.</p>
<div class="sourceCode" id="cb905"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb905-1"><a href="population-prediction-and-uncertainty-quantification.html#cb905-1" tabindex="-1"></a><span class="co">#re-project to raster spatial reference</span></span>
<span id="cb905-2"><a href="population-prediction-and-uncertainty-quantification.html#cb905-2" tabindex="-1"></a>pop_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(pop_sf, <span class="at">crs =</span> <span class="fu">st_crs</span>(r1))</span></code></pre></div>
<p>Finally, the <code>rasterise()</code> function is used to rasterise the mean population as well as the upper and lower limits contained within the sf object. For each result, the function <code>writeRaster()</code> is used to export the results. Whilst only the mean population and credible interval limits are rasterised here, other population measures such as the standard deviation, coefficient of variation and median population can also be rasterised in the same way,</p>
<div class="sourceCode" id="cb906"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb906-1"><a href="population-prediction-and-uncertainty-quantification.html#cb906-1" tabindex="-1"></a><span class="co">#rasterise mean population</span></span>
<span id="cb906-2"><a href="population-prediction-and-uncertainty-quantification.html#cb906-2" tabindex="-1"></a>mean_pop_raster <span class="ot">&lt;-</span> <span class="fu">rasterize</span>(pop_sf, r1, <span class="at">field =</span> <span class="st">&quot;mean_population&quot;</span>)</span>
<span id="cb906-3"><a href="population-prediction-and-uncertainty-quantification.html#cb906-3" tabindex="-1"></a><span class="fu">plot</span>(mean_pop_raster)</span></code></pre></div>
<p><img src="WorldPop_Training_Manual_files/figure-html/rasterise-1.png" width="672" /></p>
<div class="sourceCode" id="cb907"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb907-1"><a href="population-prediction-and-uncertainty-quantification.html#cb907-1" tabindex="-1"></a><span class="fu">writeRaster</span>(mean_pop_raster, <span class="fu">paste0</span>(output_path, <span class="st">&quot;total_population_raster.tif&quot;</span>), </span>
<span id="cb907-2"><a href="population-prediction-and-uncertainty-quantification.html#cb907-2" tabindex="-1"></a>            <span class="at">overwrite =</span> <span class="cn">TRUE</span>, <span class="at">names =</span> <span class="st">&quot;Population&quot;</span>)</span>
<span id="cb907-3"><a href="population-prediction-and-uncertainty-quantification.html#cb907-3" tabindex="-1"></a></span>
<span id="cb907-4"><a href="population-prediction-and-uncertainty-quantification.html#cb907-4" tabindex="-1"></a><span class="co">#rasterise Upper</span></span>
<span id="cb907-5"><a href="population-prediction-and-uncertainty-quantification.html#cb907-5" tabindex="-1"></a>upper_pop_raster <span class="ot">&lt;-</span> <span class="fu">rasterize</span>(pop_sf, r1, <span class="at">field =</span> <span class="st">&quot;upper_quantile&quot;</span>)</span>
<span id="cb907-6"><a href="population-prediction-and-uncertainty-quantification.html#cb907-6" tabindex="-1"></a><span class="fu">plot</span>(upper_pop_raster)</span></code></pre></div>
<p><img src="WorldPop_Training_Manual_files/figure-html/rasterise-2.png" width="672" /></p>
<div class="sourceCode" id="cb908"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb908-1"><a href="population-prediction-and-uncertainty-quantification.html#cb908-1" tabindex="-1"></a><span class="fu">writeRaster</span>(upper_pop_raster, <span class="fu">paste0</span>(output_path, <span class="st">&quot;population_Upper.tif&quot;</span>), </span>
<span id="cb908-2"><a href="population-prediction-and-uncertainty-quantification.html#cb908-2" tabindex="-1"></a>            <span class="at">overwrite =</span> <span class="cn">TRUE</span>, <span class="at">names =</span> <span class="st">&quot;Population_Upper&quot;</span>)</span>
<span id="cb908-3"><a href="population-prediction-and-uncertainty-quantification.html#cb908-3" tabindex="-1"></a></span>
<span id="cb908-4"><a href="population-prediction-and-uncertainty-quantification.html#cb908-4" tabindex="-1"></a><span class="co">#rasterise lower</span></span>
<span id="cb908-5"><a href="population-prediction-and-uncertainty-quantification.html#cb908-5" tabindex="-1"></a>lower_pop_raster <span class="ot">&lt;-</span> <span class="fu">rasterize</span>(pop_sf, r1, <span class="at">field =</span> <span class="st">&quot;lower_quantile&quot;</span>)</span>
<span id="cb908-6"><a href="population-prediction-and-uncertainty-quantification.html#cb908-6" tabindex="-1"></a><span class="fu">plot</span>(lower_pop_raster)</span></code></pre></div>
<p><img src="WorldPop_Training_Manual_files/figure-html/rasterise-3.png" width="672" /></p>
<div class="sourceCode" id="cb909"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb909-1"><a href="population-prediction-and-uncertainty-quantification.html#cb909-1" tabindex="-1"></a><span class="fu">writeRaster</span>(lower_pop_raster, <span class="fu">paste0</span>(output_path, <span class="st">&quot;population_Lower.tif&quot;</span>), </span>
<span id="cb909-2"><a href="population-prediction-and-uncertainty-quantification.html#cb909-2" tabindex="-1"></a>            <span class="at">overwrite =</span> <span class="cn">TRUE</span>, <span class="at">names =</span> <span class="st">&quot;Population_Lower&quot;</span>)</span></code></pre></div>
<p>It is good practice to check whether the rasters have the resolution, extent and coordinate reference, this can be done simply by printing the rasters themselves and checking their summaries as seen below. For these two rasters, the resolution, extent and coordinate references are identical, and therefore the rasters are spatially aligned and can be used for the predictions.</p>
<div class="sourceCode" id="cb910"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb910-1"><a href="population-prediction-and-uncertainty-quantification.html#cb910-1" tabindex="-1"></a><span class="co">#mean population raster</span></span>
<span id="cb910-2"><a href="population-prediction-and-uncertainty-quantification.html#cb910-2" tabindex="-1"></a>mean_pop_raster</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 13710, 9231, 1  (nrow, ncol, nlyr)
## resolution  : 0.0008333333, 0.0008333333  (x, y)
## extent      : 8.497917, 16.19042, 1.652917, 13.07792  (xmin, xmax, ymin, ymax)
## coord. ref. : lon/lat WGS 84 (EPSG:4326) 
## source(s)   : memory
## varname     : CMR_Regions 
## name        :         last 
## min value   :    0.6243253 
## max value   : 6223.3237246</code></pre>
<div class="sourceCode" id="cb912"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb912-1"><a href="population-prediction-and-uncertainty-quantification.html#cb912-1" tabindex="-1"></a><span class="co">#country raster</span></span>
<span id="cb912-2"><a href="population-prediction-and-uncertainty-quantification.html#cb912-2" tabindex="-1"></a>r1</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 13710, 9231, 1  (nrow, ncol, nlyr)
## resolution  : 0.0008333333, 0.0008333333  (x, y)
## extent      : 8.497917, 16.19042, 1.652917, 13.07792  (xmin, xmax, ymin, ymax)
## coord. ref. : lon/lat WGS 84 (EPSG:4326) 
## source      : CMR_Regions.tif 
## name        : Regions 
## min value   :       1 
## max value   :      10</code></pre>
</div>
</div>
<div id="useful-resources-8" class="section level2 hasAnchor" number="10.4">
<h2><span class="header-section-number">10.4</span> Useful resources<a href="population-prediction-and-uncertainty-quantification.html#useful-resources-8" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Overall: <a href="https://www.southampton.ac.uk/~sks/bmbook/bmstdr.pdf">Bayesian Modelling of Spatio Temporal Data with R</a></li>
<li>Handling raster data: <a href="https://tmieno2.github.io/R-as-GIS-for-Economists/raster-basics.html">R as GIS for Economists</a></li>
<li>INLA-SPDE approach: <a href="https://punama.github.io/BDI_INLA/">Introduction to INLA for geospatial modelling</a></li>
<li>Posterior distribution simulation: <a href="https://www.paulamoraga.com/book-geospatial/sec-inla.html">Geospatial Health Data: Modeling and Visualization with R-INLA and Shiny</a></li>
<li>Uncertainty quantification: <a href="https://www.pnas.org/doi/pdf/10.1073/pnas.1913050117">National population mapping from sparse survey data: A hierarchical Bayesian modeling framework to account for uncertainty</a></li>
</ul>
<!-- ### Age/sex-structured gridded population estimates -->
<!-- Age-structured population estimates are particularly important for planning age-specific services, for example, school age population or children under 1 year of age for vaccination. Through accounting for the proportion of total population in each age/sex class with the gridded (total) population, the gridded population for each age/sex class can be achieved. -->
<!-- ## Other small area units predictions  -->

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="model-fit-checks-and-cross-validation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="age-sex-disaggregation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "section",
    "scroll_highlight": true
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
