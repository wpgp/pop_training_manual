<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 Bayesian Hierarchical Population Modelling in R | WorldPop Population Modelling Training Manual, Vol. I</title>
  <meta name="description" content="An open book of WorldPop methods to produce gridded population estimates." />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="8 Bayesian Hierarchical Population Modelling in R | WorldPop Population Modelling Training Manual, Vol. I" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="An open book of WorldPop methods to produce gridded population estimates." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Bayesian Hierarchical Population Modelling in R | WorldPop Population Modelling Training Manual, Vol. I" />
  
  <meta name="twitter:description" content="An open book of WorldPop methods to produce gridded population estimates." />
  

<meta name="author" content="WorldPop, University of Southampton" />


<meta name="date" content="2025-07-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction-to-small-area-population-estimation-and-modelling-sapem.html"/>
<link rel="next" href="model-fit-checks-and-cross-validation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<link href="libs/health_facilities - type-CSS-0.0.1/health_facilities - type_home-button.css" rel="stylesheet" />
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<link href="libs/states-CSS-0.0.1/states_home-button.css" rel="stylesheet" />
<link href="libs/states_utm-CSS-0.0.1/states_utm_home-button.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#preface"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#book-contents"><i class="fa fa-check"></i>Book Contents</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html"><i class="fa fa-check"></i><b>1</b> Basics of R Programming</a>
<ul>
<li class="chapter" data-level="1.1" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#overview-of-r"><i class="fa fa-check"></i><b>1.1</b> Overview of R</a>
<ul>
<li class="chapter" data-level="" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#getting-started-with-r"><i class="fa fa-check"></i>Getting started with R</a>
<ul>
<li class="chapter" data-level="" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#downloading-r-and-rstudio"><i class="fa fa-check"></i>Downloading R and RStudio</a></li>
<li class="chapter" data-level="" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#features-of-the-r-gui-environment"><i class="fa fa-check"></i>Features of the R GUI environment</a></li>
<li class="chapter" data-level="" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#features-of-the-rstudio-environment"><i class="fa fa-check"></i>Features of the RStudio environment</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#creating-opening-and-saving-r-scripts"><i class="fa fa-check"></i>Creating, opening and saving R scripts</a></li>
<li class="chapter" data-level="1.1.1" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#getting-and-setting-the-working-directory"><i class="fa fa-check"></i><b>1.1.1</b> Getting and setting the working directory</a></li>
<li class="chapter" data-level="1.1.2" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#creating-opening-and-saving-r-projects"><i class="fa fa-check"></i><b>1.1.2</b> Creating, opening and saving R projects</a></li>
<li class="chapter" data-level="1.1.3" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#getting-help-in-r"><i class="fa fa-check"></i><b>1.1.3</b> Getting help in R</a></li>
<li class="chapter" data-level="1.1.4" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#r-coding-best-practices"><i class="fa fa-check"></i><b>1.1.4</b> R coding best practices</a>
<ul>
<li class="chapter" data-level="1.1.4.1" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#commenting"><i class="fa fa-check"></i><b>1.1.4.1</b> Commenting</a></li>
<li class="chapter" data-level="1.1.4.2" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#naming-conventions"><i class="fa fa-check"></i><b>1.1.4.2</b> Naming conventions</a></li>
<li class="chapter" data-level="1.1.4.3" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#spacing"><i class="fa fa-check"></i><b>1.1.4.3</b> Spacing</a></li>
<li class="chapter" data-level="1.1.4.4" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#punctuation"><i class="fa fa-check"></i><b>1.1.4.4</b> Punctuation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#data-types-and-key-components"><i class="fa fa-check"></i><b>1.2</b> Data types and key components</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#basic-operations-in-r"><i class="fa fa-check"></i><b>1.2.1</b> Basic operations in R</a>
<ul>
<li class="chapter" data-level="1.2.1.1" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#arithmetic-operators"><i class="fa fa-check"></i><b>1.2.1.1</b> Arithmetic operators</a></li>
<li class="chapter" data-level="1.2.1.2" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#logical-operators"><i class="fa fa-check"></i><b>1.2.1.2</b> Logical operators</a></li>
<li class="chapter" data-level="1.2.1.3" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#other-operators"><i class="fa fa-check"></i><b>1.2.1.3</b> Other operators</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#key-functions-in-r"><i class="fa fa-check"></i><b>1.3</b> Key functions in R</a></li>
<li class="chapter" data-level="1.4" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#data-structures"><i class="fa fa-check"></i><b>1.4</b> Data structures</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#vectors"><i class="fa fa-check"></i><b>1.4.1</b> Vectors</a></li>
<li class="chapter" data-level="1.4.2" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#matrices"><i class="fa fa-check"></i><b>1.4.2</b> Matrices</a></li>
<li class="chapter" data-level="1.4.3" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#arrays"><i class="fa fa-check"></i><b>1.4.3</b> Arrays</a></li>
<li class="chapter" data-level="1.4.4" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#data-frames"><i class="fa fa-check"></i><b>1.4.4</b> Data frames</a></li>
<li class="chapter" data-level="1.4.5" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#list"><i class="fa fa-check"></i><b>1.4.5</b> List</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#end-of-module-exercises"><i class="fa fa-check"></i><b>1.5</b> End of module exercises</a></li>
<li class="chapter" data-level="1.6" data-path="basics-of-r-programming.html"><a href="basics-of-r-programming.html#useful-resources"><i class="fa fa-check"></i><b>1.6</b> Useful resources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html"><i class="fa fa-check"></i><b>2</b> Working with Data Frames</a>
<ul>
<li class="chapter" data-level="2.1" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#importing-and-exporting-data-in-and-from-r"><i class="fa fa-check"></i><b>2.1</b> Importing and exporting data in and from R</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#installing-and-loading-packages"><i class="fa fa-check"></i><b>2.1.1</b> Installing and loading packages</a></li>
<li class="chapter" data-level="2.1.2" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#reading-data-into-the-r-environment"><i class="fa fa-check"></i><b>2.1.2</b> Reading data into the R environment</a></li>
<li class="chapter" data-level="2.1.3" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#creating-work-paths"><i class="fa fa-check"></i><b>2.1.3</b> Creating work paths</a></li>
<li class="chapter" data-level="2.1.4" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#exploring-data-attributes"><i class="fa fa-check"></i><b>2.1.4</b> Exploring data attributes</a></li>
<li class="chapter" data-level="2.1.5" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#viewing-data"><i class="fa fa-check"></i><b>2.1.5</b> Viewing data</a></li>
<li class="chapter" data-level="2.1.6" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#extracting-data"><i class="fa fa-check"></i><b>2.1.6</b> Extracting data</a></li>
<li class="chapter" data-level="2.1.7" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#attaching-data"><i class="fa fa-check"></i><b>2.1.7</b> Attaching data</a></li>
<li class="chapter" data-level="2.1.8" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#writing-data-to-external-repositories"><i class="fa fa-check"></i><b>2.1.8</b> Writing data to external repositories</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#basic-data-wrangling-methods-for-data-preparation-and-handling-in-r"><i class="fa fa-check"></i><b>2.2</b> Basic data wrangling methods for data preparation and handling in R</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#dealing-with-na-not-available-values"><i class="fa fa-check"></i><b>2.2.1</b> Dealing with NA (‘Not Available’) values</a></li>
<li class="chapter" data-level="2.2.2" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#key-data-wrangling-methods"><i class="fa fa-check"></i><b>2.2.2</b> Key data wrangling methods</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#data-visualisation"><i class="fa fa-check"></i><b>2.3</b> Data visualisation</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#bar-plots"><i class="fa fa-check"></i><b>2.3.1</b> Bar plots</a></li>
<li class="chapter" data-level="2.3.2" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#box-plots"><i class="fa fa-check"></i><b>2.3.2</b> Box plots</a></li>
<li class="chapter" data-level="2.3.3" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#histograms"><i class="fa fa-check"></i><b>2.3.3</b> Histograms</a></li>
<li class="chapter" data-level="2.3.4" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#density-plots"><i class="fa fa-check"></i><b>2.3.4</b> Density plots</a></li>
<li class="chapter" data-level="2.3.5" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#scatter-plots"><i class="fa fa-check"></i><b>2.3.5</b> Scatter plots</a></li>
<li class="chapter" data-level="2.3.6" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#violin-plots"><i class="fa fa-check"></i><b>2.3.6</b> Violin plots</a></li>
<li class="chapter" data-level="2.3.7" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#line-graphs"><i class="fa fa-check"></i><b>2.3.7</b> Line graphs</a></li>
<li class="chapter" data-level="2.3.8" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#population-pyramids"><i class="fa fa-check"></i><b>2.3.8</b> Population pyramids</a></li>
<li class="chapter" data-level="2.3.9" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#lollipop-plots"><i class="fa fa-check"></i><b>2.3.9</b> Lollipop plots</a></li>
<li class="chapter" data-level="2.3.10" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#plots-with-an-image-background"><i class="fa fa-check"></i><b>2.3.10</b> Plots with an image background</a></li>
<li class="chapter" data-level="2.3.11" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#viewing-and-saving-plots"><i class="fa fa-check"></i><b>2.3.11</b> Viewing and saving plots</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#end-of-module-exercises-1"><i class="fa fa-check"></i><b>2.4</b> End of module exercises</a></li>
<li class="chapter" data-level="2.5" data-path="working-with-data-frames.html"><a href="working-with-data-frames.html#useful-resources-1"><i class="fa fa-check"></i><b>2.5</b> Useful resources</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html"><i class="fa fa-check"></i><b>3</b> Working with Spatial Data in R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#spatial-data-overview-and-types"><i class="fa fa-check"></i><b>3.1</b> Spatial data: Overview and types</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#points-data"><i class="fa fa-check"></i><b>3.1.1</b> Points data</a></li>
<li class="chapter" data-level="3.1.2" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#areal-data"><i class="fa fa-check"></i><b>3.1.2</b> Areal data</a></li>
<li class="chapter" data-level="3.1.3" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#vector-data"><i class="fa fa-check"></i><b>3.1.3</b> Vector data</a>
<ul>
<li class="chapter" data-level="3.1.3.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#points"><i class="fa fa-check"></i><b>3.1.3.1</b> Points</a></li>
<li class="chapter" data-level="3.1.3.2" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#polylines"><i class="fa fa-check"></i><b>3.1.3.2</b> Polylines</a></li>
<li class="chapter" data-level="3.1.3.3" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#polygons"><i class="fa fa-check"></i><b>3.1.3.3</b> Polygons</a></li>
</ul></li>
<li class="chapter" data-level="3.1.4" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#raster-data"><i class="fa fa-check"></i><b>3.1.4</b> Raster data</a></li>
<li class="chapter" data-level="3.1.5" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#sources-of-spatial-data"><i class="fa fa-check"></i><b>3.1.5</b> Sources of spatial data</a></li>
<li class="chapter" data-level="3.1.6" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#geospatial-covariates"><i class="fa fa-check"></i><b>3.1.6</b> Geospatial covariates</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#basic-gis-concepts"><i class="fa fa-check"></i><b>3.2</b> Basic GIS concepts</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#geoprocessing"><i class="fa fa-check"></i><b>3.2.1</b> Geoprocessing</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#using-gis-in-r"><i class="fa fa-check"></i><b>3.3</b> Using GIS in R</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#importing-spatial-data-in-r"><i class="fa fa-check"></i><b>3.3.1</b> Importing spatial data in R</a></li>
<li class="chapter" data-level="3.3.2" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#handling-spatial-data-in-r"><i class="fa fa-check"></i><b>3.3.2</b> Handling spatial data in R</a>
<ul>
<li class="chapter" data-level="3.3.2.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#converting-between-vectors-and-rasters-in-r"><i class="fa fa-check"></i><b>3.3.2.1</b> Converting between vectors and rasters in R</a></li>
<li class="chapter" data-level="3.3.2.2" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#checking-the-resolution-and-number-of-cells"><i class="fa fa-check"></i><b>3.3.2.2</b> Checking the resolution and number of cells</a></li>
<li class="chapter" data-level="3.3.2.3" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#exporting-spatial-data-in-various-formats"><i class="fa fa-check"></i><b>3.3.2.3</b> Exporting spatial data in various formats</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#visualisation-of-spatial-data"><i class="fa fa-check"></i><b>3.4</b> Visualisation of spatial data</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#static-maps"><i class="fa fa-check"></i><b>3.4.1</b> Static maps</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#interactive-maps"><i class="fa fa-check"></i><b>3.5</b> Interactive maps</a>
<ul>
<li class="chapter" data-level="" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#visualisation-with-tmap-1"><i class="fa fa-check"></i>Visualisation with <code>tmap</code></a></li>
<li class="chapter" data-level="" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#visualisation-with-leaflet"><i class="fa fa-check"></i>Visualisation with <code>leaflet</code></a></li>
<li class="chapter" data-level="" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#visualisation-with-mapview"><i class="fa fa-check"></i>Visualisation with <code>mapview</code></a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#basic-geoprocessing"><i class="fa fa-check"></i><b>3.6</b> Basic geoprocessing</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#coordinate-reference-systems-crs"><i class="fa fa-check"></i><b>3.6.1</b> Coordinate reference systems (CRS)</a></li>
<li class="chapter" data-level="3.6.2" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#converting-between-latlong-and-the-universal-transverse-mercator-utm-coordinate-system"><i class="fa fa-check"></i><b>3.6.2</b> Converting between Lat/Long and the Universal Transverse Mercator (UTM) coordinate system</a></li>
<li class="chapter" data-level="3.6.3" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#subsetting-clipping-and-masking"><i class="fa fa-check"></i><b>3.6.3</b> Subsetting, clipping and masking</a></li>
<li class="chapter" data-level="3.6.4" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#buffer-analysis"><i class="fa fa-check"></i><b>3.6.4</b> Buffer analysis</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#end-of-module-exercises-2"><i class="fa fa-check"></i><b>3.7</b> End of module exercises</a></li>
<li class="chapter" data-level="3.8" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#useful-resources-2"><i class="fa fa-check"></i><b>3.8</b> Useful resources</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html"><i class="fa fa-check"></i><b>4</b> Introduction to Statistical Modelling with Implementation in R</a>
<ul>
<li class="chapter" data-level="4.1" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#concept-of-statistical-modelling"><i class="fa fa-check"></i><b>4.1</b> Concept of statistical modelling</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#overview-of-statistical-modelling"><i class="fa fa-check"></i><b>4.1.1</b> Overview of statistical modelling</a></li>
<li class="chapter" data-level="4.1.2" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#correlation"><i class="fa fa-check"></i><b>4.1.2</b> Correlation</a></li>
<li class="chapter" data-level="4.1.3" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#scaled-covariates"><i class="fa fa-check"></i><b>4.1.3</b> Scaled covariates</a></li>
<li class="chapter" data-level="4.1.4" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#uncertainty"><i class="fa fa-check"></i><b>4.1.4</b> Uncertainty</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#simple-regression"><i class="fa fa-check"></i><b>4.2</b> Simple regression</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#linear-regression"><i class="fa fa-check"></i><b>4.2.1</b> Linear regression</a></li>
<li class="chapter" data-level="4.2.2" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#polynomial-regression"><i class="fa fa-check"></i><b>4.2.2</b> Polynomial regression</a></li>
<li class="chapter" data-level="4.2.3" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#non-linear-regression"><i class="fa fa-check"></i><b>4.2.3</b> Non-linear regression</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#multiple-regression"><i class="fa fa-check"></i><b>4.3</b> Multiple regression</a></li>
<li class="chapter" data-level="4.4" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#generalised-linear-regression"><i class="fa fa-check"></i><b>4.4</b> Generalised linear regression</a></li>
<li class="chapter" data-level="4.5" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#model-predictions"><i class="fa fa-check"></i><b>4.5</b> Model predictions</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#predictions-with-the-formula-and-coefficients"><i class="fa fa-check"></i><b>4.5.1</b> Predictions with the formula and coefficients</a></li>
<li class="chapter" data-level="4.5.2" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#predictions-with-functions"><i class="fa fa-check"></i><b>4.5.2</b> Predictions with functions</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#model-selection"><i class="fa fa-check"></i><b>4.6</b> Model selection</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#accuracy-and-precision"><i class="fa fa-check"></i><b>4.6.1</b> Accuracy and precision</a></li>
<li class="chapter" data-level="4.6.2" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#akaike-information-criterion"><i class="fa fa-check"></i><b>4.6.2</b> Akaike information criterion</a></li>
<li class="chapter" data-level="4.6.3" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#bayesian-information-criterion"><i class="fa fa-check"></i><b>4.6.3</b> Bayesian information criterion</a></li>
<li class="chapter" data-level="4.6.4" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#r-squared-statistic"><i class="fa fa-check"></i><b>4.6.4</b> R-squared statistic</a></li>
<li class="chapter" data-level="4.6.5" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#analysis-of-variance"><i class="fa fa-check"></i><b>4.6.5</b> Analysis of variance</a></li>
<li class="chapter" data-level="4.6.6" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#likelihood-ratio-testing"><i class="fa fa-check"></i><b>4.6.6</b> Likelihood ratio testing</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#stepwise-regression"><i class="fa fa-check"></i><b>4.7</b> Stepwise regression</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#forward-stepwise-regression"><i class="fa fa-check"></i><b>4.7.1</b> Forward stepwise regression</a></li>
<li class="chapter" data-level="4.7.2" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#backward-stepwise-regression"><i class="fa fa-check"></i><b>4.7.2</b> Backward stepwise regression</a></li>
<li class="chapter" data-level="4.7.3" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#both-ways-stepwise-regression"><i class="fa fa-check"></i><b>4.7.3</b> Both ways stepwise regression</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#cross-validation"><i class="fa fa-check"></i><b>4.8</b> Cross-validation</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>4.8.1</b> <em>k</em>-fold cross-validation</a></li>
<li class="chapter" data-level="4.8.2" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#leave-one-out-cross-validation"><i class="fa fa-check"></i><b>4.8.2</b> Leave-one-out cross-validation</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#hierarchical-regression"><i class="fa fa-check"></i><b>4.9</b> Hierarchical regression</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#data-structure"><i class="fa fa-check"></i><b>4.9.1</b> Data structure</a></li>
<li class="chapter" data-level="4.9.2" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#variance-partition-coefficient"><i class="fa fa-check"></i><b>4.9.2</b> Variance partition coefficient</a></li>
<li class="chapter" data-level="4.9.3" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#random-intercepts-modelling"><i class="fa fa-check"></i><b>4.9.3</b> Random intercepts modelling</a></li>
<li class="chapter" data-level="4.9.4" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#random-intercepts-mixed-effects-modelling"><i class="fa fa-check"></i><b>4.9.4</b> Random intercepts mixed-effects modelling</a></li>
<li class="chapter" data-level="4.9.5" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#random-slope-mixed-effects-modelling"><i class="fa fa-check"></i><b>4.9.5</b> Random slope mixed-effects modelling</a></li>
<li class="chapter" data-level="4.9.6" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#adding-an-extra-level"><i class="fa fa-check"></i><b>4.9.6</b> Adding an extra level</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="introduction-to-statistical-modelling-with-implementation-in-r.html"><a href="introduction-to-statistical-modelling-with-implementation-in-r.html#useful-resources-3"><i class="fa fa-check"></i><b>4.10</b> Useful resources</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html"><i class="fa fa-check"></i><b>5</b> Probability Theory and Applications</a>
<ul>
<li class="chapter" data-level="5.1" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#introduction-to-probability"><i class="fa fa-check"></i><b>5.1</b> Introduction to probability</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#theoretical-and-experimental-probability"><i class="fa fa-check"></i><b>5.1.1</b> Theoretical and experimental probability</a></li>
<li class="chapter" data-level="5.1.2" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#keywords"><i class="fa fa-check"></i><b>5.1.2</b> Keywords</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#axioms-of-probability"><i class="fa fa-check"></i><b>5.2</b> Axioms of probability</a></li>
<li class="chapter" data-level="5.3" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#joint-probability"><i class="fa fa-check"></i><b>5.3</b> Joint probability</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#joint-probability-table"><i class="fa fa-check"></i><b>5.3.1</b> Joint probability table</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#conditional-probability"><i class="fa fa-check"></i><b>5.4</b> Conditional probability</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#multiplication-rule-of-conditional-probability"><i class="fa fa-check"></i><b>5.4.1</b> Multiplication rule of conditional probability</a></li>
<li class="chapter" data-level="5.4.2" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#law-of-total-probability"><i class="fa fa-check"></i><b>5.4.2</b> Law of total probability</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#contingency-tables"><i class="fa fa-check"></i><b>5.5</b> Contingency tables</a></li>
<li class="chapter" data-level="5.6" data-path="probability-theory-and-applications.html"><a href="probability-theory-and-applications.html#useful-resources-4"><i class="fa fa-check"></i><b>5.6</b> Useful resources</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html"><i class="fa fa-check"></i><b>6</b> Bayesian Statistical Inference</a>
<ul>
<li class="chapter" data-level="6.1" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#introduction"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#bayes-theorem"><i class="fa fa-check"></i><b>6.2</b> Bayes’ theorem</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#bayes-theorem-for-random-variables"><i class="fa fa-check"></i><b>6.2.1</b> Bayes’ theorem for random variables</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#the-likelihood-function"><i class="fa fa-check"></i><b>6.3</b> The likelihood function</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#different-types-and-structures"><i class="fa fa-check"></i><b>6.3.1</b> Different types and structures</a>
<ul>
<li class="chapter" data-level="6.3.1.1" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#count-data"><i class="fa fa-check"></i><b>6.3.1.1</b> Count data</a></li>
<li class="chapter" data-level="6.3.1.2" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#binary-data"><i class="fa fa-check"></i><b>6.3.1.2</b> Binary data</a></li>
<li class="chapter" data-level="6.3.1.3" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#proportional-data"><i class="fa fa-check"></i><b>6.3.1.3</b> Proportional data</a></li>
<li class="chapter" data-level="6.3.1.4" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#continuous-data"><i class="fa fa-check"></i><b>6.3.1.4</b> Continuous data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#prior-distribution"><i class="fa fa-check"></i><b>6.4</b> Prior distribution</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#conjugate-priors"><i class="fa fa-check"></i><b>6.4.1</b> Conjugate priors</a></li>
<li class="chapter" data-level="6.4.2" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#flat-improper-and-non-informative-priors"><i class="fa fa-check"></i><b>6.4.2</b> Flat, improper and non-informative priors</a></li>
<li class="chapter" data-level="6.4.3" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#informative-prior"><i class="fa fa-check"></i><b>6.4.3</b> Informative prior</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#overview-of-posterior-inference"><i class="fa fa-check"></i><b>6.5</b> Overview of posterior inference</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#markov-chain-monte-carlo-approach"><i class="fa fa-check"></i><b>6.5.1</b> Markov Chain Monte Carlo approach</a></li>
<li class="chapter" data-level="6.5.2" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#integrated-nested-laplace-approximation-approach"><i class="fa fa-check"></i><b>6.5.2</b> Integrated Nested Laplace Approximation approach</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#elicitation-of-priors"><i class="fa fa-check"></i><b>6.6</b> Elicitation of priors</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#priors-inla"><i class="fa fa-check"></i><b>6.6.1</b> Priors INLA</a>
<ul>
<li class="chapter" data-level="6.6.1.1" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#penalised-complexity-priors"><i class="fa fa-check"></i><b>6.6.1.1</b> Penalised Complexity priors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#sampling-and-evaluating-the-posterior-density"><i class="fa fa-check"></i><b>6.7</b> Sampling and evaluating the posterior density</a></li>
<li class="chapter" data-level="6.8" data-path="bayesian-statistical-inference.html"><a href="bayesian-statistical-inference.html#useful-resources-5"><i class="fa fa-check"></i><b>6.8</b> Useful resources</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="introduction-to-small-area-population-estimation-and-modelling-sapem.html"><a href="introduction-to-small-area-population-estimation-and-modelling-sapem.html"><i class="fa fa-check"></i><b>7</b> Introduction to Small Area Population Estimation and Modelling (SAPEM)</a>
<ul>
<li class="chapter" data-level="7.1" data-path="introduction-to-small-area-population-estimation-and-modelling-sapem.html"><a href="introduction-to-small-area-population-estimation-and-modelling-sapem.html#small-area-population-estimation"><i class="fa fa-check"></i><b>7.1</b> Small area population estimation</a></li>
<li class="chapter" data-level="7.2" data-path="introduction-to-small-area-population-estimation-and-modelling-sapem.html"><a href="introduction-to-small-area-population-estimation-and-modelling-sapem.html#direct-estimation"><i class="fa fa-check"></i><b>7.2</b> Direct estimation</a></li>
<li class="chapter" data-level="7.3" data-path="introduction-to-small-area-population-estimation-and-modelling-sapem.html"><a href="introduction-to-small-area-population-estimation-and-modelling-sapem.html#indirect-estimation"><i class="fa fa-check"></i><b>7.3</b> Indirect estimation</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="introduction-to-small-area-population-estimation-and-modelling-sapem.html"><a href="introduction-to-small-area-population-estimation-and-modelling-sapem.html#approaches-for-creating-gridded-population-datasets"><i class="fa fa-check"></i><b>7.3.1</b> Approaches for creating gridded population datasets</a>
<ul>
<li class="chapter" data-level="7.3.1.1" data-path="introduction-to-small-area-population-estimation-and-modelling-sapem.html"><a href="introduction-to-small-area-population-estimation-and-modelling-sapem.html#top-down"><i class="fa fa-check"></i><b>7.3.1.1</b> Top-down</a></li>
<li class="chapter" data-level="7.3.1.2" data-path="introduction-to-small-area-population-estimation-and-modelling-sapem.html"><a href="introduction-to-small-area-population-estimation-and-modelling-sapem.html#bottom-up"><i class="fa fa-check"></i><b>7.3.1.2</b> Bottom-up</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="introduction-to-small-area-population-estimation-and-modelling-sapem.html"><a href="introduction-to-small-area-population-estimation-and-modelling-sapem.html#useful-resources-6"><i class="fa fa-check"></i><b>7.4</b> Useful resources</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html"><i class="fa fa-check"></i><b>8</b> Bayesian Hierarchical Population Modelling in R</a>
<ul>
<li class="chapter" data-level="8.1" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#data-sources"><i class="fa fa-check"></i><b>8.1</b> Data sources</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#population-data"><i class="fa fa-check"></i><b>8.1.1</b> Population data</a></li>
<li class="chapter" data-level="8.1.2" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#settlement-data"><i class="fa fa-check"></i><b>8.1.2</b> Settlement data</a></li>
<li class="chapter" data-level="8.1.3" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#other-sources"><i class="fa fa-check"></i><b>8.1.3</b> Other sources</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#data-cleaning-and-covariates-extraction"><i class="fa fa-check"></i><b>8.2</b> Data cleaning and covariates extraction</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#extracting-continuous-rasters"><i class="fa fa-check"></i><b>8.2.1</b> Extracting continuous rasters</a></li>
<li class="chapter" data-level="8.2.2" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#extracting-categorical-rasters"><i class="fa fa-check"></i><b>8.2.2</b> Extracting categorical rasters</a></li>
<li class="chapter" data-level="8.2.3" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#extracting-building-count"><i class="fa fa-check"></i><b>8.2.3</b> Extracting building count</a></li>
<li class="chapter" data-level="8.2.4" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#exracting-building-total-area"><i class="fa fa-check"></i><b>8.2.4</b> Exracting building total area</a></li>
<li class="chapter" data-level="8.2.5" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#adding-admin-area-names-to-the-data"><i class="fa fa-check"></i><b>8.2.5</b> Adding admin area names to the data</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#exploratory-analysis"><i class="fa fa-check"></i><b>8.3</b> Exploratory analysis</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#basic-visualisation"><i class="fa fa-check"></i><b>8.3.1</b> Basic visualisation</a></li>
<li class="chapter" data-level="8.3.2" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#geospatial-visualisation"><i class="fa fa-check"></i><b>8.3.2</b> Geospatial visualisation</a></li>
<li class="chapter" data-level="8.3.3" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#checking-for-nas"><i class="fa fa-check"></i><b>8.3.3</b> Checking for NAs</a></li>
<li class="chapter" data-level="8.3.4" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#checking-for-minimum-and-maximum-values"><i class="fa fa-check"></i><b>8.3.4</b> Checking for minimum and maximum values</a></li>
<li class="chapter" data-level="8.3.5" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#checking-the-distribution-of-categorical-variables"><i class="fa fa-check"></i><b>8.3.5</b> Checking the distribution of categorical variables</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#model-set-up"><i class="fa fa-check"></i><b>8.4</b> Model set-up</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#simple-linear-regression"><i class="fa fa-check"></i><b>8.4.1</b> Simple linear regression</a></li>
<li class="chapter" data-level="8.4.2" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#multiple-regression-1"><i class="fa fa-check"></i><b>8.4.2</b> Multiple regression</a></li>
<li class="chapter" data-level="8.4.3" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#generalised-linear-regression-1"><i class="fa fa-check"></i><b>8.4.3</b> Generalised linear regression</a></li>
<li class="chapter" data-level="8.4.4" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#fitting-fixed-effects-models-in-r-inla"><i class="fa fa-check"></i><b>8.4.4</b> Fitting fixed effects models in <code>R-INLA</code></a></li>
<li class="chapter" data-level="8.4.5" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#fitting-bayesian-hierarchical-mixed-effects-models-in-r-inla"><i class="fa fa-check"></i><b>8.4.5</b> Fitting Bayesian hierarchical mixed effects models in <code>R-INLA</code></a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#stan-mcmc-approach"><i class="fa fa-check"></i><b>8.5</b> STAN (MCMC) approach</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#metropolis-hastings-algorithm"><i class="fa fa-check"></i><b>8.5.1</b> Metropolis-Hastings algorithm</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#inla-and-inla-spde-approach"><i class="fa fa-check"></i><b>8.6</b> INLA and INLA-SPDE approach</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#mesh-construction"><i class="fa fa-check"></i><b>8.6.1</b> Mesh construction</a></li>
<li class="chapter" data-level="8.6.2" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#building-the-spde"><i class="fa fa-check"></i><b>8.6.2</b> Building the SPDE</a></li>
<li class="chapter" data-level="8.6.3" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#projection-matrix"><i class="fa fa-check"></i><b>8.6.3</b> Projection matrix</a></li>
<li class="chapter" data-level="8.6.4" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#data-location-indexing"><i class="fa fa-check"></i><b>8.6.4</b> Data location indexing</a></li>
<li class="chapter" data-level="8.6.5" data-path="bayesian-hierarchical-population-modelling-in-r.html"><a href="bayesian-hierarchical-population-modelling-in-r.html#projection-data"><i class="fa fa-check"></i><b>8.6.5</b> Projection data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html"><i class="fa fa-check"></i><b>9</b> Model Fit Checks and Cross-Validation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html#model-assumption-checking"><i class="fa fa-check"></i><b>9.1</b> Model assumption checking</a></li>
<li class="chapter" data-level="9.2" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html#model-selection-1"><i class="fa fa-check"></i><b>9.2</b> Model selection</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html#watanabe-akaike-information-criterion-waic"><i class="fa fa-check"></i><b>9.2.1</b> Watanabe-Akaike Information Criterion (WAIC)</a></li>
<li class="chapter" data-level="9.2.2" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html#deviance-information-criterion-dic"><i class="fa fa-check"></i><b>9.2.2</b> Deviance Information Criterion (DIC)</a></li>
<li class="chapter" data-level="9.2.3" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html#conditional-predictive-ordinate-cpo"><i class="fa fa-check"></i><b>9.2.3</b> Conditional predictive ordinate (CPO)</a></li>
<li class="chapter" data-level="9.2.4" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html#probability-integral-transform-pit"><i class="fa fa-check"></i><b>9.2.4</b> Probability Integral Transform (PIT)</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html#cross-validation-1"><i class="fa fa-check"></i><b>9.3</b> Cross-validation</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html#basic-cross-validation"><i class="fa fa-check"></i><b>9.3.1</b> Basic cross-validation</a></li>
<li class="chapter" data-level="9.3.2" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html#k-fold-cross-validation-1"><i class="fa fa-check"></i><b>9.3.2</b> K-Fold Cross-Validation</a></li>
<li class="chapter" data-level="9.3.3" data-path="model-fit-checks-and-cross-validation.html"><a href="model-fit-checks-and-cross-validation.html#useful-resources-7"><i class="fa fa-check"></i><b>9.3.3</b> Useful resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html"><i class="fa fa-check"></i><b>10</b> Population Prediction and Uncertainty Quantification</a>
<ul>
<li class="chapter" data-level="10.1" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html#covariate-stacking"><i class="fa fa-check"></i><b>10.1</b> Covariate stacking</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html#admin-names"><i class="fa fa-check"></i><b>10.1.1</b> Admin names</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html#grid-cellpixel-level-prediction"><i class="fa fa-check"></i><b>10.2</b> Grid cell/pixel level prediction</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html#pre-processing"><i class="fa fa-check"></i><b>10.2.1</b> Pre-processing</a></li>
<li class="chapter" data-level="10.2.2" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html#inla-spde-approach"><i class="fa fa-check"></i><b>10.2.2</b> INLA-SPDE approach</a>
<ul>
<li class="chapter" data-level="10.2.2.1" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html#predictions"><i class="fa fa-check"></i><b>10.2.2.1</b> Predictions</a></li>
</ul></li>
<li class="chapter" data-level="10.2.3" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html#posterior-distribution-simulation"><i class="fa fa-check"></i><b>10.2.3</b> Posterior distribution simulation</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html#aggregation-to-area-units-of-interest-and-uncertainty-quantification"><i class="fa fa-check"></i><b>10.3</b> Aggregation to area units of interest and uncertainty quantification</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html#rasterising-the-predictions-at-grid-cell-level"><i class="fa fa-check"></i><b>10.3.1</b> Rasterising the predictions at grid cell level</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="population-prediction-and-uncertainty-quantification.html"><a href="population-prediction-and-uncertainty-quantification.html#useful-resources-8"><i class="fa fa-check"></i><b>10.4</b> Useful resources</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="age-sex-disaggregation.html"><a href="age-sex-disaggregation.html"><i class="fa fa-check"></i><b>11</b> Age-Sex Disaggregation</a>
<ul>
<li class="chapter" data-level="11.1" data-path="age-sex-disaggregation.html"><a href="age-sex-disaggregation.html#disaggregation-of-population-totals-by-age-sex-proportions"><i class="fa fa-check"></i><b>11.1</b> Disaggregation of population totals by age-sex proportions</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="age-sex-disaggregation.html"><a href="age-sex-disaggregation.html#unavailable-age-sex-data"><i class="fa fa-check"></i><b>11.1.1</b> Unavailable age-sex data</a></li>
<li class="chapter" data-level="11.1.2" data-path="age-sex-disaggregation.html"><a href="age-sex-disaggregation.html#available-age-sex-data"><i class="fa fa-check"></i><b>11.1.2</b> Available age-sex data</a>
<ul>
<li class="chapter" data-level="11.1.2.1" data-path="age-sex-disaggregation.html"><a href="age-sex-disaggregation.html#age-sex-disaggregation-1"><i class="fa fa-check"></i><b>11.1.2.1</b> Age-sex disaggregation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="age-sex-disaggregation.html"><a href="age-sex-disaggregation.html#useful-resources-9"><i class="fa fa-check"></i><b>11.2</b> Useful resources</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html"><i class="fa fa-check"></i><b>12</b> Exercise Solutions by Module</a>
<ul>
<li class="chapter" data-level="12.1" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#module-1"><i class="fa fa-check"></i><b>12.1</b> Module 1</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#general-exercises"><i class="fa fa-check"></i><b>12.1.1</b> General exercises</a></li>
<li class="chapter" data-level="12.1.2" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#end-of-module-exercises-3"><i class="fa fa-check"></i><b>12.1.2</b> End of module exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#module-2"><i class="fa fa-check"></i><b>12.2</b> Module 2</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#general-exercises-1"><i class="fa fa-check"></i><b>12.2.1</b> General exercises</a></li>
<li class="chapter" data-level="12.2.2" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#end-of-module-exercises-4"><i class="fa fa-check"></i><b>12.2.2</b> End of module exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#module-3"><i class="fa fa-check"></i><b>12.3</b> Module 3</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#general-exercises-2"><i class="fa fa-check"></i><b>12.3.1</b> General exercises</a></li>
<li class="chapter" data-level="12.3.2" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#end-of-module-exercises-5"><i class="fa fa-check"></i><b>12.3.2</b> End of module exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#module-4"><i class="fa fa-check"></i><b>12.4</b> Module 4</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#general-exercises-3"><i class="fa fa-check"></i><b>12.4.1</b> General exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#module-5"><i class="fa fa-check"></i><b>12.5</b> Module 5</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#general-exercises-4"><i class="fa fa-check"></i><b>12.5.1</b> General exercises</a></li>
<li class="chapter" data-level="12.5.2" data-path="exercise-solutions-by-module.html"><a href="exercise-solutions-by-module.html#general-exercises-5"><i class="fa fa-check"></i><b>12.5.2</b> General exercises</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">WorldPop Population Modelling Training Manual, Vol. I</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bayesian-hierarchical-population-modelling-in-r" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">8</span> Bayesian Hierarchical Population Modelling in R<a href="bayesian-hierarchical-population-modelling-in-r.html#bayesian-hierarchical-population-modelling-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This module expands upon the Bayesian hierarchical population modelling covered in earlier modules, focusing instead on the methods with spatial data. It introduces the key different data sources, methods for covariate extraction, exploratory analysis, and model set up. The remainder of the module briefly covers the STAN (MCMC) approach, and goes into detail for the INLA-SPDE approach to Bayesian hierarchical modelling.</p>
<div id="data-sources" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Data sources<a href="bayesian-hierarchical-population-modelling-in-r.html#data-sources" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="population-data" class="section level3 hasAnchor" number="8.1.1">
<h3><span class="header-section-number">8.1.1</span> Population data<a href="bayesian-hierarchical-population-modelling-in-r.html#population-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are three main forms of population (or demographic) data: <strong>micro-census</strong>, <strong>partial census</strong> and <strong>pre-survey listings</strong>. A brief description of each is given as follows.</p>
<ul>
<li>Micro-census: A targeted household survey that covers a fraction of the population. It is a complete enumeration of a micro-census cluster. However, there are very scarce data contexts with no data to re-purpose.</li>
<li>Partial census: It covers only a part of the population or country. Useful when there are inaccessible areas, locations in conflict or territories controlled by anti-government groups, among other uses.</li>
<li>pre-survey listings: Identifying and listing all household or dwellings in the survey area. It is done through defining the survey frame and re-purposing household surveys (e.g. health, livestock, …).</li>
</ul>
<p>There are 4 main steps for processing data as follows.</p>
<ol style="list-style-type: decimal">
<li>Identify the spatial unit of analysis</li>
<li>Identify variables common in the shapefile and the survey dataset (<strong>unique ids</strong>)</li>
<li>Summarise variables of interest in the survey data</li>
<li>Join the summarised survey data with the shapefile using <strong>unique ids</strong></li>
</ol>
<p>Each of the datasets must be summarised by summing the household size to get the total population in each <strong>enumeration area</strong> (EA). This can be done using the following code as a template.</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb595-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb595-1" tabindex="-1"></a><span class="co">#Data survey 1</span></span>
<span id="cb595-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb595-2" tabindex="-1"></a>Data_survey1 <span class="ot">&lt;-</span> Data_survey1 <span class="sc">%&gt;%</span> </span>
<span id="cb595-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb595-3" tabindex="-1"></a>  <span class="fu">group_by</span>(EA_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb595-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb595-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total_Pop =</span> <span class="fu">sum</span>(HH_Size)) <span class="sc">%&gt;%</span> </span>
<span id="cb595-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb595-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Survey =</span> <span class="st">&quot;survey1&quot;</span>)</span>
<span id="cb595-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb595-6" tabindex="-1"></a></span>
<span id="cb595-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb595-7" tabindex="-1"></a><span class="co">#Data survey 2</span></span>
<span id="cb595-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb595-8" tabindex="-1"></a>Data_survey2 <span class="ot">&lt;-</span> Data_survey2 <span class="sc">%&gt;%</span> </span>
<span id="cb595-9"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb595-9" tabindex="-1"></a>  <span class="fu">group_by</span>(EA_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb595-10"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb595-10" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total_Pop =</span> <span class="fu">sum</span>(HH_Size)) <span class="sc">%&gt;%</span> </span>
<span id="cb595-11"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb595-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Survey =</span> <span class="st">&quot;survey2&quot;</span>)</span>
<span id="cb595-12"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb595-12" tabindex="-1"></a></span>
<span id="cb595-13"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb595-13" tabindex="-1"></a><span class="co">#Data survey 3</span></span>
<span id="cb595-14"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb595-14" tabindex="-1"></a>Data_survey3 <span class="ot">&lt;-</span> Data_survey3 <span class="sc">%&gt;%</span> </span>
<span id="cb595-15"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb595-15" tabindex="-1"></a>  <span class="fu">group_by</span>(EA_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb595-16"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb595-16" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total_Pop =</span> <span class="fu">sum</span>(HH_Size)) <span class="sc">%&gt;%</span> </span>
<span id="cb595-17"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb595-17" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Survey =</span> <span class="st">&quot;survey3&quot;</span>)</span>
<span id="cb595-18"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb595-18" tabindex="-1"></a></span>
<span id="cb595-19"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb595-19" tabindex="-1"></a><span class="co">#rbind all data as one data frame</span></span>
<span id="cb595-20"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb595-20" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Data_survey1, Data_survey2, Data_survey3)</span></code></pre></div>
<p>This data processing is demonstrated in the following code using the functions <code>group_by()</code>, <code>sumarise()</code> and <code>mutate()</code> with the 5 Cameroon survey datasets:</p>
<ul>
<li><code>Data_CMIS</code> was collected in 2022</li>
<li><code>Data_EESI</code> was collected in 2021</li>
<li><code>Data_ECAM1</code> was collected in the first Quarter of 2021</li>
<li><code>Data_ECAM2</code> was collected in the second Quarter of 2021</li>
<li><code>Data_ECAM3</code> was collected in the third Quarter of 2021</li>
</ul>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb596-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb596-1" tabindex="-1"></a><span class="co">#load the sf and tidyverse packages</span></span>
<span id="cb596-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb596-2" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb596-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb596-3" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb597-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-1" tabindex="-1"></a><span class="co">#load datasets</span></span>
<span id="cb597-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-2" tabindex="-1"></a>Data_ECAM1 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(data_path, <span class="st">&quot;Data_ECAM1.csv&quot;</span>))</span>
<span id="cb597-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-3" tabindex="-1"></a>Data_ECAM2 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(data_path, <span class="st">&quot;Data_ECAM2.csv&quot;</span>))</span>
<span id="cb597-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-4" tabindex="-1"></a>Data_ECAM3 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(data_path, <span class="st">&quot;Data_ECAM3.csv&quot;</span>))</span>
<span id="cb597-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-5" tabindex="-1"></a>Data_EESI <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(data_path, <span class="st">&quot;Data_EESI.csv&quot;</span>))</span>
<span id="cb597-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-6" tabindex="-1"></a>Data_CMIS <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(data_path, <span class="st">&quot;Data_CMIS.csv&quot;</span>))</span>
<span id="cb597-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-7" tabindex="-1"></a></span>
<span id="cb597-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-8" tabindex="-1"></a><span class="co">#Data_CMIS</span></span>
<span id="cb597-9"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-9" tabindex="-1"></a>Data_CMIS <span class="ot">&lt;-</span> Data_CMIS <span class="sc">%&gt;%</span> </span>
<span id="cb597-10"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-10" tabindex="-1"></a>  <span class="fu">group_by</span>(EA_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb597-11"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-11" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total_Pop =</span> <span class="fu">sum</span>(HH_Size)) <span class="sc">%&gt;%</span> </span>
<span id="cb597-12"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Survey =</span> <span class="st">&quot;CMIS&quot;</span>)</span>
<span id="cb597-13"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-13" tabindex="-1"></a></span>
<span id="cb597-14"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-14" tabindex="-1"></a><span class="co">#Data_EESI</span></span>
<span id="cb597-15"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-15" tabindex="-1"></a>Data_EESI <span class="ot">&lt;-</span> Data_EESI <span class="sc">%&gt;%</span> </span>
<span id="cb597-16"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-16" tabindex="-1"></a>  <span class="fu">group_by</span>(EA_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb597-17"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-17" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total_Pop =</span> <span class="fu">sum</span>(HH_Size))<span class="sc">%&gt;%</span> </span>
<span id="cb597-18"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Survey =</span> <span class="st">&quot;EESI&quot;</span>)</span>
<span id="cb597-19"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-19" tabindex="-1"></a></span>
<span id="cb597-20"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-20" tabindex="-1"></a><span class="co">#Data_ECAM1</span></span>
<span id="cb597-21"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-21" tabindex="-1"></a>Data_ECAM1 <span class="ot">&lt;-</span> Data_ECAM1 <span class="sc">%&gt;%</span> </span>
<span id="cb597-22"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-22" tabindex="-1"></a>  <span class="fu">group_by</span>(EA_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb597-23"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-23" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total_Pop =</span> <span class="fu">sum</span>(HH_Size))<span class="sc">%&gt;%</span> </span>
<span id="cb597-24"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-24" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Survey =</span> <span class="st">&quot;ECAM1&quot;</span>)</span>
<span id="cb597-25"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-25" tabindex="-1"></a></span>
<span id="cb597-26"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-26" tabindex="-1"></a><span class="co">#Data_ECAM2</span></span>
<span id="cb597-27"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-27" tabindex="-1"></a>Data_ECAM2 <span class="ot">&lt;-</span> Data_ECAM2 <span class="sc">%&gt;%</span> </span>
<span id="cb597-28"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-28" tabindex="-1"></a>  <span class="fu">group_by</span>(EA_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb597-29"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-29" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total_Pop =</span> <span class="fu">sum</span>(HH_Size))<span class="sc">%&gt;%</span> </span>
<span id="cb597-30"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-30" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Survey =</span> <span class="st">&quot;ECAM2&quot;</span>)</span>
<span id="cb597-31"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-31" tabindex="-1"></a></span>
<span id="cb597-32"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-32" tabindex="-1"></a><span class="co">#Data_ECAM3</span></span>
<span id="cb597-33"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-33" tabindex="-1"></a>Data_ECAM3 <span class="ot">&lt;-</span> Data_ECAM3 <span class="sc">%&gt;%</span> </span>
<span id="cb597-34"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-34" tabindex="-1"></a>  <span class="fu">group_by</span>(EA_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb597-35"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-35" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total_Pop =</span> <span class="fu">sum</span>(HH_Size))<span class="sc">%&gt;%</span> </span>
<span id="cb597-36"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-36" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Survey =</span> <span class="st">&quot;ECAM3&quot;</span>)</span>
<span id="cb597-37"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-37" tabindex="-1"></a></span>
<span id="cb597-38"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-38" tabindex="-1"></a><span class="co">#rbind all data as one data frame</span></span>
<span id="cb597-39"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb597-39" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Data_CMIS, Data_EESI, Data_ECAM1, Data_ECAM2, Data_ECAM3)</span></code></pre></div>
<p>In different surveys, as with this example of the five surveys, some enumeration areas are surveyed in a different survey. In this instance, the most recent survey needs to be maintained. For example if a particular EA was surveyed in both <code>CMIS</code> (2022) and <code>EESI</code> (2021), CMIS is maintained since it is the most recent. This will be done across all surveys to ensure that there are not duplicated EAs in the dataset.</p>
<p>In order to do this, the data must be ordered using the function <code>mutate()</code> before removing the duplicated data in order of priority with the functions <code>arrange()</code> and <code>filter()</code>.</p>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb598-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb598-1" tabindex="-1"></a><span class="co">#order data</span></span>
<span id="cb598-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb598-2" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span> </span>
<span id="cb598-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb598-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Data_Priority =</span> <span class="fu">case_when</span>(Survey <span class="sc">==</span> <span class="st">&quot;ECAM1&quot;</span> <span class="sc">~</span> <span class="dv">1</span>,   </span>
<span id="cb598-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb598-4" tabindex="-1"></a>                                   Survey <span class="sc">==</span> <span class="st">&quot;ECAM2&quot;</span> <span class="sc">~</span> <span class="dv">2</span>, </span>
<span id="cb598-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb598-5" tabindex="-1"></a>                                   Survey <span class="sc">==</span> <span class="st">&quot;ECAM3&quot;</span> <span class="sc">~</span> <span class="dv">3</span>, </span>
<span id="cb598-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb598-6" tabindex="-1"></a>                                   Survey <span class="sc">==</span> <span class="st">&quot;EESI&quot;</span> <span class="sc">~</span> <span class="dv">4</span>, </span>
<span id="cb598-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb598-7" tabindex="-1"></a>                                   Survey <span class="sc">==</span> <span class="st">&quot;CMIS&quot;</span> <span class="sc">~</span> <span class="dv">5</span>))</span>
<span id="cb598-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb598-8" tabindex="-1"></a></span>
<span id="cb598-9"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb598-9" tabindex="-1"></a><span class="co">#remove duplicated EA in order of priority</span></span>
<span id="cb598-10"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb598-10" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb598-11"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb598-11" tabindex="-1"></a>  <span class="fu">arrange</span>(EA_ID, <span class="sc">-</span>Data_Priority) <span class="sc">%&gt;%</span></span>
<span id="cb598-12"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb598-12" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">duplicated</span>(EA_ID)) </span></code></pre></div>
<p>Once the duplicates are removed, the shapefile for the enumeration area can be joined with the combined survey dataset based on on the enumeration area ID which is a unique ID to both datasets.</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb599-1" tabindex="-1"></a><span class="co">#load EA_shapefile</span></span>
<span id="cb599-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb599-2" tabindex="-1"></a>EA_Shapefile <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">paste0</span>(data_path, <span class="st">&quot;EA_Shapefile.shp&quot;</span>))</span></code></pre></div>
<pre><code>## Reading layer `EA_shapefile&#39; from data source 
##   `F:\Study\WorldPop Training Materials\GitBook\wp_training_manual\data\CMR\EA_shapefile.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 2290 features and 1 field
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 8.498025 ymin: 1.653369 xmax: 16.1904 ymax: 12.96129
## Geodetic CRS:  WGS 84</code></pre>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb601-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb601-1" tabindex="-1"></a><span class="co">#join the shapefile and data based on EA_ID (a unique id to both datasets)</span></span>
<span id="cb601-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb601-2" tabindex="-1"></a>Population_data <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(EA_Shapefile, combined_data, <span class="at">by =</span> <span class="st">&quot;EA_ID&quot;</span>)</span></code></pre></div>
<p>Finally, the unwanted variables can be removed from the resulting population data with the final result outputted as a shapefile.</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb602-1" tabindex="-1"></a><span class="co">#remove unwanted variables</span></span>
<span id="cb602-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb602-2" tabindex="-1"></a>Population_data <span class="ot">&lt;-</span> Population_data <span class="sc">%&gt;%</span> </span>
<span id="cb602-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb602-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Data_Priority)</span>
<span id="cb602-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb602-4" tabindex="-1"></a></span>
<span id="cb602-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb602-5" tabindex="-1"></a><span class="co">#write data as a shapefile </span></span>
<span id="cb602-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb602-6" tabindex="-1"></a><span class="fu">write_sf</span>(Population_data, <span class="fu">paste0</span>(output_path, <span class="st">&quot;EA_population.shp&quot;</span>))</span></code></pre></div>
</div>
<div id="settlement-data" class="section level3 hasAnchor" number="8.1.2">
<h3><span class="header-section-number">8.1.2</span> Settlement data<a href="bayesian-hierarchical-population-modelling-in-r.html#settlement-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are four main sources of settlement data, detailed as follows.</p>
<ul>
<li><strong>Building footprints</strong>: Typically given as a polygon shapefile of buildings. Sources of building footprints are:
<ul>
<li>Maxar &amp; Ecopia building footprint (with processing partner: Ecopia AI), a frequently used settlement data source for gridded population estimations.</li>
<li>Google - Open Buildings, available from <a href="https://sites.research.google/open-buildings/">Google</a>.</li>
<li>Microsoft - Building Footprints, available on <a href="https://github.com/microsoft/GlobalMLBuildingFootprints">GitHub</a>.</li>
<li>World Settlement Footprint (with processing partners: A collaboration between the European Space Agency, German Aerospace Center and Google Earth Engine). This dataset is given as a raster based on Sentinel 2.</li>
<li>OpenStreetMap</li>
</ul></li>
<li><strong>Built-up area</strong>: Typically a raster file at 100m resolution. A source of this is:
<ul>
<li>GHS-Built-Up Surface Global Human Settlement Layer (with processing partner: European Commission).</li>
</ul></li>
<li><strong>Gridded building intensity</strong>: This is provided by <a href="https://planetgis.org/">Planet</a></li>
<li><strong>NSO building datasets</strong>: This is data on building information collected during a census or survey, the building count and/or the building classification.</li>
</ul>
<p>There are multiple uses of settlement data. For example, as a proxy to extrapolate population totals. In this instance, the building count or settled area is used as the input and can be used to model the population in surveyed areas, to estimate the population total in areas not surveyed and to produce high resolution estimates. Additionally, settlement data can be used as covariates to detect density variation. For this use, of interest are the different summary metrics (area, perimeter, proximity, angle, shape, …), the different aggregation metrics at the grid cell (minimum, mean, maximum, standard deviation, …) and the different window sizes for contextual information.</p>
</div>
<div id="other-sources" class="section level3 hasAnchor" number="8.1.3">
<h3><span class="header-section-number">8.1.3</span> Other sources<a href="bayesian-hierarchical-population-modelling-in-r.html#other-sources" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Settlement data is not the only source of geospatial data. Other sources include (but are not limited to):</p>
<ul>
<li>Night-time light</li>
<li>Distance to hospitals</li>
<li>Distance to schools</li>
<li>Water bodies</li>
<li>Vegetation cover</li>
<li>Land uses</li>
<li>Conflict data</li>
</ul>
<p>However, not all geospatial data sources are good to use as geospatial covariates in a model. When selecting a geospatial covariate, it needs to be considered whether or not the covariate has a significant effect on population. Additionally, the availability of the covariate data (open-source/closed) should be considered, along with the spatial and temporal resolution of the covariate.</p>
</div>
</div>
<div id="data-cleaning-and-covariates-extraction" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Data cleaning and covariates extraction<a href="bayesian-hierarchical-population-modelling-in-r.html#data-cleaning-and-covariates-extraction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Prior to working with the covariates and modelling the data, the data itself must be extracted. To demonstrate these methods, the Cameroon population data will be used as an example. The extraction process essentially overlays polygons onto the covariate raster data, and extracts the covariate information from each raster that is within the polygon.</p>
<p>To begin with, the relevant data must be read into R. In this case, the population dataset must also be projected using the function <code>st_transform()</code> to be the same spatial reference as the mastergrid.</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb603-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb603-1" tabindex="-1"></a><span class="co">#install raster processing packages</span></span>
<span id="cb603-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb603-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;terra&quot;</span>)</span>
<span id="cb603-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb603-3" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tictoc&quot;</span>)</span>
<span id="cb603-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb603-4" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;exactextractr&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb604-1" tabindex="-1"></a><span class="co">#load raster processing packages</span></span>
<span id="cb604-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb604-2" tabindex="-1"></a><span class="fu">library</span>(terra) <span class="co">#raster analysis</span></span>
<span id="cb604-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb604-3" tabindex="-1"></a><span class="fu">library</span>(tictoc)  </span>
<span id="cb604-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb604-4" tabindex="-1"></a><span class="fu">library</span>(exactextractr) <span class="co">#covariate extraction</span></span>
<span id="cb604-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb604-5" tabindex="-1"></a><span class="fu">library</span>(raster)</span></code></pre></div>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb605-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb605-1" tabindex="-1"></a><span class="co">#read combined population dataset and mastergrid</span></span>
<span id="cb605-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb605-2" tabindex="-1"></a>pop_data_shp <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">paste0</span>(data_path, <span class="st">&quot;Population/EA_population.shp&quot;</span>))</span></code></pre></div>
<pre><code>## Reading layer `EA_population&#39; from data source 
##   `F:\Study\WorldPop Training Materials\GitBook\wp_training_manual\data\CMR\Population\EA_population.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 1592 features and 3 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 8.498025 ymin: 1.653369 xmax: 16.1904 ymax: 12.96129
## Geodetic CRS:  WGS 84</code></pre>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb607-1" tabindex="-1"></a>mgrid <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">paste0</span>(mgrid_path, <span class="st">&quot;CMR_mastergrid_WP_ND.tif&quot;</span>))</span>
<span id="cb607-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb607-2" tabindex="-1"></a></span>
<span id="cb607-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb607-3" tabindex="-1"></a><span class="co">#project pop_data to same spatial reference as mgrid</span></span>
<span id="cb607-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb607-4" tabindex="-1"></a>pop_data_shp <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(pop_data_shp, <span class="at">crs =</span> <span class="fu">st_crs</span>(mgrid)) </span></code></pre></div>
<!-- To process the rasters in R, the continuous and categorical rasters must be dealt with slightly differently.  -->
<div id="extracting-continuous-rasters" class="section level3 hasAnchor" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> Extracting continuous rasters<a href="bayesian-hierarchical-population-modelling-in-r.html#extracting-continuous-rasters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Starting with continuous rasters, first all of the continuous raster covariates must be imported. When there are multiple covariates, instead of importing each manually, the function <code>list.files()</code> can be used to list all of the relevant covariates at once. In this function, to extract the correct information, as arguments the drive path to the covariates must be specified under <code>path</code>, the file type specified under <code>pattern</code> (in this case, <code>.tif$</code>), whether you want all files (in this case <code>all.files = TRUE</code>) and whether you want full names (in this case <code>full.names = FALSE</code>).</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb608-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb608-1" tabindex="-1"></a><span class="co">#import all continuous raster covariates</span></span>
<span id="cb608-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb608-2" tabindex="-1"></a>raster_list <span class="ot">&lt;-</span><span class="fu">list.files</span>(<span class="at">path =</span> raster_path1, <span class="at">pattern =</span> <span class="st">&quot;.tif$&quot;</span>,</span>
<span id="cb608-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb608-3" tabindex="-1"></a>                         <span class="at">all.files =</span> <span class="cn">TRUE</span>, <span class="at">full.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb608-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb608-4" tabindex="-1"></a><span class="co">#let see the rasters in the list</span></span>
<span id="cb608-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb608-5" tabindex="-1"></a>raster_list</span></code></pre></div>
<pre><code>##  [1] &quot;acled_battles_2021_CMR_ed_masked.tif&quot;                   
##  [2] &quot;acled_conflict_data_2021_CMR_ed_masked.tif&quot;             
##  [3] &quot;acled_explosions_2021_CMR_ed_masked.tif&quot;                
##  [4] &quot;acled_protests_2021_CMR_ed_masked.tif&quot;                  
##  [5] &quot;acled_riots_2021_CMR_ed_masked.tif&quot;                     
##  [6] &quot;acled_strategic_developments_2021_CMR_ed_masked.tif&quot;    
##  [7] &quot;acled_violence_against_civilians_2021_CMR_ed_masked.tif&quot;
##  [8] &quot;CMR_AccessToCities2015.tif&quot;                             
##  [9] &quot;CMR_buildings_cv_area.tif&quot;                              
## [10] &quot;CMR_buildings_cv_length.tif&quot;                            
## [11] &quot;CMR_buildings_density.tif&quot;                              
## [12] &quot;CMR_buildings_mean_area.tif&quot;                            
## [13] &quot;CMR_buildings_mean_length.tif&quot;                          
## [14] &quot;CMR_buildings_total_length.tif&quot;                         
## [15] &quot;CMR_dst_coastline_100m_2000_2020.tif&quot;                   
## [16] &quot;CMR_dst_in_water_100m_2000_2012.tif&quot;                    
## [17] &quot;CMR_esaccilc_dst011_100m_2015.tif&quot;                      
## [18] &quot;CMR_esaccilc_dst040_100m_2015.tif&quot;                      
## [19] &quot;CMR_esaccilc_dst130_100m_2015.tif&quot;                      
## [20] &quot;CMR_esaccilc_dst140_100m_2015.tif&quot;                      
## [21] &quot;CMR_esaccilc_dst150_100m_2015.tif&quot;                      
## [22] &quot;CMR_esaccilc_dst160_100m_2015.tif&quot;                      
## [23] &quot;CMR_esaccilc_dst190_100m_2015.tif&quot;                      
## [24] &quot;CMR_esaccilc_dst200_100m_2015.tif&quot;                      
## [25] &quot;CMR_FrictionVehicle2020.tif&quot;                            
## [26] &quot;CMR_FrictionWalk2020.tif&quot;                               
## [27] &quot;CMR_grid_100m_wclim_precip_2020.tif&quot;                    
## [28] &quot;CMR_grid_100m_wclim_temp_2020.tif&quot;                      
## [29] &quot;CMR_osm_dst_education.tif&quot;                              
## [30] &quot;CMR_osm_dst_health.tif&quot;                                 
## [31] &quot;CMR_osm_dst_localroads.tif&quot;                             
## [32] &quot;CMR_osm_dst_majorroads.tif&quot;                             
## [33] &quot;CMR_osm_dst_mktplaces.tif&quot;                              
## [34] &quot;CMR_osm_dst_PofW.tif&quot;                                   
## [35] &quot;CMR_osm_dst_Proad_intersections.tif&quot;                    
## [36] &quot;CMR_osm_dst_railways.tif&quot;                               
## [37] &quot;CMR_osm_dst_waterbodies.tif&quot;                            
## [38] &quot;CMR_osm_dst_waterways.tif&quot;                              
## [39] &quot;CMR_srtm_topo_100m.tif&quot;                                 
## [40] &quot;CMR_viirs_100m_2020.tif&quot;                                
## [41] &quot;CMR_wdpa_dst_cat1_100m_2017.tif&quot;</code></pre>
<p>Once all the covariates are imported, they can be stacked using the <code>rast()</code> function as follows. This means that the data can be processed more efficiently through extracting all rasters at once rather than needing to extract each raster individually.</p>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb610-1" tabindex="-1"></a><span class="co">#stack all covariates</span></span>
<span id="cb610-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb610-2" tabindex="-1"></a>cont_raster_covariates <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">paste0</span>(raster_path1, <span class="fu">c</span>(raster_list)))</span></code></pre></div>
<p>For visualisation, using the <code>plot()</code> function as discussed in Module 2, the raster can be plotted.</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb611-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb611-1" tabindex="-1"></a><span class="co">#plot first raster</span></span>
<span id="cb611-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb611-2" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(cont_raster_covariates[[<span class="dv">1</span>]])</span></code></pre></div>
<p><img src="WorldPop_Training_Manual_files/figure-html/plot%20raster-1.png" width="672" /></p>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb612-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb612-1" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot</span>(cont_raster_covariates[[<span class="dv">2</span>]])</span></code></pre></div>
<p><img src="WorldPop_Training_Manual_files/figure-html/plot%20raster-2.png" width="672" /></p>
<p>The function <code>exact_extract()</code> from the <code>exactextractr</code> package can be used as follows to extract the covariate information from the stack of rasters, through including the raster stack and population shapefile as arguments in addition to specifying the function used to extract the rasters with the argument <code>fun =</code>. In this case, to use the mean the argument <code>fun = 'mean'</code> is given, which extracts the mean value of the covariate information for each polygon region.</p>
<p>The functions <code>tic()</code> and <code>toc()</code> from the <code>tictoc</code> package can be used to compute the elapsed time required for running the function, it is not necessary to time the process but can be beneficial to know how long a section of code takes to run, for example, to know how long to expect it to take in future for time management and planning purposes. To do this, place the <code>tic()</code> function at the start of the code you wish to time and place the <code>toc()</code> function at the end. Without additional parameters, the amount of time elapsed to run the code between the two functions will be outputted at the end.</p>
<div class="sourceCode" id="cb613"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb613-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb613-1" tabindex="-1"></a><span class="co">#Extract rasters using their mean values</span></span>
<span id="cb613-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb613-2" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb613-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb613-3" tabindex="-1"></a>cont_raster_extract <span class="ot">&lt;-</span> <span class="fu">exact_extract</span>(cont_raster_covariates, pop_data_shp, </span>
<span id="cb613-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb613-4" tabindex="-1"></a>                                     <span class="at">fun =</span> <span class="st">&#39;mean&#39;</span>)</span>
<span id="cb613-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb613-5" tabindex="-1"></a><span class="fu">toc</span>()</span></code></pre></div>
<p>Functions discussed in earlier modules can then be used to extract further information from the raster data. The function <code>names()</code> can be used to check and extract the names of the rasters, with the function <code>colnames()</code> being used to change the names to something more uniform such as <code>x1</code>, <code>x2</code>, … in that order. Finally, the variable names can be combined with the <code>cbind()</code> function and exported as a <code>.csv</code> file with the function <code>write.csv()</code>. Each of these operations are demonstrated below.</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb614-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb614-1" tabindex="-1"></a><span class="co">#check names of rasters</span></span>
<span id="cb614-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb614-2" tabindex="-1"></a><span class="fu">names</span>(cont_raster_extract)</span>
<span id="cb614-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb614-3" tabindex="-1"></a></span>
<span id="cb614-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb614-4" tabindex="-1"></a><span class="co">#extract variable names</span></span>
<span id="cb614-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb614-5" tabindex="-1"></a>var_names <span class="ot">&lt;-</span> <span class="fu">names</span>(cont_raster_extract)</span>
<span id="cb614-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb614-6" tabindex="-1"></a></span>
<span id="cb614-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb614-7" tabindex="-1"></a><span class="co">#change names to x1, x2, x3... in that order</span></span>
<span id="cb614-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb614-8" tabindex="-1"></a><span class="fu">colnames</span>(cont_raster_extract) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">&#39;x&#39;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">41</span>))</span>
<span id="cb614-9"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb614-9" tabindex="-1"></a></span>
<span id="cb614-10"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb614-10" tabindex="-1"></a><span class="co">#extract names of raster</span></span>
<span id="cb614-11"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb614-11" tabindex="-1"></a>var_names2<span class="ot">&lt;-</span> <span class="fu">names</span>(cont_raster_extract)</span>
<span id="cb614-12"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb614-12" tabindex="-1"></a></span>
<span id="cb614-13"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb614-13" tabindex="-1"></a><span class="co">#cbind names</span></span>
<span id="cb614-14"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb614-14" tabindex="-1"></a>var_names <span class="ot">&lt;-</span> <span class="fu">cbind</span>(var_names, var_names2) <span class="sc">%&gt;%</span> </span>
<span id="cb614-15"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb614-15" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb614-16"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb614-16" tabindex="-1"></a></span>
<span id="cb614-17"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb614-17" tabindex="-1"></a><span class="co">#export names</span></span>
<span id="cb614-18"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb614-18" tabindex="-1"></a><span class="fu">write.csv</span>(var_names, <span class="fu">paste0</span>(output_path, <span class="st">&quot;var_names.csv&quot;</span>))</span></code></pre></div>
</div>
<div id="extracting-categorical-rasters" class="section level3 hasAnchor" number="8.2.2">
<h3><span class="header-section-number">8.2.2</span> Extracting categorical rasters<a href="bayesian-hierarchical-population-modelling-in-r.html#extracting-categorical-rasters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Similar methods to those used for continuous rasters can be used to extract categorical rasters. The first step is to use the <code>list.files()</code> function to import the categorical raster covariates into R, then stacking all of the covariates with the <code>rast()</code> function.</p>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb615-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb615-1" tabindex="-1"></a><span class="co">#import all categorical raster covariates </span></span>
<span id="cb615-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb615-2" tabindex="-1"></a>raster_list <span class="ot">&lt;-</span><span class="fu">list.files</span>(<span class="at">path =</span> raster_path2, <span class="at">pattern =</span> <span class="st">&quot;.tif$&quot;</span>, </span>
<span id="cb615-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb615-3" tabindex="-1"></a>                         <span class="at">all.files =</span> <span class="cn">TRUE</span>, <span class="at">full.names =</span> <span class="cn">FALSE</span>) </span>
<span id="cb615-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb615-4" tabindex="-1"></a>raster_list</span></code></pre></div>
<pre><code>## [1] &quot;CMR_Department.tif&quot;                &quot;CMR_Regions.tif&quot;                  
## [3] &quot;CMR_Settlement_Classification.tif&quot;</code></pre>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb617-1" tabindex="-1"></a><span class="co">#stack all covariates</span></span>
<span id="cb617-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb617-2" tabindex="-1"></a>cat_raster_covariates <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">paste0</span>(raster_path2, <span class="fu">c</span>(raster_list)))</span></code></pre></div>
<p>The following step is to extract the rasters using the <code>exact_extract()</code> function. However, instead of using the mean function, the modal value is now used to extract the rasters with the argument <code>fun = 'mode'</code>, extracting the modal value of the categorical covariate information (the category with highest frequency of occurrence) from the polygon regions.</p>
<p>Finally, the variables can be renamed with the function <code>rename()</code> with arguments for the names of the individual variables using the format <code>new_name = old_name</code>.</p>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb618-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb618-1" tabindex="-1"></a><span class="co">#rename variables</span></span>
<span id="cb618-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb618-2" tabindex="-1"></a>cat_raster_extract <span class="ot">&lt;-</span> cat_raster_extract <span class="sc">%&gt;%</span> </span>
<span id="cb618-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb618-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Regions =</span> mode.CMR_Regions,</span>
<span id="cb618-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb618-4" tabindex="-1"></a>         <span class="at">Department =</span> mode.CMR_Department,</span>
<span id="cb618-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb618-5" tabindex="-1"></a>         <span class="at">Settlement_Type =</span> mode.CMR_Settlement_Classification)</span></code></pre></div>
</div>
<div id="extracting-building-count" class="section level3 hasAnchor" number="8.2.3">
<h3><span class="header-section-number">8.2.3</span> Extracting building count<a href="bayesian-hierarchical-population-modelling-in-r.html#extracting-building-count" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Another of the covariates given for this dataset is the building count, indicated by the file name <code>CMR_buildings_count.tif</code>. To load this file, the function <code>rast()</code> can be used with the mastergrid and shapefile as arguments.</p>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb619-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb619-1" tabindex="-1"></a><span class="co">#load b_count</span></span>
<span id="cb619-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb619-2" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">paste0</span>(mgrid_path,<span class="st">&quot;CMR_buildings_count.tif&quot;</span>)) </span></code></pre></div>
<p>Once the building count has been loaded, the function <code>extract()</code> from the <code>terra</code> package can be used to extract the values with arguments for the building count and population shapefile as arguments with the function argument specified as <code>fun = sum</code> and removing NA values as <code>na.rm = TRUE</code>.</p>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb620-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb620-1" tabindex="-1"></a><span class="co">#extract values</span></span>
<span id="cb620-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb620-2" tabindex="-1"></a>B_Count <span class="ot">&lt;-</span>terra<span class="sc">::</span><span class="fu">extract</span>(r1, pop_data_shp, <span class="at">fun =</span> sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Finally, the variables can be reamed with the <code>select()</code> function from the <code>dplyr</code> package, in addition to the <code>rename()</code> function.</p>
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb621-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb621-1" tabindex="-1"></a><span class="co">#rename variable</span></span>
<span id="cb621-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb621-2" tabindex="-1"></a>B_Count <span class="ot">&lt;-</span> B_Count <span class="sc">%&gt;%</span> </span>
<span id="cb621-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb621-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(CMR_buildings_count)<span class="sc">%&gt;%</span> </span>
<span id="cb621-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb621-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Total_Building_Count =</span> CMR_buildings_count)</span></code></pre></div>
</div>
<div id="exracting-building-total-area" class="section level3 hasAnchor" number="8.2.4">
<h3><span class="header-section-number">8.2.4</span> Exracting building total area<a href="bayesian-hierarchical-population-modelling-in-r.html#exracting-building-total-area" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Similar methods can be used as for extracting building count to extract the building total area, starting with using the function <code>rast()</code> to load the building total area data.</p>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb622-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb622-1" tabindex="-1"></a><span class="co">#building Area</span></span>
<span id="cb622-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb622-2" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">paste0</span>(mgrid_path,<span class="st">&quot;CMR_buildings_total_area.tif&quot;</span>)) </span></code></pre></div>
<p>Then the <code>extract()</code> function from the <code>terra</code> package can be used to extract the values. As with for the building count, the building area and shapefile is given as arguments, in addition to the function for summing the values <code>fun = sum</code> and setting <code>na.rm = TRUE</code>.</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb623-1" tabindex="-1"></a><span class="co">#extract values</span></span>
<span id="cb623-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb623-2" tabindex="-1"></a>B_Area <span class="ot">&lt;-</span>terra<span class="sc">::</span><span class="fu">extract</span>(r2, pop_data_shp, <span class="at">fun =</span> sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>The last step is to then rename the variables with the <code>select()</code> and <code>rename()</code> functions as before.</p>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb624-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb624-1" tabindex="-1"></a><span class="co">#rename variable</span></span>
<span id="cb624-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb624-2" tabindex="-1"></a>B_Area <span class="ot">&lt;-</span> B_Area <span class="sc">%&gt;%</span> </span>
<span id="cb624-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb624-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(CMR_buildings_total_area)<span class="sc">%&gt;%</span> </span>
<span id="cb624-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb624-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Total_Building_Area =</span> CMR_buildings_total_area)</span></code></pre></div>
<p>Once you have your variables of interest, the function <code>cbind()</code> can be used to combine the variables together into a complete population dataset.</p>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb625-1" tabindex="-1"></a><span class="co">#column bind the variables together to create a dataset</span></span>
<span id="cb625-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb625-2" tabindex="-1"></a>Pop_Data_Complete <span class="ot">&lt;-</span> <span class="fu">cbind</span>(pop_data_shp, cat_raster_extract, B_Count, </span>
<span id="cb625-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb625-3" tabindex="-1"></a>                           B_Area,cont_raster_extract)</span></code></pre></div>
</div>
<div id="adding-admin-area-names-to-the-data" class="section level3 hasAnchor" number="8.2.5">
<h3><span class="header-section-number">8.2.5</span> Adding admin area names to the data<a href="bayesian-hierarchical-population-modelling-in-r.html#adding-admin-area-names-to-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To add admin area names to the dataset, first the relevant shapefiles need to be identified and loaded into R with the function <code>st_read()</code>. In this case, following the <code>shapefile_path</code>, the relevant shapefiles are for the region and department.</p>
<div class="sourceCode" id="cb626"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb626-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb626-1" tabindex="-1"></a><span class="co">#load the shapefiles for region and department</span></span>
<span id="cb626-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb626-2" tabindex="-1"></a>regions <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">paste0</span>(shapefile_path, <span class="st">&quot;Region_SHP.shp&quot;</span>))</span></code></pre></div>
<pre><code>## Reading layer `Region_SHP&#39; from data source 
##   `F:\Study\WorldPop Training Materials\GitBook\wp_training_manual\data\CMR\Shapefiles\Region_SHP.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 10 features and 2 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 945997.2 ymin: 182845.8 xmax: 1802307 ymax: 1458913
## Projected CRS: WGS 84 / World Mercator</code></pre>
<div class="sourceCode" id="cb628"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb628-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb628-1" tabindex="-1"></a>dept <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">paste0</span>(shapefile_path, <span class="st">&quot;Departement_SHP.shp&quot;</span>))</span></code></pre></div>
<pre><code>## Reading layer `Departement_SHP&#39; from data source 
##   `F:\Study\WorldPop Training Materials\GitBook\wp_training_manual\data\CMR\Shapefiles\Departement_SHP.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 58 features and 3 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 945997.2 ymin: 182845.8 xmax: 1802307 ymax: 1458913
## Projected CRS: WGS 84 / World Mercator</code></pre>
<p>From there, the region names and IDs can be selected using the <code>select()</code> function, in conjunction with the <code>rename()</code> function to better identify the region.</p>
<div class="sourceCode" id="cb630"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb630-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb630-1" tabindex="-1"></a><span class="co">#select region names and ids</span></span>
<span id="cb630-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb630-2" tabindex="-1"></a>regions <span class="ot">&lt;-</span> regions <span class="sc">%&gt;%</span> </span>
<span id="cb630-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb630-3" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb630-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb630-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id, libelle) <span class="sc">%&gt;%</span> </span>
<span id="cb630-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb630-5" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">region_libelle =</span> libelle)</span></code></pre></div>
<p>To join the regions to the complete data, the function <code>inner_join()</code> introduced in an earlier module can be used, including the <code>regions</code> as an argument with specification of how to join the data with the <code>by =</code> argument.</p>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb631-1" tabindex="-1"></a><span class="co">#join regions to complete data</span></span>
<span id="cb631-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb631-2" tabindex="-1"></a>Pop_Data_Complete <span class="ot">&lt;-</span> Pop_Data_Complete <span class="sc">%&gt;%</span> </span>
<span id="cb631-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb631-3" tabindex="-1"></a>  <span class="fu">inner_join</span>(regions, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Regions&quot;</span><span class="ot">=</span><span class="st">&quot;id&quot;</span>))</span></code></pre></div>
<p>Additionally, the department names can be selected and joined to the data using the same methods shown above.</p>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb632-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb632-1" tabindex="-1"></a><span class="co">#select department names </span></span>
<span id="cb632-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb632-2" tabindex="-1"></a>dept <span class="ot">&lt;-</span> dept <span class="sc">%&gt;%</span> </span>
<span id="cb632-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb632-3" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb632-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb632-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id, libelle) <span class="sc">%&gt;%</span> </span>
<span id="cb632-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb632-5" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dept_libelle =</span> libelle)</span>
<span id="cb632-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb632-6" tabindex="-1"></a></span>
<span id="cb632-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb632-7" tabindex="-1"></a><span class="co">#join department to the complete data</span></span>
<span id="cb632-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb632-8" tabindex="-1"></a>Pop_Data_Complete <span class="ot">&lt;-</span> Pop_Data_Complete <span class="sc">%&gt;%</span> </span>
<span id="cb632-9"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb632-9" tabindex="-1"></a>  <span class="fu">inner_join</span>(dept, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Department&quot;</span><span class="ot">=</span><span class="st">&quot;id&quot;</span>))</span></code></pre></div>
<p>The <code>select()</code> function can then be used to sort the data into a proper order before exporting the resulting shapefile as a geopackage file with the <code>write_sf()</code> function.</p>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb633-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb633-1" tabindex="-1"></a><span class="co">#sort data in proper order</span></span>
<span id="cb633-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb633-2" tabindex="-1"></a>Pop_Data_Complete <span class="ot">&lt;-</span> Pop_Data_Complete <span class="sc">%&gt;%</span> </span>
<span id="cb633-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb633-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(EA_ID, Department, dept_libelle, Regions, region_libelle,</span>
<span id="cb633-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb633-4" tabindex="-1"></a>                Total_Pop, Settlement_Type, Total_Building_Count,</span>
<span id="cb633-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb633-5" tabindex="-1"></a>                Total_Building_Area, <span class="fu">starts_with</span>(<span class="st">&quot;x&quot;</span>))</span>
<span id="cb633-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb633-6" tabindex="-1"></a></span>
<span id="cb633-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb633-7" tabindex="-1"></a><span class="co">#export shapefile as a geopackage file</span></span>
<span id="cb633-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb633-8" tabindex="-1"></a><span class="fu">write_sf</span>(Pop_Data_Complete, <span class="fu">paste0</span>(output_path,<span class="st">&quot;Pop_Data_Complete.gpkg&quot;</span>))</span></code></pre></div>
<p>Alternatively, the shapefile can be converted to a data frame with the <code>as.data.frame()</code> function, before removing the geometry with the <code>select()</code> function to export as a <code>.csv</code> file with the <code>write.csv()</code> function.</p>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb634-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb634-1" tabindex="-1"></a><span class="co">#convert shapefile to data frame</span></span>
<span id="cb634-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb634-2" tabindex="-1"></a>Pop_Data_Complete1 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(Pop_Data_Complete)</span>
<span id="cb634-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb634-3" tabindex="-1"></a></span>
<span id="cb634-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb634-4" tabindex="-1"></a><span class="co">#remove Geometry</span></span>
<span id="cb634-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb634-5" tabindex="-1"></a>Pop_Data_Complete1  <span class="ot">&lt;-</span> Pop_Data_Complete1  <span class="sc">%&gt;%</span> </span>
<span id="cb634-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb634-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>geometry)</span>
<span id="cb634-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb634-7" tabindex="-1"></a></span>
<span id="cb634-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb634-8" tabindex="-1"></a><span class="co">#export data frame as csv</span></span>
<span id="cb634-9"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb634-9" tabindex="-1"></a><span class="fu">write.csv</span>(Pop_Data_Complete1, <span class="fu">paste0</span>(output_path, <span class="st">&quot;Pop_Data_Complete.csv&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="exploratory-analysis" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Exploratory analysis<a href="bayesian-hierarchical-population-modelling-in-r.html#exploratory-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To start with, the dataset resulting from the code in the previous section <code>Pop_Data_Complete.csv</code> will be used, in addition to the variable names file created earlier.</p>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb635-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb635-1" tabindex="-1"></a><span class="co">#input the data</span></span>
<span id="cb635-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb635-2" tabindex="-1"></a>Data_CMR <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(data_path,<span class="st">&quot;Pop_Data_Complete.csv&quot;</span>))</span>
<span id="cb635-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb635-3" tabindex="-1"></a></span>
<span id="cb635-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb635-4" tabindex="-1"></a><span class="co">#load the variable names file</span></span>
<span id="cb635-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb635-5" tabindex="-1"></a>var_names <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(data_path,<span class="st">&quot;var_names.csv&quot;</span>)) </span></code></pre></div>
<p>As introduced in Module 2, the <code>describe()</code> function from the <code>psych</code> package can be used to give a summary of the data, similarly, the <code>str()</code> function can be used to display the structure of the data.</p>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb636-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb636-1" tabindex="-1"></a><span class="co">#load the psych package</span></span>
<span id="cb636-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb636-2" tabindex="-1"></a><span class="fu">library</span>(psych)</span></code></pre></div>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb637-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb637-1" tabindex="-1"></a><span class="co">#describe the data using both str() and describe()</span></span>
<span id="cb637-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb637-2" tabindex="-1"></a><span class="fu">str</span>(Data_CMR); </span>
<span id="cb637-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb637-3" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(Data_CMR)</span></code></pre></div>
<div id="basic-visualisation" class="section level3 hasAnchor" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> Basic visualisation<a href="bayesian-hierarchical-population-modelling-in-r.html#basic-visualisation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To visualise the data, methods discussed in Modules 2 and 3 can be used.</p>
<p>To examine the distribution of the data, a histogram can be plotted using the <code>ggplot()</code> function within the <code>ggplot2</code> package.</p>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb638-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb638-1" tabindex="-1"></a><span class="co">#examine data distribution using histograms</span></span>
<span id="cb638-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb638-2" tabindex="-1"></a>p1<span class="ot">&lt;-</span> Data_CMR <span class="sc">%&gt;%</span> </span>
<span id="cb638-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb638-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Total_Pop<span class="sc">/</span>Total_Building_Count)) <span class="sc">+</span></span>
<span id="cb638-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb638-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;#004C92&quot;</span>, <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>)<span class="sc">+</span></span>
<span id="cb638-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb638-5" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="st">&quot;#004C92&quot;</span>) <span class="sc">+</span></span>
<span id="cb638-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb638-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Histogram of population density&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Population density&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Frequency&quot;</span>)<span class="sc">+</span></span>
<span id="cb638-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb638-7" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb638-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb638-8" tabindex="-1"></a>p1</span></code></pre></div>
<pre><code>## Warning: Removed 3 rows containing non-finite outside the scale range (`stat_bin()`).</code></pre>
<p><img src="WorldPop_Training_Manual_files/figure-html/visualise%20data-1.png" width="672" /></p>
<p>Alternatively, a box plot can be used to investigate any outliers in continuous variables. This time, the function <code>boxplot()</code> from <code>base</code> R, also as seen in Module 2, to display the information from just one continuous covariate at a time and also information from multiple continuous covariates at a time.</p>
<div class="sourceCode" id="cb640"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb640-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb640-1" tabindex="-1"></a><span class="co">#investigate outliers in continuous variables using box plots</span></span>
<span id="cb640-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb640-2" tabindex="-1"></a><span class="fu">boxplot</span>(Data_CMR[,<span class="st">&quot;Total_Pop&quot;</span>])</span></code></pre></div>
<p><img src="WorldPop_Training_Manual_files/figure-html/boxplots-1.png" width="672" /></p>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb641-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb641-1" tabindex="-1"></a><span class="co">#visualise the box plots of multiple continuous covariates at a time</span></span>
<span id="cb641-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb641-2" tabindex="-1"></a><span class="fu">boxplot</span>(Data_CMR[,<span class="fu">paste0</span>(<span class="st">&quot;x&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)], <span class="at">col =</span> <span class="fu">rainbow</span>(<span class="dv">7</span>))</span></code></pre></div>
<p><img src="WorldPop_Training_Manual_files/figure-html/boxplots-2.png" width="672" /></p>
<p>For categorical variables, bar plots can be used to examine the distribution of the data. For example, in this case, the distribution of settlement types can be visualised with a bar plot, where it can be seen that settlement type 1 has the highest frequency of occurrence, and settlement type 2 the lowest.</p>
<div class="sourceCode" id="cb642"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb642-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb642-1" tabindex="-1"></a><span class="co">#examine distribution of categorical variable using bar charts</span></span>
<span id="cb642-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb642-2" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(Data_CMR<span class="sc">$</span>Settlement_Type), <span class="at">col =</span> <span class="st">&quot;#004C92&quot;</span>)</span></code></pre></div>
<p><img src="WorldPop_Training_Manual_files/figure-html/bar%20plot-1.png" width="672" /></p>
<p>The <code>mutate()</code> function can also be used to transform data before plotting, in this instance, log-transform the population density to plot a histogram of the log-transformed population density.</p>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb643-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb643-1" tabindex="-1"></a><span class="co">#transformed data </span></span>
<span id="cb643-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb643-2" tabindex="-1"></a>p2<span class="ot">&lt;-</span> Data_CMR <span class="sc">%&gt;%</span> </span>
<span id="cb643-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb643-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">logDensity =</span> <span class="fu">log</span>(Total_Pop<span class="sc">/</span>Total_Building_Count)) <span class="sc">%&gt;%</span></span>
<span id="cb643-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb643-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> logDensity)) <span class="sc">+</span></span>
<span id="cb643-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb643-5" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;#E69F00&quot;</span>, <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>)<span class="sc">+</span></span>
<span id="cb643-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb643-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Histogram of log-transformed </span><span class="sc">\n</span><span class="st"> population density&quot;</span>, </span>
<span id="cb643-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb643-7" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Log(Population density)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Frequency&quot;</span>)<span class="sc">+</span></span>
<span id="cb643-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb643-8" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb643-9"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb643-9" tabindex="-1"></a>p2</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<pre><code>## Warning: Removed 3 rows containing non-finite outside the scale range (`stat_bin()`).</code></pre>
<p><img src="WorldPop_Training_Manual_files/figure-html/transform%20the%20data%20and%20plot-1.png" width="672" /></p>
<p>The correlation among multiple continuous covariates can be examined through using the function <code>corrplot()</code> from the package <code>corrplot</code>. This is not something which has been previously discussed, but can be used as in the example below with the Cameroon data. To use this plot function, the covariates you wish to explore the correlation between must be specified, along with arguments for the visualisation method used (in this case, <code>method=square</code>) and the type of matrix (in this case, <code>type=upper</code> for an upper triangular matrix). For more information on the possible arguments and how to use them, look at the help file <code>?corrplot::corrplot</code>.</p>
<div class="sourceCode" id="cb646"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb646-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb646-1" tabindex="-1"></a><span class="co">#load the corrplot package</span></span>
<span id="cb646-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb646-2" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span></code></pre></div>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb647-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb647-1" tabindex="-1"></a><span class="co">#examine correlation among multiple continuous covariates using corrplot</span></span>
<span id="cb647-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb647-2" tabindex="-1"></a><span class="fu">corrplot</span>(</span>
<span id="cb647-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb647-3" tabindex="-1"></a>  <span class="fu">cor</span>(Data_CMR[,<span class="fu">paste0</span>(<span class="st">&quot;x&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)]),</span>
<span id="cb647-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb647-4" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&#39;square&#39;</span>,</span>
<span id="cb647-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb647-5" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&#39;upper&#39;</span>,</span>
<span id="cb647-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb647-6" tabindex="-1"></a>  <span class="at">tl.col =</span> <span class="st">&#39;black&#39;</span>,</span>
<span id="cb647-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb647-7" tabindex="-1"></a>  <span class="at">tl.cex =</span> <span class="dv">1</span>,</span>
<span id="cb647-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb647-8" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">&#39;purple&#39;</span>, <span class="st">&#39;dark green&#39;</span>))(<span class="dv">200</span>)</span>
<span id="cb647-9"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb647-9" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="WorldPop_Training_Manual_files/figure-html/corrplot-1.png" width="672" /></p>
<p>Lastly, the function <code>ggarrange</code> from the package <code>ggpubr</code> can be used as discussed in Module 2 to keep the plots tidy and display them together.</p>
<div class="sourceCode" id="cb648"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb648-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb648-1" tabindex="-1"></a><span class="co">#load the ggpubr package</span></span>
<span id="cb648-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb648-2" tabindex="-1"></a><span class="fu">library</span>(ggpubr) <span class="co">#used within ggplot to keep plots tidier</span></span></code></pre></div>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb649-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb649-1" tabindex="-1"></a><span class="co">#arrange the plots side-by-side</span></span>
<span id="cb649-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb649-2" tabindex="-1"></a><span class="fu">ggarrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="WorldPop_Training_Manual_files/figure-html/arrange%20plots-1.png" width="672" /></p>
</div>
<div id="geospatial-visualisation" class="section level3 hasAnchor" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> Geospatial visualisation<a href="bayesian-hierarchical-population-modelling-in-r.html#geospatial-visualisation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To visualise the data on a map similar to as in Module 3, the following packages should be installed and loaded.</p>
<div class="sourceCode" id="cb650"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb650-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb650-1" tabindex="-1"></a><span class="co">#install the relevant packages</span></span>
<span id="cb650-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb650-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tmap&quot;</span>)</span>
<span id="cb650-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb650-3" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;terra&quot;</span>)</span>
<span id="cb650-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb650-4" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;leaflet&quot;</span>)</span>
<span id="cb650-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb650-5" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;mapview&quot;</span>)</span>
<span id="cb650-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb650-6" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;units&quot;</span>)</span>
<span id="cb650-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb650-7" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</span>
<span id="cb650-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb650-8" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;RColorBrewer&quot;</span>)</span>
<span id="cb650-9"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb650-9" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;exactextractr&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb651"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb651-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb651-1" tabindex="-1"></a><span class="co">#load the relevant packages</span></span>
<span id="cb651-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb651-2" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb651-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb651-3" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb651-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb651-4" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb651-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb651-5" tabindex="-1"></a><span class="fu">library</span>(mapview)</span>
<span id="cb651-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb651-6" tabindex="-1"></a><span class="fu">library</span>(units)</span>
<span id="cb651-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb651-7" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb651-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb651-8" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb651-9"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb651-9" tabindex="-1"></a><span class="fu">library</span>(exactextractr)</span>
<span id="cb651-10"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb651-10" tabindex="-1"></a><span class="co"># tmap_options(check.and.fix = TRUE) #fix potential issues during the processing</span></span></code></pre></div>
<p>The country’s (Cameroon) national boundary is can be extracted from the <code>World</code> dataset from the <code>tmap</code> package which produces a world map. Following that, using the <code>filter()</code> function, Cameroon can be subset from the world map and visualised.</p>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb652-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb652-1" tabindex="-1"></a><span class="co">#extract the boundary for the country</span></span>
<span id="cb652-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb652-2" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;World&quot;</span>)</span>
<span id="cb652-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb652-3" tabindex="-1"></a><span class="fu">class</span>(World)</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb654"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb654-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb654-1" tabindex="-1"></a><span class="fu">names</span>(World)</span></code></pre></div>
<pre><code>##  [1] &quot;iso_a3&quot;       &quot;name&quot;         &quot;sovereignt&quot;   &quot;continent&quot;    &quot;area&quot;         &quot;pop_est&quot;     
##  [7] &quot;pop_est_dens&quot; &quot;economy&quot;      &quot;income_grp&quot;   &quot;gdp_cap_est&quot;  &quot;life_exp&quot;     &quot;well_being&quot;  
## [13] &quot;footprint&quot;    &quot;inequality&quot;   &quot;HPI&quot;          &quot;geometry&quot;</code></pre>
<div class="sourceCode" id="cb656"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb656-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb656-1" tabindex="-1"></a><span class="fu">tm_shape</span>(World) <span class="sc">+</span></span>
<span id="cb656-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb656-2" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">&quot;name&quot;</span>,</span>
<span id="cb656-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb656-3" tabindex="-1"></a>              <span class="at">legend.show =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Warning: Number of levels of the variable &quot;name&quot; is 177, which is larger than max.categories (which is
## 30), so levels are combined. Set tmap_options(max.categories = 177) in the layer function to show all
## levels.</code></pre>
<p><img src="WorldPop_Training_Manual_files/figure-html/extract%20boundary-1.png" width="672" /></p>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb658-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb658-1" tabindex="-1"></a><span class="co">#subset Cameroon</span></span>
<span id="cb658-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb658-2" tabindex="-1"></a>cmr_national <span class="ot">&lt;-</span> World <span class="sc">%&gt;%</span> <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;Cameroon&quot;</span>)</span>
<span id="cb658-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb658-3" tabindex="-1"></a><span class="co">#visualise the Cameroon boundary map</span></span>
<span id="cb658-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb658-4" tabindex="-1"></a><span class="fu">tm_shape</span>(cmr_national) <span class="sc">+</span></span>
<span id="cb658-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb658-5" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">&quot;gray&quot;</span>,</span>
<span id="cb658-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb658-6" tabindex="-1"></a>              <span class="at">legend.show =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb658-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb658-7" tabindex="-1"></a>    <span class="fu">tm_compass</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;top&quot;</span>), <span class="at">text.size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb658-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb658-8" tabindex="-1"></a>    <span class="fu">tm_scale_bar</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;top&quot;</span>), <span class="at">text.size =</span> <span class="fl">1.5</span>, <span class="at">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Warning: The argument size of tm_scale_bar is deprecated. It has been renamed to text.size</code></pre>
<p><img src="WorldPop_Training_Manual_files/figure-html/extract%20boundary-2.png" width="672" /></p>
<p>To visualise data on the map of Cameroon, starting with points data, the corresponding datasets first need to be imported into R.</p>
<div class="sourceCode" id="cb660"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb660-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb660-1" tabindex="-1"></a><span class="co">#EA shapefile</span></span>
<span id="cb660-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb660-2" tabindex="-1"></a>ea_shp <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">paste0</span>(data_path,<span class="st">&quot;Pop_Data_Complete.gpkg&quot;</span>)) </span></code></pre></div>
<pre><code>## Reading layer `Pop_Data_Complete&#39; from data source 
##   `F:\Study\WorldPop Training Materials\GitBook\wp_training_manual\data\CMR\Pop_Data_Complete.gpkg&#39; 
##   using driver `GPKG&#39;
## Simple feature collection with 1592 features and 50 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 8.498025 ymin: 1.653369 xmax: 16.1904 ymax: 12.96129
## Geodetic CRS:  WGS 84</code></pre>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb662-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb662-1" tabindex="-1"></a><span class="co">#admin 2 (departments) shapefile</span></span>
<span id="cb662-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb662-2" tabindex="-1"></a>department <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">paste0</span>(data_path,<span class="st">&quot;/Shapefiles/Departement_SHP.shp&quot;</span>)) </span></code></pre></div>
<pre><code>## Reading layer `Departement_SHP&#39; from data source 
##   `F:\Study\WorldPop Training Materials\GitBook\wp_training_manual\data\CMR\Shapefiles\Departement_SHP.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 58 features and 3 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 945997.2 ymin: 182845.8 xmax: 1802307 ymax: 1458913
## Projected CRS: WGS 84 / World Mercator</code></pre>
<p>Once you have the data in the R environment, the points (centroids of the polygons) can be extracted from the files. Below, the function <code>as()</code> is used to convert the geometry obtained from the shapefiles with the function <code>st_geometry()</code> to a spatial object.</p>
<div class="sourceCode" id="cb664"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb664-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb664-1" tabindex="-1"></a><span class="co">#extract the points</span></span>
<span id="cb664-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb664-2" tabindex="-1"></a>shp <span class="ot">&lt;-</span> <span class="fu">as</span>(<span class="fu">st_geometry</span>(ea_shp), <span class="st">&quot;Spatial&quot;</span>) <span class="co">#convert to spatial object</span></span>
<span id="cb664-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb664-3" tabindex="-1"></a>shp0 <span class="ot">&lt;-</span> <span class="fu">as</span>(<span class="fu">st_geometry</span>(cmr_national), <span class="st">&quot;Spatial&quot;</span>) <span class="co">#convert cmr_national to spatial object</span></span>
<span id="cb664-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb664-4" tabindex="-1"></a>shp2 <span class="ot">&lt;-</span> <span class="fu">as</span>(<span class="fu">st_geometry</span>(department), <span class="st">&quot;Spatial&quot;</span>) <span class="co">#convert department to spatial object</span></span></code></pre></div>
<p>The longitude and latitude can then be extracted and added to the main Cameroon demographic data as variables. This will enable the points to be plotted in the correct locations on the map of Cameroon.</p>
<div class="sourceCode" id="cb665"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb665-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb665-1" tabindex="-1"></a><span class="co">#add the lon-lat to the demographic data</span></span>
<span id="cb665-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb665-2" tabindex="-1"></a>Data_CMR<span class="sc">$</span>lon <span class="ot">&lt;-</span> <span class="fu">coordinates</span>(shp)[,<span class="dv">1</span>] <span class="co">#extract and add the longitude to the data</span></span>
<span id="cb665-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb665-3" tabindex="-1"></a>Data_CMR<span class="sc">$</span>lat <span class="ot">&lt;-</span> <span class="fu">coordinates</span>(shp)[,<span class="dv">2</span>] <span class="co">#extract and add the latitude to the data</span></span>
<span id="cb665-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb665-4" tabindex="-1"></a></span>
<span id="cb665-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb665-5" tabindex="-1"></a><span class="fu">head</span>(Data_CMR, <span class="dv">6</span>)</span></code></pre></div>
<pre><code>##   X           EA_ID Department     dept_libelle Regions region_libelle Total_Pop Settlement_Type
## 1 1 ABONG - MBANG_6         30       Haut Nyong       3            Est       890               1
## 2 2    AFANLOUM_702          3  Mefou et Afamba       2         Centre       815               4
## 3 3       AKOEMAN_3         49     Nyong et Soo       2         Centre       764               4
## 4 4     AKOM II_702         25            Ocean      10            Sud       746               4
## 5 5   AKONOLINGA_18         50 Nyong et Mfoumou       2         Centre      1109               4
## 6 6  AKONOLINGA_700         50 Nyong et Mfoumou       2         Centre      1357               4
##   Total_Building_Count Total_Building_Area       x1       x2       x3        x4       x5        x6
## 1                  286            32018.38 240337.7 86203.41 413765.8 139978.61 86203.41 184933.17
## 2                  395            38397.15 338154.9 36501.53 317968.1  36501.53 36501.53  74746.61
## 3                  367            33433.51 437903.8 54406.30 278816.8  72425.01 54406.30  72425.01
## 4                  269            24597.57 572474.0 65059.10 207275.2 167467.12 65059.10 171884.52
## 5                  286            39113.68 346930.5 47410.98 334817.6  80121.03 47410.98  80121.03
## 6                  402            30872.22 344902.1 55245.77 333230.8  76245.29 55245.77  78916.31
##          x7        x8        x9       x10       x11       x12      x13       x14       x15        x16
## 1 184933.17  49.00933 0.8580208 0.5127055 1874.8511 124.96131 43.36115 663.00330 369.54599 66.4226456
## 2  74746.61  94.78092 0.3557110 0.2034208  294.0987 102.34338 39.95544  96.79045 264.67972 28.3830357
## 3  72425.01  88.32083 0.3629119 0.2126397  328.2499  90.47405 36.73468 104.04270 177.91858 22.1087456
## 4 171884.52 399.27695 0.3817135 0.2085105  403.9308 100.72127 39.06967 128.10530  63.06371 29.8604965
## 5  80121.03  65.29633 0.5584586 0.3535644 1485.4635 132.72063 45.55459 590.01727 262.23849  0.5587888
## 6  78916.31  60.77288 0.3845364 0.2158287  318.3337  79.70691 34.87637  92.70645 264.28845  4.6560779
##         x17        x18        x19       x20      x21       x22         x23       x24         x25
## 1 0.2506842  0.2168530  0.8513528 53.339569 571.1937  1.780275 -0.05533693 118.72293 0.001490207
## 2 0.3522204 -0.2481708 11.8486433 11.467803 493.3647 30.267328 26.14026642  77.73151 0.023819378
## 3 2.0923870 -1.9790570 33.6847458 55.099686 515.8448 38.471977 22.51198578 201.92075 0.024310285
## 4 7.1534176 -7.0361733 65.0350876 65.647385 483.9221 62.489433 34.99201965 320.03601 0.045389920
## 5 0.6619807 -0.3192018  0.7926053  1.597502 531.0815  4.531395  0.59316117 115.86395 0.014609964
## 6 0.4313623 -0.3258749  8.7227964  5.226479 525.6237  9.087230  7.94695139 107.66605 0.018198114
##          x26          x27      x28       x29        x30         x31        x32        x33        x34
## 1 0.01200000 4.149579e-05 297.4118  2296.646   288.1877    14.69919   225.3033   390.2323   476.4956
## 2 0.02870464 4.402846e-05 297.6783 35368.785 47777.6641 11518.32129  8068.7568 48683.5234 26756.2227
## 3 0.02861884 5.605924e-05 297.4679 21204.406 28928.2246  1605.29187 38670.0625 40177.6914 31366.0879
## 4 0.04607061 1.064296e-04 298.1458 34093.812 40311.1211  9626.27930  6508.7632 35146.3125 43208.0781
## 5 0.03405531 4.095252e-05 297.7811  1161.185  1691.4470   630.90527 37276.1211  1713.5939  2773.5483
## 6 0.02470175 4.092990e-05 297.7823  7917.528  8837.5303   996.53833 29232.8477  9127.7480  9087.2295
##         x35       x36         x37        x38      x39       x40      x41      lon      lat
## 1  2.410922  99782.04   435.05762   722.6469 694.9709 0.8488668 499.7907 13.17765 3.985047
## 2  8.193155  34135.90  6064.46387 20564.3906 732.0835 0.1883050 387.9030 12.10438 4.195674
## 3 14.047594  51499.27 10335.01562  5314.2729 684.1978 0.1645098 315.3396 11.57054 3.214603
## 4 13.598531 102436.87 23514.07422  8531.0508 603.2908 0.2087497 201.3288 10.45882 2.733207
## 5  1.513200  77467.59    87.84882   354.3566 647.6537 0.3821937 392.5313 12.23236 3.776276
## 6  3.314217  73533.62  3984.64355  4101.4194 691.9840 0.2072315 393.2006 12.22670 3.853698</code></pre>
<p>Once the data is set up, the longitude and latitude coordinates can be combined and the resulting points plotted using the basic <code>plot()</code> function. However, this on its own is not very useful. For the results to be easily interpreted and better visualised, the national boarder can be plotted first with the coordinate points be plotted over the top with the <code>points()</code> function.</p>
<div class="sourceCode" id="cb667"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb667-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb667-1" tabindex="-1"></a><span class="co">#display point data</span></span>
<span id="cb667-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb667-2" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Data_CMR<span class="sc">$</span>lon, Data_CMR<span class="sc">$</span>lat)</span>
<span id="cb667-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb667-3" tabindex="-1"></a><span class="fu">plot</span>(coords, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;longitude&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;latitude&quot;</span>)</span></code></pre></div>
<p><img src="WorldPop_Training_Manual_files/figure-html/plot%20points-1.png" width="672" /></p>
<div class="sourceCode" id="cb668"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb668-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb668-1" tabindex="-1"></a><span class="co">#overlay points on the national boundary</span></span>
<span id="cb668-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb668-2" tabindex="-1"></a><span class="fu">plot</span>(shp0) </span>
<span id="cb668-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb668-3" tabindex="-1"></a><span class="fu">points</span>(coords, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="WorldPop_Training_Manual_files/figure-html/plot%20points-2.png" width="672" /></p>
<!-- Areal data can also be visualised, starting with plotting the Admin 2 level data to give the different departments within the country, then overlaying the points on the national boundary -->
<!-- ```{r} -->
<!-- ### Display Point data -->
<!-- par(mfrow=c(1,2), mar=c(1,2,5,3)) -->
<!-- plot(shp2, col=rainbow(7), -->
<!--      main="Areal data showing \n total observations per unit")  -->
<!-- points(coords_sf, col="red") -->
<!-- ``` -->
</div>
<div id="checking-for-nas" class="section level3 hasAnchor" number="8.3.3">
<h3><span class="header-section-number">8.3.3</span> Checking for NAs<a href="bayesian-hierarchical-population-modelling-in-r.html#checking-for-nas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As it has been discussed in other modules, it is important to check for NA values within your dataset as missing values can greatly affect both computation and results.</p>
<p>To check whether there are any NA values in a chosen dataset, the function <code>is.na()</code> can be used, inputting the selected data as an argument. You can include the entire dataset in this function, or a subset of the chosen dataset. If a single covariate is included as an argument, the function outputs a logical vector the same length as its argument <code>x</code>, indicating whether the corresponding value is missing or not. If the entire dataset or a selection of covariates is used as the argument in the function, a logical matrix is returned with the same dimensions as the data frame included as the argument.</p>
<p>The logical vector (or matrix) returned, is often not of use on its own, particularly if it is very long. What is typically more of interest is the total number of NA values in the data, found using the <code>sum()</code> function with the results from the <code>is.na()</code> function. This is useful to know as it can be used to decide whether to drop or impute the missing values. The following code demonstrates how to perform these tasks.</p>
<div class="sourceCode" id="cb669"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb669-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb669-1" tabindex="-1"></a><span class="co">#check for NA values</span></span>
<span id="cb669-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb669-2" tabindex="-1"></a>NAvalues_x27 <span class="ot">&lt;-</span> <span class="fu">is.na</span>(Data_CMR<span class="sc">$</span>x27)</span>
<span id="cb669-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb669-3" tabindex="-1"></a><span class="fu">sum</span>(NAvalues_x27)</span></code></pre></div>
<pre><code>## [1] 52</code></pre>
<p>Another figure which is often of interest is which index (or indices) of the variable(s) correspond to the missing values. This can be done through using the <code>which()</code> function, including the results from the <code>is.na()</code> function as the argument.</p>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb671-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb671-1" tabindex="-1"></a><span class="co">#find which values are NA</span></span>
<span id="cb671-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb671-2" tabindex="-1"></a><span class="fu">which</span>(<span class="fu">is.na</span>(NAvalues_x27))</span></code></pre></div>
<pre><code>## integer(0)</code></pre>
<p>As mentioned, often, any NA values are simply just removed. This is demonstrated later on in the module in the <strong><a href="#id_#Generalised-linear-regression">generalised linear regression</a></strong> section, where the NA values are removed from the covariate information prior to modelling using the function <code>drop_na()</code> from the <code>tidyr</code> package. In this instance, modelling in R cannot be done when there are missing values, so it is important that the missing data is removed (if they are not removed beforehand, R can remove the observations with missing information during the modelling process).</p>
<p>However, removing all observations with NA values is not always the best option. In some situations, removing all observations with NA values will not leave enough information to accurately model the data from. When this occurs, the missing data can first be imputed using the remaining results. There are multiple approaches to impute the missing data, but one of the most commonly used approaches is to use the mean (or median) value of the remaining observations.</p>
</div>
<div id="checking-for-minimum-and-maximum-values" class="section level3 hasAnchor" number="8.3.4">
<h3><span class="header-section-number">8.3.4</span> Checking for minimum and maximum values<a href="bayesian-hierarchical-population-modelling-in-r.html#checking-for-minimum-and-maximum-values" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Familiarising yourself with the dataset is crucial to be able to properly understand the data and interpret any results. One of the ways in which you can familiarise yourself with the data is to check what the minimum and maximum values are in the relevant data, for example, minimum and maximum values of elevation. This can help you to not only look out for any outlier or extreme values with predictions for example, but it can also help you to understand the scale of each data type that you are working with.</p>
<p>The methods as to how you can check for the minimum and maximum values are discussed in Module 1, by using the <code>min()</code> and <code>max()</code> functions respectively.</p>
<div class="sourceCode" id="cb673"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb673-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb673-1" tabindex="-1"></a><span class="co">#minimum total population count</span></span>
<span id="cb673-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb673-2" tabindex="-1"></a><span class="fu">min</span>(Data_CMR<span class="sc">$</span>Total_Pop)</span></code></pre></div>
<pre><code>## [1] 19</code></pre>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb675-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb675-1" tabindex="-1"></a><span class="co">#maximum total population count</span></span>
<span id="cb675-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb675-2" tabindex="-1"></a><span class="fu">max</span>(Data_CMR<span class="sc">$</span>Total_Pop)</span></code></pre></div>
<pre><code>## [1] 26689</code></pre>
</div>
<div id="checking-the-distribution-of-categorical-variables" class="section level3 hasAnchor" number="8.3.5">
<h3><span class="header-section-number">8.3.5</span> Checking the distribution of categorical variables<a href="bayesian-hierarchical-population-modelling-in-r.html#checking-the-distribution-of-categorical-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As with the other aspects of exploratory analysis, it is important to check the distribution of the data prior to modelling to be familiar with the data itself. The distribution of categorical variables was explored briefly <strong><a href="#id_#Basic-visualisation">above</a></strong> by demonstrating that a bar plot can be used to show the distribution of settlement types with a bar plot, however, the distribution of categorical variables can be explored using a variety of methods, including simple frequency tables using the function <code>table()</code>. The code below demonstrates this by producing a table of the frequencies of the different settlement types.</p>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb677-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb677-1" tabindex="-1"></a><span class="co">#produce a table for frequency checking</span></span>
<span id="cb677-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb677-2" tabindex="-1"></a><span class="fu">table</span>(Data_CMR<span class="sc">$</span>Settlement_Type)</span></code></pre></div>
<pre><code>## 
##   1   2   3   4 
## 768 167 194 463</code></pre>
<p>It is also important to look at how many different categories there are within the variable. This can be done using the <code>unique()</code> function, which returns a vector with each of the unique categories in order of appearance in the variable. An example of this can be seen below, where the unique regions are returned, followed by the number of unique categories, found using the <code>length()</code> function</p>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb679-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb679-1" tabindex="-1"></a><span class="co">#find the unique regions</span></span>
<span id="cb679-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb679-2" tabindex="-1"></a><span class="fu">unique</span>(Data_CMR<span class="sc">$</span>Regions)</span></code></pre></div>
<pre><code>##  [1]  3  2 10  7  8  9  1  5  6  4</code></pre>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb681-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb681-1" tabindex="-1"></a><span class="co">#find out how many different regions there are</span></span>
<span id="cb681-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb681-2" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(Data_CMR<span class="sc">$</span>Regions))</span></code></pre></div>
<pre><code>## [1] 10</code></pre>
</div>
</div>
<div id="model-set-up" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> Model set-up<a href="bayesian-hierarchical-population-modelling-in-r.html#model-set-up" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section repeats many of the methods discussed in Module 4 such as simple linear regression, multiple regression and GLM stepwise regression with application to the Cameroon dataset, before exploring more complex methods such as a Bayesian approach and introducing spatial covariates.</p>
<p>The first step is to identify the response variable (and the independent variables if necessary) of interest. In the case of the Cameroon dataset, the response variable is the population density.</p>
<p>The distribution of the response variable can be checked through plotting a histogram. In this instance, the log-transformed population density is normally distributed which can be identified through the bell-curve shape of the histogram.</p>
<div class="sourceCode" id="cb683"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb683-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb683-1" tabindex="-1"></a><span class="co">#check the distribution</span></span>
<span id="cb683-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb683-2" tabindex="-1"></a>Data_CMR <span class="ot">&lt;-</span> Data_CMR <span class="sc">%&gt;%</span> </span>
<span id="cb683-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb683-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Density =</span> Total_Pop<span class="sc">/</span>Total_Building_Count)</span>
<span id="cb683-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb683-4" tabindex="-1"></a></span>
<span id="cb683-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb683-5" tabindex="-1"></a><span class="fu">hist</span>(Data_CMR<span class="sc">$</span>Density, <span class="at">xlab =</span> <span class="st">&quot;Population density&quot;</span>, </span>
<span id="cb683-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb683-6" tabindex="-1"></a>  <span class="at">main =</span><span class="st">&quot;Histogram of population density&quot;</span>, <span class="at">breaks =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="WorldPop_Training_Manual_files/figure-html/check%20the%20distribution-1.png" width="672" /></p>
<div class="sourceCode" id="cb684"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb684-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb684-1" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">log</span>(Data_CMR<span class="sc">$</span>Density), <span class="at">xlab =</span> <span class="st">&quot;log-transformed population density&quot;</span>, </span>
<span id="cb684-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb684-2" tabindex="-1"></a>  <span class="at">main =</span><span class="st">&quot;Histogram of log-transformed population density&quot;</span>, <span class="at">breaks =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="WorldPop_Training_Manual_files/figure-html/check%20the%20distribution-2.png" width="672" /></p>
<p>Given that the log-transformed population density is normally distributed, a variable can be created to work with this density and model the data.</p>
<div class="sourceCode" id="cb685"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb685-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb685-1" tabindex="-1"></a><span class="co">#create the log transformed Density variable</span></span>
<span id="cb685-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb685-2" tabindex="-1"></a>Data_CMR <span class="ot">&lt;-</span> Data_CMR <span class="sc">%&gt;%</span> </span>
<span id="cb685-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb685-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">LDensity =</span> <span class="fu">log</span>(Density),</span>
<span id="cb685-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb685-4" tabindex="-1"></a>         <span class="at">y =</span> LDensity) <span class="co">#this will be the response for the density models</span></span></code></pre></div>
<div id="simple-linear-regression" class="section level3 hasAnchor" number="8.4.1">
<h3><span class="header-section-number">8.4.1</span> Simple linear regression<a href="bayesian-hierarchical-population-modelling-in-r.html#simple-linear-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Since the log-transformed population density is normally distributed, the <code>lm()</code> function can be used to fit a simple linear regression model. In this instance, the simplest model, the intercept-only, model is fitted first, with outputs for the model summary, coefficients, residuals and predicted values returned also, all using the functions introduced in Module 2.</p>
<div class="sourceCode" id="cb686"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb686-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb686-1" tabindex="-1"></a><span class="co">#intercept only </span></span>
<span id="cb686-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb686-2" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> Data_CMR)</span>
<span id="cb686-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb686-3" tabindex="-1"></a></span>
<span id="cb686-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb686-4" tabindex="-1"></a><span class="co">#gives all the model parameters estimates</span></span>
<span id="cb686-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb686-5" tabindex="-1"></a><span class="fu">summary</span>(fit1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ 1, data = Data_CMR)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.9476 -0.4811 -0.0339  0.4731  5.7481 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1.12919    0.02019   55.94   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.8046 on 1588 degrees of freedom
##   (3 observations deleted due to missingness)</code></pre>
<div class="sourceCode" id="cb688"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb688-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb688-1" tabindex="-1"></a><span class="co">#gives only the estimates of the fixed effects parameters </span></span>
<span id="cb688-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb688-2" tabindex="-1"></a><span class="fu">coefficients</span>(fit1)</span></code></pre></div>
<pre><code>## (Intercept) 
##    1.129186</code></pre>
<div class="sourceCode" id="cb690"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb690-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb690-1" tabindex="-1"></a><span class="co">#gives the residuals (observed - predicted)</span></span>
<span id="cb690-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb690-2" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">resid</span>(fit1)) </span></code></pre></div>
<pre><code>##           1           2           3           4           5           6 
##  0.00604343 -0.40488387 -0.39598028 -0.10917200  0.22603595  0.08739335</code></pre>
<div class="sourceCode" id="cb692"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb692-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb692-1" tabindex="-1"></a><span class="co">#gives the predicted values</span></span>
<span id="cb692-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb692-2" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">fitted</span>(fit1))</span></code></pre></div>
<pre><code>##        1        2        3        4        5        6 
## 1.129186 1.129186 1.129186 1.129186 1.129186 1.129186</code></pre>
</div>
<div id="multiple-regression-1" class="section level3 hasAnchor" number="8.4.2">
<h3><span class="header-section-number">8.4.2</span> Multiple regression<a href="bayesian-hierarchical-population-modelling-in-r.html#multiple-regression-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Before adding covariates into the models, since the geospatial covariates are obtained based on different scales of measurements, it is important to transform the data first to standardise the covariates. This makes the interpretation of the model estimates much easier. Here, the standardisation is done through using the Z-score with a function created below to do this standardisation.</p>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb694-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb694-1" tabindex="-1"></a><span class="co">#standardisation of model covariates</span></span>
<span id="cb694-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb694-2" tabindex="-1"></a>stdise <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb694-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb694-3" tabindex="-1"></a>{</span>
<span id="cb694-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb694-4" tabindex="-1"></a>  stds <span class="ot">&lt;-</span> (x <span class="sc">-</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))<span class="sc">/</span><span class="fu">sd</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb694-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb694-5" tabindex="-1"></a>  <span class="fu">return</span>(stds)</span>
<span id="cb694-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb694-6" tabindex="-1"></a>}</span></code></pre></div>
<p>This function created can then be applied to covariates from a given dataset using the <code>apply()</code> function for efficiency to standardise the selected covariates.</p>
<div class="sourceCode" id="cb695"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb695-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb695-1" tabindex="-1"></a><span class="co">#apply the function to standardise the covariates </span></span>
<span id="cb695-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb695-2" tabindex="-1"></a>cov_vars <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;x&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">41</span>) </span>
<span id="cb695-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb695-3" tabindex="-1"></a>Data_CMR_std <span class="ot">&lt;-</span> Data_CMR</span>
<span id="cb695-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb695-4" tabindex="-1"></a></span>
<span id="cb695-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb695-5" tabindex="-1"></a><span class="co">#standardise the covariates only</span></span>
<span id="cb695-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb695-6" tabindex="-1"></a>Data_CMR_std[, cov_vars] <span class="ot">&lt;-</span> <span class="fu">apply</span>(Data_CMR[, cov_vars], <span class="dv">2</span>, stdise)</span>
<span id="cb695-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb695-7" tabindex="-1"></a></span>
<span id="cb695-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb695-8" tabindex="-1"></a><span class="co">#obtain subset of the data with only the covariates and the response variable</span></span>
<span id="cb695-9"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb695-9" tabindex="-1"></a>mod_covs <span class="ot">&lt;-</span> Data_CMR_std[,<span class="fu">c</span>(<span class="st">&quot;y&quot;</span>, cov_vars)]</span>
<span id="cb695-10"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb695-10" tabindex="-1"></a></span>
<span id="cb695-11"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb695-11" tabindex="-1"></a><span class="co">#summary of covariates before and after standardisation</span></span>
<span id="cb695-12"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb695-12" tabindex="-1"></a><span class="fu">head</span>(Data_CMR[,cov_vars[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]])</span></code></pre></div>
<pre><code>##         x1       x2       x3        x4       x5
## 1 240337.7 86203.41 413765.8 139978.61 86203.41
## 2 338154.9 36501.53 317968.1  36501.53 36501.53
## 3 437903.8 54406.30 278816.8  72425.01 54406.30
## 4 572474.0 65059.10 207275.2 167467.12 65059.10
## 5 346930.5 47410.98 334817.6  80121.03 47410.98
## 6 344902.1 55245.77 333230.8  76245.29 55245.77</code></pre>
<div class="sourceCode" id="cb697"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb697-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb697-1" tabindex="-1"></a><span class="fu">head</span>(Data_CMR_std[,cov_vars[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]])</span></code></pre></div>
<pre><code>##            x1          x2         x3         x4          x5
## 1 -0.62880443  1.10518418  1.5292650  0.2777396  0.89020837
## 2 -0.13168532 -0.01029845  0.7477583 -0.8029266 -0.09342136
## 3  0.37525087  0.39154679  0.4283667 -0.4277586  0.26092475
## 4  1.05915270  0.63063252 -0.1552609  0.5648168  0.47174994
## 5 -0.08708668  0.23454744  0.8852148 -0.3473849  0.12248313
## 6 -0.09739513  0.41038730  0.8722700 -0.3878613  0.27753826</code></pre>
<p>Using the same methods as discussed in Module 2 for simple linear and multiple regression, examples are given below with the application of the methods to the Cameroon dataset.</p>
<div class="sourceCode" id="cb699"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb699-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb699-1" tabindex="-1"></a><span class="co">#example of Simple linear regression (only one covariate)</span></span>
<span id="cb699-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb699-2" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x3, <span class="at">data =</span> Data_CMR_std)</span>
<span id="cb699-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb699-3" tabindex="-1"></a><span class="fu">summary</span>(fit2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x3, data = Data_CMR_std)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.5403 -0.4465 -0.0012  0.4426  5.5186 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   1.1293     0.0192   58.81   &lt;2e-16 ***
## x3           -0.2486     0.0192  -12.95   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.7655 on 1587 degrees of freedom
##   (3 observations deleted due to missingness)
## Multiple R-squared:  0.09555,    Adjusted R-squared:  0.09498 
## F-statistic: 167.7 on 1 and 1587 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb701"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb701-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb701-1" tabindex="-1"></a><span class="co">#example Multiple regression (more than one covariate)</span></span>
<span id="cb701-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb701-2" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x9, <span class="at">data =</span> Data_CMR_std)</span>
<span id="cb701-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb701-3" tabindex="-1"></a><span class="fu">summary</span>(fit3)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x1 + x2 + x3 + x9, data = Data_CMR_std)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.4001 -0.3742  0.0056  0.3612  6.3559 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1.12877    0.01779  63.454  &lt; 2e-16 ***
## x1           0.08682    0.02808   3.092  0.00202 ** 
## x2          -0.08814    0.01989  -4.432 9.98e-06 ***
## x3          -0.08441    0.02677  -3.153  0.00165 ** 
## x9           0.24758    0.01972  12.557  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.7091 on 1584 degrees of freedom
##   (3 observations deleted due to missingness)
## Multiple R-squared:  0.2253, Adjusted R-squared:  0.2234 
## F-statistic: 115.2 on 4 and 1584 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb703"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb703-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb703-1" tabindex="-1"></a><span class="co">#multiple regression with all available covariates in the data</span></span>
<span id="cb703-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb703-2" tabindex="-1"></a>fit4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> ., <span class="at">data =</span> mod_covs)</span>
<span id="cb703-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb703-3" tabindex="-1"></a><span class="co">#fit4 &lt;- lm(y ~ ., data = Data_CMR_std) #this will include everything else</span></span>
<span id="cb703-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb703-4" tabindex="-1"></a><span class="co">#summary(fit4)</span></span></code></pre></div>
</div>
<div id="generalised-linear-regression-1" class="section level3 hasAnchor" number="8.4.3">
<h3><span class="header-section-number">8.4.3</span> Generalised linear regression<a href="bayesian-hierarchical-population-modelling-in-r.html#generalised-linear-regression-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As discussed in Module 4, the main difference between the <code>lm()</code> and <code>glm()</code> functions is that <code>glm()</code> can be used for both normal and non-normal data and therefore, the distribution of the response must be specified when <code>glm()</code> is used.</p>
<p>To use the <code>glm()</code> function with stepwise regression to select the best fitting model with covariates, the <code>MASS</code> package must be loaded. Additionally, the <code>car</code> package can be loaded to compute the Variance Inflation Factor (VIF).</p>
<div class="sourceCode" id="cb704"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb704-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb704-1" tabindex="-1"></a><span class="co">#install MASS and car packages</span></span>
<span id="cb704-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb704-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;MASS&quot;</span>)</span>
<span id="cb704-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb704-3" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;car&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb705-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb705-1" tabindex="-1"></a><span class="co">#load MASS and car packages</span></span>
<span id="cb705-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb705-2" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb705-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb705-3" tabindex="-1"></a><span class="fu">library</span>(car)  </span></code></pre></div>
<p>The first step is to ensure that all of the NA values are removed, this can be done using the <code>drop_na()</code> function in the <code>tidyr</code> package.</p>
<div class="sourceCode" id="cb706"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb706-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb706-1" tabindex="-1"></a><span class="co">#remove all NA values</span></span>
<span id="cb706-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb706-2" tabindex="-1"></a>mod_covs <span class="ot">&lt;-</span> mod_covs <span class="sc">%&gt;%</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>()</span></code></pre></div>
<p>Then the <code>glm()</code> function can be used to model the data, in this case all of the standardised covariates are used with the continuous data belonging to the Gaussian family. As discussed in Module 4, stepwise regression can be completed through using the <code>stepAIC()</code> function. Below, the stepwise regression is applied to the full GLM model with the direction of the model selection going both ways.</p>
<div class="sourceCode" id="cb707"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb707-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb707-1" tabindex="-1"></a><span class="co">#covariates selection using GLM stepwise regression</span></span>
<span id="cb707-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb707-2" tabindex="-1"></a>fdens <span class="ot">&lt;-</span> <span class="fu">glm</span>(y<span class="sc">~</span>., <span class="at">data =</span> mod_covs, <span class="at">family =</span> gaussian) <span class="co">#continuous data </span></span>
<span id="cb707-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb707-3" tabindex="-1"></a><span class="fu">summary</span>(fdens)</span>
<span id="cb707-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb707-4" tabindex="-1"></a>step_dens<span class="ot">&lt;-</span> <span class="fu">stepAIC</span>(fdens, <span class="at">scale =</span> <span class="dv">0</span>,</span>
<span id="cb707-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb707-5" tabindex="-1"></a>                   <span class="at">direction =</span> <span class="fu">c</span>(<span class="st">&quot;both&quot;</span>),</span>
<span id="cb707-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb707-6" tabindex="-1"></a>                   <span class="at">trace =</span> <span class="dv">1</span>, <span class="at">keep =</span> <span class="cn">NULL</span>, <span class="at">steps =</span> <span class="dv">1000</span>, <span class="at">use.start =</span> <span class="cn">FALSE</span>,</span>
<span id="cb707-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb707-7" tabindex="-1"></a>                   <span class="at">k =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>The resulting best fitting model can then be copied and pasted from the output in order to refit the model and select only the statistically significant variables.</p>
<div class="sourceCode" id="cb708"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb708-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb708-1" tabindex="-1"></a><span class="co">#refit the model with selected covariates</span></span>
<span id="cb708-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb708-2" tabindex="-1"></a>fdens2 <span class="ot">&lt;-</span>  <span class="fu">glm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x7 <span class="sc">+</span> x9 <span class="sc">+</span> x10 <span class="sc">+</span> x11 <span class="sc">+</span> x12 <span class="sc">+</span> </span>
<span id="cb708-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb708-3" tabindex="-1"></a>    x13 <span class="sc">+</span> x14 <span class="sc">+</span> x15 <span class="sc">+</span> x16 <span class="sc">+</span> x19 <span class="sc">+</span> x20 <span class="sc">+</span> x21 <span class="sc">+</span> x24 <span class="sc">+</span> x28 <span class="sc">+</span> x31 <span class="sc">+</span> </span>
<span id="cb708-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb708-4" tabindex="-1"></a>    x32 <span class="sc">+</span> x36 <span class="sc">+</span> x38 <span class="sc">+</span> x40 <span class="sc">+</span> x41, <span class="at">family =</span> gaussian, <span class="at">data =</span> mod_covs)</span>
<span id="cb708-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb708-5" tabindex="-1"></a><span class="fu">summary</span>(fdens2)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ x1 + x2 + x3 + x7 + x9 + x10 + x11 + x12 + 
##     x13 + x14 + x15 + x16 + x19 + x20 + x21 + x24 + x28 + x31 + 
##     x32 + x36 + x38 + x40 + x41, family = gaussian, data = mod_covs)
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1.12178    0.01604  69.935  &lt; 2e-16 ***
## x1           0.94340    0.14009   6.734 2.34e-11 ***
## x2          -0.14578    0.02708  -5.384 8.45e-08 ***
## x3          -0.21609    0.04018  -5.378 8.72e-08 ***
## x7           0.08323    0.03197   2.604 0.009317 ** 
## x9          -0.23291    0.14283  -1.631 0.103161    
## x10          0.26976    0.15722   1.716 0.086398 .  
## x11         -0.35442    0.09667  -3.666 0.000255 ***
## x12         -0.43686    0.10530  -4.149 3.53e-05 ***
## x13          0.46231    0.12020   3.846 0.000125 ***
## x14          0.61476    0.11219   5.480 4.98e-08 ***
## x15          0.96766    0.14963   6.467 1.35e-10 ***
## x16         -0.03775    0.02051  -1.841 0.065866 .  
## x19         -0.05983    0.03313  -1.806 0.071132 .  
## x20          0.06331    0.03173   1.995 0.046168 *  
## x21          0.35461    0.05045   7.029 3.15e-12 ***
## x24         -0.08049    0.03392  -2.373 0.017773 *  
## x28          0.09290    0.03862   2.405 0.016278 *  
## x31         -0.05528    0.01974  -2.800 0.005170 ** 
## x32          0.06524    0.02198   2.968 0.003046 ** 
## x36         -0.08218    0.02789  -2.947 0.003261 ** 
## x38         -0.03024    0.02010  -1.504 0.132741    
## x40         -0.12636    0.03092  -4.087 4.61e-05 ***
## x41          0.17710    0.06440   2.750 0.006031 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 0.3922937)
## 
##     Null deviance: 990.78  on 1537  degrees of freedom
## Residual deviance: 593.93  on 1514  degrees of freedom
## AIC: 2951.3
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p>The Variance Inflation Factors (VIF) of the covariates can then be computed with the <code>vif()</code> function, where in this case, a VIF of less than 5 is acceptable.</p>
<div class="sourceCode" id="cb710"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb710-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb710-1" tabindex="-1"></a><span class="co">#check the VIF values for the refitted model</span></span>
<span id="cb710-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb710-2" tabindex="-1"></a>vif_dens <span class="ot">=</span> <span class="fu">vif</span>(fdens2)</span>
<span id="cb710-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb710-3" tabindex="-1"></a></span>
<span id="cb710-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb710-4" tabindex="-1"></a><span class="co">#extract the covariates with VIF values of less than 5</span></span>
<span id="cb710-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb710-5" tabindex="-1"></a>vif_dens[<span class="fu">which</span>(vif_dens <span class="sc">&lt;</span> <span class="dv">5</span>)]</span></code></pre></div>
<pre><code>##       x2       x7      x16      x19      x20      x24      x31      x32      x36      x38      x40 
## 2.839034 3.966596 1.664360 4.373456 3.961965 4.188336 1.546725 1.914355 2.978645 1.607727 3.836262</code></pre>
<p>The GLM can be refitted again, this time with only the covariates which have a VIF value of less than 5.</p>
<div class="sourceCode" id="cb712"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb712-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb712-1" tabindex="-1"></a><span class="co">#refit the model with covariates that have a small VIF</span></span>
<span id="cb712-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb712-2" tabindex="-1"></a>fdens3 <span class="ot">&lt;-</span>  <span class="fu">glm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x2 <span class="sc">+</span> x7 <span class="sc">+</span> x16 <span class="sc">+</span> x19 <span class="sc">+</span> x20 <span class="sc">+</span> x24 <span class="sc">+</span> x31 <span class="sc">+</span> x32 <span class="sc">+</span> x36 <span class="sc">+</span> </span>
<span id="cb712-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb712-3" tabindex="-1"></a>                 x38 <span class="sc">+</span> x40, <span class="at">family =</span> gaussian, <span class="at">data =</span> mod_covs)</span>
<span id="cb712-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb712-4" tabindex="-1"></a><span class="fu">summary</span>(fdens3)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ x2 + x7 + x16 + x19 + x20 + x24 + x31 + x32 + 
##     x36 + x38 + x40, family = gaussian, data = mod_covs)
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1.121989   0.017528  64.012  &lt; 2e-16 ***
## x2          -0.123374   0.022846  -5.400 7.71e-08 ***
## x7           0.017466   0.020369   0.857 0.391311    
## x16         -0.103893   0.020735  -5.010 6.06e-07 ***
## x19          0.001239   0.031963   0.039 0.969089    
## x20          0.102426   0.032859   3.117 0.001860 ** 
## x24          0.056417   0.020008   2.820 0.004868 ** 
## x31         -0.079566   0.020014  -3.975 7.35e-05 ***
## x32         -0.001893   0.020948  -0.090 0.928024    
## x36         -0.216090   0.022026  -9.811  &lt; 2e-16 ***
## x38         -0.004909   0.020655  -0.238 0.812185    
## x40          0.089437   0.024187   3.698 0.000225 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 0.4715244)
## 
##     Null deviance: 990.78  on 1537  degrees of freedom
## Residual deviance: 719.55  on 1526  degrees of freedom
## AIC: 3222.4
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p>The summary output of the model identifies which of the covariates are significant and which are not. Since the best model will include only covariates which are statistically significant (to the 5% level), the model should be refit with only these covariates.</p>
<div class="sourceCode" id="cb714"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb714-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb714-1" tabindex="-1"></a><span class="co">#do the final refit with the covariates that are significant in the summary</span></span>
<span id="cb714-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb714-2" tabindex="-1"></a>fdens4 <span class="ot">&lt;-</span>  <span class="fu">glm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x2 <span class="sc">+</span> x16 <span class="sc">+</span> x20 <span class="sc">+</span> x24 <span class="sc">+</span> x31 <span class="sc">+</span> x36 <span class="sc">+</span> x40,</span>
<span id="cb714-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb714-3" tabindex="-1"></a>               <span class="at">family =</span> gaussian, <span class="at">data =</span> mod_covs)</span>
<span id="cb714-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb714-4" tabindex="-1"></a><span class="fu">summary</span>(fdens4)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ x2 + x16 + x20 + x24 + x31 + x36 + x40, family = gaussian, 
##     data = mod_covs)
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1.12154    0.01750  64.079  &lt; 2e-16 ***
## x2          -0.11604    0.02002  -5.797 8.20e-09 ***
## x16         -0.10718    0.01982  -5.409 7.36e-08 ***
## x20          0.10585    0.01882   5.624 2.22e-08 ***
## x24          0.05268    0.01926   2.735  0.00631 ** 
## x31         -0.08059    0.01904  -4.233 2.44e-05 ***
## x36         -0.21498    0.02169  -9.911  &lt; 2e-16 ***
## x40          0.09536    0.02302   4.142 3.62e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 0.4705534)
## 
##     Null deviance: 990.78  on 1537  degrees of freedom
## Residual deviance: 719.95  on 1530  degrees of freedom
## AIC: 3215.2
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p>Finally, return the VIF for the last covariates and double check that they are all below 5, then the final best covariates can be selected.</p>
<div class="sourceCode" id="cb716"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb716-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb716-1" tabindex="-1"></a><span class="co">#rerun VIF for the last covariates</span></span>
<span id="cb716-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb716-2" tabindex="-1"></a>vif_dens4 <span class="ot">=</span> <span class="fu">vif</span>(fdens4)</span>
<span id="cb716-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb716-3" tabindex="-1"></a>vif_dens4[<span class="fu">which</span>(vif_dens4 <span class="sc">&lt;</span> <span class="dv">5</span>)]</span></code></pre></div>
<pre><code>##       x2      x16      x20      x24      x31      x36      x40 
## 1.293601 1.295430 1.162679 1.126268 1.199379 1.502057 1.772468</code></pre>
<div class="sourceCode" id="cb718"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb718-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb718-1" tabindex="-1"></a><span class="co">#identify the best covariates</span></span>
<span id="cb718-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb718-2" tabindex="-1"></a>best_covs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;x2&quot;</span>, <span class="st">&quot;x16&quot;</span>, <span class="st">&quot;x20&quot;</span>, <span class="st">&quot;x24&quot;</span>, <span class="st">&quot;x31&quot;</span>, <span class="st">&quot;x36&quot;</span>, <span class="st">&quot;x40&quot;</span>)</span></code></pre></div>
</div>
<div id="fitting-fixed-effects-models-in-r-inla" class="section level3 hasAnchor" number="8.4.4">
<h3><span class="header-section-number">8.4.4</span> Fitting fixed effects models in <code>R-INLA</code><a href="bayesian-hierarchical-population-modelling-in-r.html#fitting-fixed-effects-models-in-r-inla" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As seen in previous modules (see Module 4), the mathematical model specification for the fixed effects model is as follows.</p>
<p><span class="math display">\[\eta_i = \log(\lambda_i) = \beta_0 + \beta_1x_1 + \beta_2x_2 + \cdots + \beta_Mx_M,\]</span>
which can also be written as
<span class="math display">\[ \eta_i = \beta_0 + \sum_{m=1}^M \beta_mx_{im},\]</span>
where in this case, the covariates <span class="math inline">\(x_m\)</span> are geospatial covariates, <span class="math inline">\(\lambda\)</span> is the mean parameter and <span class="math inline">\(\eta\)</span> is the linear predictor.</p>
<p>In INLA, the model specification for the above model is given in the form <code>model &lt;- response ~ x_1 + x_2 +... x_M</code>. For demonstration of simple models in <code>INLA</code>, see Module 6.</p>
</div>
<div id="fitting-bayesian-hierarchical-mixed-effects-models-in-r-inla" class="section level3 hasAnchor" number="8.4.5">
<h3><span class="header-section-number">8.4.5</span> Fitting Bayesian hierarchical mixed effects models in <code>R-INLA</code><a href="bayesian-hierarchical-population-modelling-in-r.html#fitting-bayesian-hierarchical-mixed-effects-models-in-r-inla" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Similarly to with the fixed effects models, the mathematical model specification for the mixed effects model can be given as
<span class="math display">\[\log(\lambda_i) =  \beta_0 + \sum_{m=1}^M \beta_mx_{im} + EA_i,\]</span>
which in INLA is given as <code>model &lt;- response ~ x_1 + x_2 +... x_M + f(EA, model = "iid")</code>. The way in which the <code>inla()</code> function is used for the mixed effects models is the same as for the fixed effects models with the exception of the formula specification.</p>
<p>Applying this methodology to the Cameroon data, using settlement type as a random variable can be seen in the code below. First the variable for settlement type is converted to a factor, then the formula is specified and finally the <code>inla()</code> function is used. In this case, the family is set to <code>"gaussian"</code>.</p>
<div class="sourceCode" id="cb719"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb719-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb719-1" tabindex="-1"></a><span class="co">#load the INLA package</span></span>
<span id="cb719-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb719-2" tabindex="-1"></a><span class="fu">library</span>(INLA)</span></code></pre></div>
<div class="sourceCode" id="cb720"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb720-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb720-1" tabindex="-1"></a><span class="co">#convert settlement type to a factor</span></span>
<span id="cb720-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb720-2" tabindex="-1"></a>Data_CMR_std<span class="sc">$</span>set_typ <span class="ot">&lt;-</span> <span class="fu">factor</span>(Data_CMR_std<span class="sc">$</span>Settlement_Type) </span>
<span id="cb720-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb720-3" tabindex="-1"></a></span>
<span id="cb720-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb720-4" tabindex="-1"></a><span class="co">#specify the formula</span></span>
<span id="cb720-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb720-5" tabindex="-1"></a>formula1 <span class="ot">&lt;-</span> y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> x2 <span class="sc">+</span> x16 <span class="sc">+</span> x20 <span class="sc">+</span> x24 <span class="sc">+</span> x31 <span class="sc">+</span> x36 <span class="sc">+</span> </span>
<span id="cb720-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb720-6" tabindex="-1"></a>  x40 <span class="sc">+</span> <span class="fu">f</span>(set_typ, <span class="at">model =</span> <span class="st">&quot;iid&quot;</span>)</span>
<span id="cb720-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb720-7" tabindex="-1"></a></span>
<span id="cb720-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb720-8" tabindex="-1"></a><span class="co">#create the INLA model</span></span>
<span id="cb720-9"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb720-9" tabindex="-1"></a>res1 <span class="ot">&lt;-</span> <span class="fu">inla</span>(formula1,</span>
<span id="cb720-10"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb720-10" tabindex="-1"></a>            <span class="at">data =</span>  Data_CMR_std,</span>
<span id="cb720-11"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb720-11" tabindex="-1"></a>            <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb720-12"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb720-12" tabindex="-1"></a>            <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">compute =</span> <span class="cn">TRUE</span>),</span>
<span id="cb720-13"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb720-13" tabindex="-1"></a>            <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>)</span>
<span id="cb720-14"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb720-14" tabindex="-1"></a>)</span>
<span id="cb720-15"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb720-15" tabindex="-1"></a><span class="fu">summary</span>(res1)</span></code></pre></div>
<pre><code>## Time used:
##     Pre = 0.49, Running = 0.588, Post = 0.204, Total = 1.28 
## Fixed effects:
##               mean    sd 0.025quant 0.5quant 0.975quant   mode   kld
## (Intercept)  1.048 0.084      0.876    1.049      1.213  1.049 0.001
## x2          -0.127 0.019     -0.165   -0.127     -0.089 -0.127 0.000
## x16         -0.089 0.020     -0.127   -0.089     -0.051 -0.089 0.000
## x20          0.100 0.018      0.064    0.100      0.137  0.100 0.000
## x24          0.050 0.018      0.015    0.050      0.086  0.050 0.000
## x31         -0.053 0.021     -0.093   -0.053     -0.013 -0.053 0.000
## x36         -0.196 0.021     -0.237   -0.196     -0.155 -0.196 0.000
## x40          0.018 0.025     -0.030    0.018      0.066  0.018 0.000
## 
## Random effects:
##   Name     Model
##     set_typ IID model
## 
## Model hyperparameters:
##                                          mean     sd 0.025quant 0.5quant 0.975quant  mode
## Precision for the Gaussian observations  2.19  0.078       2.04     2.19       2.35  2.19
## Precision for set_typ                   62.04 46.200      11.69    49.97     183.02 30.43
## 
## Deviance Information Criterion (DIC) ...............: 3279.39
## Deviance Information Criterion (DIC, saturated) ....: 1603.11
## Effective number of parameters .....................: 11.73
## 
## Marginal log-Likelihood:  -1705.96 
##  is computed 
## Posterior summaries for the linear predictor and the fitted values are computed
## (Posterior marginals needs also &#39;control.compute=list(return.marginals.predictor=TRUE)&#39;)</code></pre>
<p>Once you have the model output, the fixed and random effects can be extracted separately, using the <code>$</code> with the arguments <code>summary.fixed</code> for the fixed effects and <code>sumary.random</code> for the random effects. Additionally, the hyperparameters (for the EA) can be obtained through extracting the <code>summary.hyperpar</code> argument.</p>
<div class="sourceCode" id="cb722"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb722-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb722-1" tabindex="-1"></a><span class="co">#extract the fixed effects only</span></span>
<span id="cb722-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb722-2" tabindex="-1"></a>res1<span class="sc">$</span>summary.fixed </span></code></pre></div>
<pre><code>##                    mean         sd  0.025quant    0.5quant  0.975quant        mode          kld
## (Intercept)  1.04809495 0.08373841  0.87621515  1.04947658  1.21304635  1.04948155 6.778342e-04
## x2          -0.12680156 0.01926844 -0.16458900 -0.12680171 -0.08901328 -0.12680171 2.464670e-12
## x16         -0.08881522 0.01953135 -0.12712372 -0.08881346 -0.05051674 -0.08881345 4.366662e-12
## x20          0.10033415 0.01848780  0.06407699  0.10033424  0.13659081  0.10033424 2.479269e-12
## x24          0.05048589 0.01795358  0.01527733  0.05048565  0.08569582  0.05048565 2.461501e-12
## x31         -0.05300326 0.02063559 -0.09345719 -0.05300846 -0.01251972 -0.05300849 1.985144e-11
## x36         -0.19622302 0.02092853 -0.23726956 -0.19622196 -0.15518254 -0.19622195 3.112967e-12
## x40          0.01779198 0.02456362 -0.03034851  0.01778042  0.06599825  0.01778038 5.689345e-11</code></pre>
<div class="sourceCode" id="cb724"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb724-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb724-1" tabindex="-1"></a><span class="co">#extract the random effects only</span></span>
<span id="cb724-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb724-2" tabindex="-1"></a>res1<span class="sc">$</span>summary.random </span></code></pre></div>
<pre><code>## $set_typ
##   ID        mean         sd  0.025quant    0.5quant 0.975quant        mode          kld
## 1  1  0.24113074 0.08899076  0.07321712  0.23792481 0.42730761  0.23797400 0.0004331911
## 2  2 -0.05221826 0.09080821 -0.23524821 -0.05161731 0.12771649 -0.05161399 0.0003582377
## 3  3 -0.14661778 0.09051006 -0.33364043 -0.14422077 0.02718301 -0.14427934 0.0003739361
## 4  4 -0.04229985 0.08824968 -0.21991420 -0.04194413 0.13353841 -0.04193628 0.0004488043</code></pre>
<div class="sourceCode" id="cb726"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb726-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb726-1" tabindex="-1"></a><span class="co">#round the values to 4 decimal places</span></span>
<span id="cb726-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb726-2" tabindex="-1"></a><span class="fu">round</span>(res1<span class="sc">$</span>summary.random<span class="sc">$</span>set_typ[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>)], <span class="dv">4</span>) </span></code></pre></div>
<pre><code>##      mean 0.025quant 0.975quant
## 1  0.2411     0.0732     0.4273
## 2 -0.0522    -0.2352     0.1277
## 3 -0.1466    -0.3336     0.0272
## 4 -0.0423    -0.2199     0.1335</code></pre>
<div class="sourceCode" id="cb728"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb728-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb728-1" tabindex="-1"></a><span class="co">#extract the hyperparameters</span></span>
<span id="cb728-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb728-2" tabindex="-1"></a>res1<span class="sc">$</span>summary.hyperpar</span></code></pre></div>
<pre><code>##                                              mean          sd 0.025quant  0.5quant 0.975quant      mode
## Precision for the Gaussian observations  2.189257  0.07789163   2.039378  2.188058   2.346022  2.186062
## Precision for set_typ                   62.040814 46.20041287  11.688763 49.966517 183.018971 30.428360</code></pre>
<p>Similarly to as in Module 6 with the fixed effects models in INLA, the predicted values for the Bayesian hierarchical mixed effects models can be obtained through extracting the <code>summary.fitted.values</code> argument, adding further specification for if you want to obtain the predicted means (<code>mean</code>), or the upper (<code>0.975quant</code>) and lower (<code>0.025quant</code>) bounds of the 95% credible intervals.</p>
</div>
</div>
<div id="stan-mcmc-approach" class="section level2 hasAnchor" number="8.5">
<h2><span class="header-section-number">8.5</span> STAN (MCMC) approach<a href="bayesian-hierarchical-population-modelling-in-r.html#stan-mcmc-approach" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Markov Chain Monte Carlo (MCMC) methods are a class of algorithms that are used to sample from the joint distribution, comprised of two main parts. Firstly, Monte Carlo, which is a mathematical method for drawing samples from a distribution to obtain parameter estimates. The second part is a Markov Chain which is a sequence of correlated samples in which a future value only depends on the present given the past.</p>
<p>The basic premise is to perform Monte Carlo simulations and estimation on Markov Chains of the posterior distribution. Alternatively, to simulate a Markov chain with the stationary distribution given by the target (posterior) distribution, and after a number of iterations, sampling from this Markov chain repeatedly, samples from the joint distribution can be obtained. For more information on Markov chains, see <a href="https://setosa.io/ev/markov-chains/">Markov Chains Setosa</a> where they are explained visually.</p>
<p>Whilst there are a number of different algorithms proposed, the Metropolis-Hastings algorithm can be used with Bayesian inference.</p>
<div id="metropolis-hastings-algorithm" class="section level3 hasAnchor" number="8.5.1">
<h3><span class="header-section-number">8.5.1</span> Metropolis-Hastings algorithm<a href="bayesian-hierarchical-population-modelling-in-r.html#metropolis-hastings-algorithm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To obtain new values for the different parameters, the Metropolis-Hastings algorithm uses a proposal distribution. The basic steps are as follows.</p>
<ol style="list-style-type: decimal">
<li>Arbitrarily select a starting point <span class="math inline">\(\boldsymbol{z}^{(0)}\)</span>.</li>
<li>Let <span class="math inline">\(q\)</span> be the proposal distribution and <span class="math inline">\(\boldsymbol{y}\)</span> be a candidate point. Generate <span class="math inline">\(\boldsymbol{y}\)</span> from <span class="math inline">\(q(\boldsymbol{y}|\boldsymbol{z}^{(t)})\)</span>.</li>
<li>Calculate the acceptance probability
<span class="math display">\[\alpha(\boldsymbol{z}^{(t)}, \boldsymbol{y}) = min \left\{1, \frac{p(\boldsymbol{y})q(\boldsymbol{z}^{(t)}|\boldsymbol{y})}{p(\boldsymbol{z}^{(t)})q(\boldsymbol{y}|\boldsymbol{z}^{(t)})}\right\}\]</span></li>
<li>Accept <span class="math inline">\(\boldsymbol{z}^{(t+1)} =\boldsymbol{y}\)</span> with probability <span class="math inline">\(\alpha(\boldsymbol{z}^{(t)}, \boldsymbol{y})\)</span> otherwise, set <span class="math inline">\(\boldsymbol{z}^{(t+1)} = \boldsymbol{z}^{(t)}\)</span></li>
</ol>
<p>It is important to note the involvement of <span class="math inline">\(p\)</span>, the target density, in that it is only present through the ratio <span class="math inline">\(\frac{p(y)}{p(\boldsymbol{z}^{(t)})}\)</span>. Therefore, the normalising constant does not need to be known to implement the algorithm since it cancels in the ratio.
<span class="math inline">\(\alpha (\boldsymbol{z},\boldsymbol{y}) = min \left\{1, \frac{p(\boldsymbol{y})}{p(\boldsymbol{z})} \right\}\)</span>
There are three special cases of the Metropolis-Hastings algorithm detailed below.</p>
<ol style="list-style-type: decimal">
<li>Metropolis algorithm: <span class="math inline">\(q(\boldsymbol{y}|\boldsymbol{z})=q(\boldsymbol{z}|\boldsymbol{y})\)</span>
- This is where the proposal density is symmetric. It has a special case called the <strong>Random-Walk</strong> Metropolis algorithm where <span class="math inline">\(q(\boldsymbol{y}|\boldsymbol{z})=q(|\boldsymbol{y}-\boldsymbol{z}|)\)</span> leading to <span class="math inline">\(\alpha (\boldsymbol{z},\boldsymbol{y}) = min \left\{1, \frac{p(\boldsymbol{y})}{p(\boldsymbol{z})} \right\}\)</span>.</li>
<li>Independence sampler: <span class="math inline">\(q(\boldsymbol{y}|\boldsymbol{z})=g(\boldsymbol{y})\)</span>
- Draw proposals from a fixed density <span class="math inline">\(g\)</span>, which can be chosen as <span class="math inline">\(g=p\)</span> to get independent samples, leading to <span class="math inline">\(\alpha(\boldsymbol{z},\boldsymbol{y})=1)\)</span> and no chain will be rejected as a candidate. It is important to note that in general however, <span class="math inline">\(p\)</span> is unknown and that in order for the chain to converge to the stationary distribution, the tails of <span class="math inline">\(g\)</span> must be heavier than the tails of <span class="math inline">\(p\)</span>.</li>
<li>Gibbs sampler: <span class="math inline">\(\alpha(\boldsymbol{z},\boldsymbol{y})=1\)</span>
- This is when the acceptance probability is equal to 1.</li>
</ol>
<p>For more information on the Metropolis-Hastings algorithm and its use in <code>stan</code>, see <a href="https://www.bayesrulesbook.com/chapter-7.html">here</a>.</p>
<!-- ### Gibbs sampling algorithm -->
<!-- For this algorithm, let $\boldsymbol{z}=(z_1,\cdots, z_k)^T$ and start the algorithm at $\boldsymbol{z}^{(0)}$ (which can be any point in the support of $p$). Then, given $\boldsymbol{z}^{(t)}$, to sample from the $k$-dimensional distribution $p(\boldsymbol{z})$, a Markov transition from $\boldsymbol{z}^{(t)}$ to $\boldsymbol{z}^{(t+1)}$ is done as follows. -->
<!-- $$ -->
<!-- \begin{aligned} -->
<!-- &z_1^{(t+1)} \sim p(z_1 | z_2^{(t)}, z_3^{(t)}, \cdots, z_k^{(t)}) \\ -->
<!-- &z_2^{(t+1)} \sim p(z_2 | z_1^{(t+1)}, z_3^{(t)}, \cdots, z_k^{(t)}) \\ -->
<!-- &\vdots \\ -->
<!-- &z_k^{(t+1)} \sim p(z_k | z_1^{(t+1)}, z_2^{(t+1)}, \cdots, z_{k-1}^{(t+1)})  -->
<!-- \end{aligned} -->
<!-- $$ -->
<!-- where the densities on the right hand side are called the **complete conditional distributions** (or the **full conditional distributions**).  -->
</div>
</div>
<div id="inla-and-inla-spde-approach" class="section level2 hasAnchor" number="8.6">
<h2><span class="header-section-number">8.6</span> INLA and INLA-SPDE approach<a href="bayesian-hierarchical-population-modelling-in-r.html#inla-and-inla-spde-approach" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To fit geostatistical models using INLA-SPDE, the following steps should be followed.</p>
<ol style="list-style-type: decimal">
<li>Load the data</li>
<li>Specify the coordinates</li>
<li>Build the mesh</li>
<li>Construct the SPDE</li>
<li>Build projection matrix A</li>
<li>Define the data location indices</li>
<li>Stack the data</li>
<li>Specify and fit the appropriate model</li>
<li>Run posterior checks and model fit checks</li>
<li>Carry out model predictions</li>
</ol>
<div id="mesh-construction" class="section level3 hasAnchor" number="8.6.1">
<h3><span class="header-section-number">8.6.1</span> Mesh construction<a href="bayesian-hierarchical-population-modelling-in-r.html#mesh-construction" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The SPDE approach approximates the continuous Gaussian field as a discrete Gaussian Markov random field by means of a finite basis function defined on a triangulated mesh of the region of study. In other words, it discretises the continuous Gaussian surface using a triangulated mesh. A triangulated mesh can be constructed to perform this approximation with the function <code>inla.mesh.2d()</code> from the <code>R-INLA package</code> which constructs a 2D mesh over a specified boundary. This mesh is important for spatial modelling as it converts the study area into smaller elements (triangles) that can be used in faster computational burdens.</p>
<p>The arguments of this function include:</p>
<ul>
<li><code>loc</code>: the data location coordinates that are used as initial mesh vertices.</li>
<li><code>boundary</code>: an object describing the boundary of the domain.</li>
<li><code>offset</code>: the distance that specifies the size of the inner and outer extensions around the data locations.
<ul>
<li>It controls the padding around the boundary to ensure that edge effects do not influence the analysis.</li>
</ul></li>
<li><code>cutoff</code>: the minimum allowed distance between points.
-It helps in reducing the number of mesh points by ignoring points that are too close to each other, which can improve computational efficiency. In other words, it is used to avoid building many small triangles around clustered locations.</li>
<li><code>max.edge</code>: the values denoting the maximum allowed triangle edge lengths in the region and in the extension.
<ul>
<li>It controls the granularity of the mesh.</li>
<li>Smaller values lead to finer meshes with more triangles providing more resolution so more detail of the spatial variation can be captured.</li>
<li>It should not be too small to control the computation time to run the INLA model.</li>
</ul></li>
</ul>
<p>To select appropriate values of <code>offset</code>, <code>cutoff</code> and <code>max.edge</code>, as they depend on the specific range and distribution of the coordinates of the study dataset, it is typically a trail-and-error process. There are some steps which can be taken to aid in fine-tuning the parameters as follows.</p>
<ol style="list-style-type: decimal">
<li>Start with the recommended values.
<ul>
<li><code>offset = c(max.edge/2, max.edge)</code></li>
<li><code>cutoff = max.edge/10</code></li>
<li><code>max.edge = c(max(diff(range(data$lon))), diff(range(data$lat)))/15</code></li>
</ul></li>
<li>Check the mesh generation time.
<ul>
<li>If the process does not generate a mesh within 1 minute, terminate it and increase the value of <code>max.edge</code> by decreasing the denominator from 15 (for example, use 10).</li>
</ul></li>
<li>In complex cases where the default values are not suitable, try alternative starting values.
<ul>
<li><code>offset = c(0.01, 0.05)</code></li>
<li><code>cutoff = 0.01</code></li>
<li><code>max.edge = c(0.05, 0.1)</code></li>
</ul></li>
<li>Use incremental adjustments.
<ul>
<li>If the mesh still does not generate within 1 minute, increase the values of all three parameters by a factor of 1 (for example, <code>offset = offset*10</code>, <code>cutoff cutoff*10</code> and <code>max.edge = max.edge*10</code>).</li>
</ul></li>
<li>Assess the fit.
<ul>
<li>Once a mesh is generated, check the number of vertices with <code>mesh$n</code>. Visualise the mesh by plotting the non-convex hull boundary and the coordinate points.</li>
<li>Make sure that the mesh triangles inside the non-convex hull boundary (study area) are smaller than those outside it. This will also reduce computational time.</li>
</ul></li>
<li>Fine tuning.
<ul>
<li>Adjust the size of <code>max.edge</code> to improve the fit of the mesh triangles within the boundary. Smaller <code>max.edge</code> values will result in finer mesh triangles inside the study area.</li>
</ul></li>
</ol>
<p>To construct the mesh, either the coordinates of the data locations or the boundary of the data locations can be used.</p>
<p>Below, to construct the mesh using the coordinates of the locations, the function <code>inla.mesh.2d()</code> is called setting <code>loc</code> equal to the matrix with the coordinates of the recording stations (<code>coords</code>). The offset is then specified as <code>offset = c(50, 100)</code> to have an inner extension of size 50, and an outer extension of size 100 around the locations. Then set <code>cutoff = 1</code> to avoid building many small triangles where we have some very close points. Finally, set <code>max.edge = c(30, 60)</code> to use small triangles within the region, and larger triangles in the extension.</p>
<div class="sourceCode" id="cb730"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb730-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb730-1" tabindex="-1"></a><span class="co">#method 1: using coordinates of the locations</span></span>
<span id="cb730-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb730-2" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">dist</span>(coords))</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   0.000   1.679   2.784   3.541   5.527  11.214</code></pre>
<div class="sourceCode" id="cb732"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb732-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb732-1" tabindex="-1"></a>mesh <span class="ot">&lt;-</span> <span class="fu">inla.mesh.2d</span>(</span>
<span id="cb732-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb732-2" tabindex="-1"></a>  <span class="at">loc =</span> coords, <span class="co">#coordinates of the spatial domain</span></span>
<span id="cb732-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb732-3" tabindex="-1"></a>  <span class="at">offset =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>), <span class="co">#adjusts the distance between the outer and inner meshes</span></span>
<span id="cb732-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb732-4" tabindex="-1"></a>  <span class="at">cutoff =</span> <span class="fl">0.03</span>, </span>
<span id="cb732-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb732-5" tabindex="-1"></a>  <span class="at">max.edge =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="dv">1</span>)) <span class="co">#adjusts the mesh nodes sizes between the inner and </span></span>
<span id="cb732-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb732-6" tabindex="-1"></a>                        <span class="co">#outer meshes</span></span>
<span id="cb732-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb732-7" tabindex="-1"></a></span>
<span id="cb732-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb732-8" tabindex="-1"></a><span class="co">#plot the mesh</span></span>
<span id="cb732-9"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb732-9" tabindex="-1"></a><span class="fu">plot</span>(mesh)</span>
<span id="cb732-10"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb732-10" tabindex="-1"></a><span class="co">#add the points for coordinates</span></span>
<span id="cb732-11"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb732-11" tabindex="-1"></a><span class="fu">points</span>(coords, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="WorldPop_Training_Manual_files/figure-html/mesh%20construction%20example-1.png" width="672" /></p>
<div class="sourceCode" id="cb733"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb733-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb733-1" tabindex="-1"></a><span class="co">#extract the number of vertices (controls the minimum size of triangles allowed)</span></span>
<span id="cb733-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb733-2" tabindex="-1"></a>mesh<span class="sc">$</span>n </span></code></pre></div>
<pre><code>## [1] 48991</code></pre>
<p>Alternatively, the boundary of the regions can be used to construct the mesh. To do this method, first the boundary needs to be created with the function <code>inla.nonconvex.hull()</code> where the following arguments are available to be included. The <code>points</code> argument is necessary to include, but the other arguments are not necessary to include in the function if the default values are desired.</p>
<ul>
<li><code>points</code>: the 2d point coordinates.</li>
<li><code>convex</code>: the desired extension radius with default value <code>-0.05</code>. This parameter controls how much the hull contracts around the points (the “tightness” of the hull).
<ul>
<li>A smaller (more negative) value corresponds to a tighter hull which hugs the data points closer. This is beneficial when the goal is to avoid including empty spaces within the hull.</li>
</ul></li>
<li><code>concave</code>: the desired minimum concave curvature radius with default value equal to the <code>convex</code> value ( = <code>-0.05</code> if no <code>convex</code> value given). This parameter influences how much the hull expands to account for concavities (indentations in the boundary).
<ul>
<li>A smaller (more negative) value corresponds with a hull that expands more to include concavities. This is beneficial when the dataset has significant indentations that need to be included within the boundary.</li>
</ul></li>
<li><code>resolution</code>: the internal computation resolution with default vector <code>c(100,100)</code>. This argument indicates the grid resolution that will be used for the hull calculation.</li>
</ul>
<p>If the default values are not used for the above arguments, then the process of selecting the appropriate <code>concave</code> and <code>convex</code> values is typically trial-and-error since they depend on the specific range and distribution of the coordinates present in the chosen dataset. However, there are some steps that can be followed to aid in the selection process.</p>
<ol style="list-style-type: decimal">
<li>Start with the default values.</li>
<li>Plot the hull and coordinates, typically with the following code.</li>
</ol>
<div class="sourceCode" id="cb735"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb735-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb735-1" tabindex="-1"></a><span class="co">#plot the hull and coordinates</span></span>
<span id="cb735-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb735-2" tabindex="-1"></a><span class="fu">plot</span>(non_convex_boundary1<span class="sc">$</span>loc)</span>
<span id="cb735-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb735-3" tabindex="-1"></a><span class="fu">points</span>(data<span class="sc">$</span>long, data<span class="sc">$</span>lati, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Assess the fit.
- Ensure that all the coordinates are included within the hull.
- Check that there is minimal empty space between the points and the hull boundary.</li>
</ol>
<p>Repeat steps 2 and 3, adjusting the <code>convex</code> and <code>concave</code> values each time to improve the fit, until the optimal hull is achieved that fits the data closely and does not have excessive empty space.</p>
<div class="sourceCode" id="cb736"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb736-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb736-1" tabindex="-1"></a><span class="co">#method 2: using boundary of the regions</span></span>
<span id="cb736-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb736-2" tabindex="-1"></a>bnd <span class="ot">&lt;-</span> <span class="fu">inla.nonconvex.hull</span>(coords, <span class="sc">-</span><span class="fl">0.03</span>, <span class="sc">-</span><span class="fl">0.05</span>, <span class="at">resolution =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">100</span>))</span>
<span id="cb736-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb736-3" tabindex="-1"></a>meshb <span class="ot">&lt;-</span> <span class="fu">inla.mesh.2d</span>(<span class="at">boundary =</span> bnd,</span>
<span id="cb736-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb736-4" tabindex="-1"></a>                     <span class="at">max.edge =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>), <span class="co">#adjusts the mesh nodes sizes between</span></span>
<span id="cb736-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb736-5" tabindex="-1"></a>                     <span class="co">#the inner and outer meshes</span></span>
<span id="cb736-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb736-6" tabindex="-1"></a>                     <span class="at">offset =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="dv">1</span>), <span class="co">#adjusts the distance between the outer and inner meshes</span></span>
<span id="cb736-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb736-7" tabindex="-1"></a>                     <span class="at">cutoff =</span> <span class="fl">0.003</span>) <span class="co">#controls the minimum size of triangles allowed</span></span>
<span id="cb736-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb736-8" tabindex="-1"></a></span>
<span id="cb736-9"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb736-9" tabindex="-1"></a></span>
<span id="cb736-10"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb736-10" tabindex="-1"></a></span>
<span id="cb736-11"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb736-11" tabindex="-1"></a><span class="co">#plot the mesh</span></span>
<span id="cb736-12"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb736-12" tabindex="-1"></a><span class="fu">plot</span>(meshb)</span>
<span id="cb736-13"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb736-13" tabindex="-1"></a><span class="co">#add the points for coordinates</span></span>
<span id="cb736-14"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb736-14" tabindex="-1"></a><span class="fu">points</span>(coords, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="WorldPop_Training_Manual_files/figure-html/mesh%20construction%20m2-1.png" width="672" /></p>
<div class="sourceCode" id="cb737"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb737-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb737-1" tabindex="-1"></a><span class="co">#extract the number of vertices </span></span>
<span id="cb737-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb737-2" tabindex="-1"></a>mesh<span class="sc">$</span>n </span></code></pre></div>
<pre><code>## [1] 48991</code></pre>
</div>
<div id="building-the-spde" class="section level3 hasAnchor" number="8.6.2">
<h3><span class="header-section-number">8.6.2</span> Building the SPDE<a href="bayesian-hierarchical-population-modelling-in-r.html#building-the-spde" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The function <code>inla.spde2.matern()</code> can be used to build the SPDE model on the mesh passing mesh and alpha as arguments. The alpha argument is related to the smoothness parameter of the process, namely <span class="math inline">\(\alpha = v + d/2\)</span>. In this example, the smoothness parameter is set to be equal to 1 and in the spatial case, <span class="math inline">\(d=2\)</span> so <span class="math inline">\(\alpha = 1+ 2/2 = 2\)</span>. The constraint argument is then set as <code>const = TRUE</code> to impose an integrate-to-zero constraint.</p>
<div class="sourceCode" id="cb739"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb739-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb739-1" tabindex="-1"></a><span class="co">#build the SPDE</span></span>
<span id="cb739-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb739-2" tabindex="-1"></a>spde <span class="ot">&lt;-</span> <span class="fu">inla.spde2.matern</span>(<span class="at">mesh =</span> mesh, <span class="at">alpha =</span> <span class="dv">2</span>, <span class="at">constr =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="projection-matrix" class="section level3 hasAnchor" number="8.6.3">
<h3><span class="header-section-number">8.6.3</span> Projection matrix<a href="bayesian-hierarchical-population-modelling-in-r.html#projection-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A projection matrix A needs to be constructed to project the GRF from the observations to the triangulations vertices (for the prediction). The matrix A has the number of rows equal to the number of observations, and the number of columns equal to the number of vertices of the triangulation.</p>
<p>Row of A corresponding to an observation at location possibly has three non-zero values at the columns that correspond to the vertices of the triangle that contains the location. If is within the triangle, these values are equal to the barycentric coordinates. That is, they are proportional to the areas of each of the three sub-triangles defined by the location <span class="math inline">\(s_i\)</span> and the triangle’s vertices, and sum to 1. If <span class="math inline">\(s_i\)</span> is equal to a vertex of the triangle, row <span class="math inline">\(i\)</span> has just one non-zero value equal to 1 at the column that corresponds to the vertex. Intuitively, the value <span class="math inline">\(Z(s)\)</span> at a location that lies within one triangle is the projection of the plane formed by the triangle vertices weights at location s.</p>
<p>An example of a projection matrix is given below. This projection matrix projects <span class="math inline">\(n\)</span> observations to G triangulation vertices. The first row of the matrix corresponds to an observation with location that coincides with vertex number 3. The second and last rows correspond to observations with locations lying within triangles.</p>
<p>R-INLA provides the <code>inla.spde.make.A()</code> function to easily construct a projection matrix A. We create the projection matrix of our example by using <code>inla.spde.make.A()</code> passing the triangulated mesh <code>mesh</code> and the coordinates <code>coo</code>.</p>
<div class="sourceCode" id="cb740"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb740-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb740-1" tabindex="-1"></a><span class="co">#construct projection matrix</span></span>
<span id="cb740-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb740-2" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">inla.spde.make.A</span>(<span class="at">mesh =</span> mesh, <span class="at">loc =</span> coords)</span></code></pre></div>
<p>We can type <code>dim(A)</code> to see if A has the number of rows equal to the number of observations (number of rows in the data), and the number of columns equal to the number of mesh nodes (<code>mesh$n</code>).</p>
</div>
<div id="data-location-indexing" class="section level3 hasAnchor" number="8.6.4">
<h3><span class="header-section-number">8.6.4</span> Data location indexing<a href="bayesian-hierarchical-population-modelling-in-r.html#data-location-indexing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The next step is to generate the index set of the SPDE model. This is done through using the function <code>inla.spde.make.index()</code> where the name of the effect(s) and the number of vertices in the SPDE model (found using <code>spde$n.spde</code>) are specified.</p>
<div class="sourceCode" id="cb741"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb741-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb741-1" tabindex="-1"></a><span class="co">#generate the index set</span></span>
<span id="cb741-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb741-2" tabindex="-1"></a>indexs <span class="ot">&lt;-</span> <span class="fu">inla.spde.make.index</span>(<span class="st">&quot;s&quot;</span>, spde<span class="sc">$</span>n.spde)</span></code></pre></div>
</div>
<div id="projection-data" class="section level3 hasAnchor" number="8.6.5">
<h3><span class="header-section-number">8.6.5</span> Projection data<a href="bayesian-hierarchical-population-modelling-in-r.html#projection-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The next step is to construct a matrix with the coordinates of the locations where the prediction for certain values (for example, rainfall) take place. To do this, firstly a grid is constructed using the function <code>expand.grid()</code>, combining the vectors <code>x</code> and <code>y</code>, then converting to a matrix using the <code>as.matrix()</code> function. In this example, the result is called <code>coop</code>, with 50×50 locations. Once the matrix is created, the function <code>point.in.polygon()</code> is used to find the indices of the points which are contained within the polygons. The matrix can then be updated to only keep the points which are in the polygons.</p>
<div class="sourceCode" id="cb742"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb742-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb742-1" tabindex="-1"></a><span class="co">#import the shapefile data</span></span>
<span id="cb742-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb742-2" tabindex="-1"></a>ea_don_shp <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">paste0</span>(data_path, <span class="st">&quot;/Shapefiles/CMR_Boundary.shp&quot;</span>))</span></code></pre></div>
<pre><code>## Reading layer `CMR_Boundary&#39; from data source 
##   `F:\Study\WorldPop Training Materials\GitBook\wp_training_manual\data\CMR\Shapefiles\CMR_Boundary.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 1 feature and 4 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 945997.2 ymin: 182845.8 xmax: 1802307 ymax: 1458913
## Projected CRS: WGS 84 / World Mercator</code></pre>
<div class="sourceCode" id="cb744"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb744-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb744-1" tabindex="-1"></a><span class="co">#plot the data</span></span>
<span id="cb744-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb744-2" tabindex="-1"></a><span class="fu">plot</span>(ea_don_shp<span class="sc">$</span>geometry)</span></code></pre></div>
<p><img src="WorldPop_Training_Manual_files/figure-html/projection%20data-1.png" width="672" /></p>
<div class="sourceCode" id="cb745"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb745-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb745-1" tabindex="-1"></a><span class="co">#load the sp package</span></span>
<span id="cb745-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb745-2" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb745-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb745-3" tabindex="-1"></a></span>
<span id="cb745-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb745-4" tabindex="-1"></a><span class="co">#convert sf object to spatial object</span></span>
<span id="cb745-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb745-5" tabindex="-1"></a>sp_object <span class="ot">&lt;-</span> <span class="fu">as</span>(ea_don_shp, <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb745-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb745-6" tabindex="-1"></a></span>
<span id="cb745-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb745-7" tabindex="-1"></a><span class="co">#create the bounding box</span></span>
<span id="cb745-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb745-8" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">bbox</span>(sp_object)</span>
<span id="cb745-9"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb745-9" tabindex="-1"></a>bb</span></code></pre></div>
<pre><code>##        min     max
## x 945997.2 1802307
## y 182845.8 1458913</code></pre>
<div class="sourceCode" id="cb747"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb747-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb747-1" tabindex="-1"></a><span class="co">#set the coordinates</span></span>
<span id="cb747-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb747-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(bb[<span class="dv">1</span>, <span class="st">&quot;min&quot;</span>] <span class="sc">-</span> <span class="dv">1</span>, bb[<span class="dv">1</span>, <span class="st">&quot;max&quot;</span>] <span class="sc">+</span> <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">50</span>)</span>
<span id="cb747-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb747-3" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">seq</span>(bb[<span class="dv">2</span>, <span class="st">&quot;min&quot;</span>] <span class="sc">-</span> <span class="dv">1</span>, bb[<span class="dv">2</span>, <span class="st">&quot;max&quot;</span>] <span class="sc">+</span> <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">50</span>)</span>
<span id="cb747-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb747-4" tabindex="-1"></a>coop <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">expand.grid</span>(x, y))</span></code></pre></div>
<!-- ```{r} -->
<!-- #simulate a smaller dataset for coop with 10 rows -->
<!-- sample_coop <- coop[sample(1:2500, 10),] -->
<!-- sample_coop <- as.data.frame(sample_coop) -->
<!-- sample_coop <- sample_coop %>% -->
<!--   mutate(x2 = rnorm(n=nrow(sample_coop), mean = 3, sd = 2), -->
<!--          x16 = rnorm(n=nrow(sample_coop), mean = 2, sd = 1), -->
<!--          x20 = rnorm(n=nrow(sample_coop), mean = 5, sd = 2), -->
<!--          x24 = rnorm(n=nrow(sample_coop), mean = 6, sd = 4), -->
<!--          x31 = rnorm(n=nrow(sample_coop), mean = 4, sd = 3), -->
<!--          x36 = rnorm(n=nrow(sample_coop), mean = 4, sd = 2), -->
<!--          x40 = rnorm(n=nrow(sample_coop), mean = 7, sd = 1), -->
<!--          ) -->
<!-- ``` -->
<!-- ```{r select key points, eval=FALSE} -->
<!-- bb <- bbox(parana$border) -->
<!-- x <- seq(bb[1, "min"] - 1, bb[1, "max"] + 1, length.out = 50) -->
<!-- y <- seq(bb[2, "min"] - 1, bb[2, "max"] + 1, length.out = 50) -->
<!-- coop <- as.matrix(expand.grid(x, y)) -->
<!-- #Keep only points in the polygons -->
<!-- ##  -->
<!-- # ind <- point.in.polygon( -->
<!-- #   coop[, 1], coop[, 2], -->
<!-- #   parana$border[, 1], parana$border[, 2] -->
<!-- # ) -->
<!-- # coop <- coop[which(ind == 1), ] -->
<!-- plot(coop, asp = 1) -->
<!-- ``` -->
<!-- **Note:** we will add the simulated data to the covariates in our model -->
<!-- ```{r} -->
<!-- covs <- cbind(Data_CMR$lon, Data_CMR$lat,covs) -->
<!-- colnames(covs) <- c("lon", "lat", colnames(covs[, 3:9])) -->
<!-- colnames(sample_coop) <- c("lon", "lat", colnames(covs[, 3:9])) -->
<!-- covs <- rbind(covs, sample_coop) -->
<!-- ``` -->
<p>#Data stacking</p>
<p>To organise the data, effects and projection matrices, the function <code>inla.stack()</code> is used with the following arguments.</p>
<ul>
<li><code>tag</code>: a string for identifying the data.</li>
<li><code>data</code>: a list of data vectors.</li>
<li><code>A</code>: a list of projection matrices.</li>
<li><code>effects</code>: a list with fixed and random effects.</li>
</ul>
<p>A stack with data for estimation (<code>stk.e</code>) is created and is tagged with the string <code>"est"</code>. In this stack, the fixed effects are the intercept (<code>b0</code>) and the random effect is the spatial Gaussian Random Field (<code>s</code>). Therefore, in <code>effects</code> a list with a <code>data.frame</code> with the fixed effects, and a list <code>s</code> containing the indices of the SPDE object (<code>indexs</code>) is passed. <code>A</code> is set to a list where the second element is <code>A</code>, the projection matrix for the random effects, and the first element is <code>1</code> to indicate the fixed effects are mapped one-to-one to the response. In <code>data</code>, the response vector is specified.</p>
<p>Additionally, a stack with data for prediction (<code>stk.p</code>) is created, this time it is tagged with the string <code>pred</code>. In this stack, the response vector is set to <code>NA</code> and the data is specified at the prediction locations.</p>
<p>Finally, a full stack (<code>stk.full</code>) is created through using the function <code>inla.stack()</code> to put the stacks for estimation and prediction together. The following code demonstrates this process.</p>
<div class="sourceCode" id="cb748"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb748-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-1" tabindex="-1"></a><span class="co">#create a variable for the density</span></span>
<span id="cb748-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-2" tabindex="-1"></a>Data_CMR_std<span class="sc">$</span>Density <span class="ot">&lt;-</span> Data_CMR_std<span class="sc">$</span>Total_Pop<span class="sc">/</span>Data_CMR_std<span class="sc">$</span>Total_Building_Count</span>
<span id="cb748-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-3" tabindex="-1"></a></span>
<span id="cb748-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-4" tabindex="-1"></a><span class="co">#select covariates based on earlier model selection</span></span>
<span id="cb748-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-5" tabindex="-1"></a>covs <span class="ot">&lt;-</span> Data_CMR_std <span class="sc">%&gt;%</span></span>
<span id="cb748-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(x2, x16, x20, x24, x31, x36, x40)</span>
<span id="cb748-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-7" tabindex="-1"></a></span>
<span id="cb748-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-8" tabindex="-1"></a><span class="co">#stack the covariates</span></span>
<span id="cb748-9"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-9" tabindex="-1"></a>stk.e <span class="ot">&lt;-</span> <span class="fu">inla.stack</span>(<span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> Data_CMR_std<span class="sc">$</span>Density), <span class="co">#response variable</span></span>
<span id="cb748-10"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-10" tabindex="-1"></a>                      <span class="at">A =</span> <span class="fu">list</span>(A,<span class="dv">1</span>),  <span class="co">#A matrix; the 1 is included to make the </span></span>
<span id="cb748-11"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-11" tabindex="-1"></a>                                              <span class="co">#list(covariates)</span></span>
<span id="cb748-12"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-12" tabindex="-1"></a>                      <span class="at">effects =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="fu">list</span>(<span class="at">Intercept =</span> <span class="dv">1</span>), <span class="co">#the Intercept</span></span>
<span id="cb748-13"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-13" tabindex="-1"></a>                                     indexs),  <span class="co">#the spatial index</span></span>
<span id="cb748-14"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-14" tabindex="-1"></a>                                   <span class="fu">list</span>(covs) <span class="co">#the covariates</span></span>
<span id="cb748-15"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-15" tabindex="-1"></a>                      ),</span>
<span id="cb748-16"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-16" tabindex="-1"></a>                      <span class="at">tag =</span> <span class="st">&#39;est&#39;</span>) <span class="co">#quick name to call upon easily</span></span>
<span id="cb748-17"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-17" tabindex="-1"></a></span>
<span id="cb748-18"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-18" tabindex="-1"></a></span>
<span id="cb748-19"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-19" tabindex="-1"></a></span>
<span id="cb748-20"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-20" tabindex="-1"></a><span class="co">#create a projection matrix for the prediction</span></span>
<span id="cb748-21"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-21" tabindex="-1"></a>Ap <span class="ot">&lt;-</span> <span class="fu">inla.spde.make.A</span>(<span class="at">mesh =</span> mesh, <span class="at">loc =</span> coop) </span>
<span id="cb748-22"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb748-22" tabindex="-1"></a><span class="fu">dim</span>(Ap)</span></code></pre></div>
<pre><code>## [1]  2500 48991</code></pre>
<div class="sourceCode" id="cb750"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb750-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb750-1" tabindex="-1"></a><span class="co">#stack for prediction (stk.p)</span></span>
<span id="cb750-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb750-2" tabindex="-1"></a>stk.p <span class="ot">&lt;-</span> <span class="fu">inla.stack</span>(<span class="at">tag =</span> <span class="st">&quot;pred&quot;</span>, </span>
<span id="cb750-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb750-3" tabindex="-1"></a>                    <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="cn">NA</span>), </span>
<span id="cb750-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb750-4" tabindex="-1"></a>                    <span class="at">A =</span> <span class="fu">list</span>(<span class="dv">1</span>, Ap), </span>
<span id="cb750-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb750-5" tabindex="-1"></a>                    <span class="at">effects =</span> <span class="fu">list</span>(<span class="fu">data.frame</span>(<span class="at">b0 =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(coop))), </span>
<span id="cb750-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb750-6" tabindex="-1"></a>                                   <span class="at">s =</span> indexs) ) </span>
<span id="cb750-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb750-7" tabindex="-1"></a></span>
<span id="cb750-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb750-8" tabindex="-1"></a><span class="co">#stk.full has both stk.e and stk.p </span></span>
<span id="cb750-9"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb750-9" tabindex="-1"></a>stk.full <span class="ot">&lt;-</span> <span class="fu">inla.stack</span>(stk.e, stk.p)</span></code></pre></div>
<p>#Model specification and fitting</p>
<p>To specify and fit the model with spatially varying random effects in R, the code introduced in the earlier section for model set-up can be used. For convenience, this code is repeated here.</p>
<div class="sourceCode" id="cb751"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb751-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb751-1" tabindex="-1"></a><span class="co">#specify the formula</span></span>
<span id="cb751-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb751-2" tabindex="-1"></a>formula <span class="ot">&lt;-</span> y <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> b0 <span class="sc">+</span> <span class="fu">f</span>(s, <span class="at">model =</span> spde)</span>
<span id="cb751-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb751-3" tabindex="-1"></a></span>
<span id="cb751-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb751-4" tabindex="-1"></a><span class="co">#create the INLA model</span></span>
<span id="cb751-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb751-5" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">inla</span>(formula, </span>
<span id="cb751-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb751-6" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">inla.stack.data</span>(stk.full), </span>
<span id="cb751-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb751-7" tabindex="-1"></a>            <span class="at">control.predictor =</span> <span class="fu">list</span>( <span class="at">compute =</span> <span class="cn">TRUE</span>,</span>
<span id="cb751-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb751-8" tabindex="-1"></a>                                      <span class="at">A =</span> <span class="fu">inla.stack.A</span>(stk.full)))</span>
<span id="cb751-9"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb751-9" tabindex="-1"></a></span>
<span id="cb751-10"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb751-10" tabindex="-1"></a><span class="co">#generate the index set</span></span>
<span id="cb751-11"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb751-11" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">inla.stack.index</span>(stk.full, <span class="at">tag =</span> <span class="st">&quot;pred&quot;</span>)<span class="sc">$</span>data </span>
<span id="cb751-12"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb751-12" tabindex="-1"></a></span>
<span id="cb751-13"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb751-13" tabindex="-1"></a><span class="co">#obtain predicted values for the mean and quantiles for 95% credible intervals</span></span>
<span id="cb751-14"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb751-14" tabindex="-1"></a>pred_mean <span class="ot">&lt;-</span> res<span class="sc">$</span>summary.fitted.values[index, <span class="st">&quot;mean&quot;</span>] </span>
<span id="cb751-15"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb751-15" tabindex="-1"></a>pred_ll <span class="ot">&lt;-</span> res<span class="sc">$</span>summary.fitted.values[index, <span class="st">&quot;0.025quant&quot;</span>] </span>
<span id="cb751-16"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb751-16" tabindex="-1"></a>pred_ul <span class="ot">&lt;-</span> res<span class="sc">$</span>summary.fitted.values[index, <span class="st">&quot;0.975quant&quot;</span>]</span></code></pre></div>
<p>#Project to new areas</p>
<p>Vectors <code>res$summary.random$s$mean</code> and <code>res$summary.random$s$sd</code> contain the posterior mean and the posterior standard deviation, respectively, of the spatial field at the mesh nodes. These values can be projected at different locations by computing a projection matrix for the new locations, followed by multiplying the projection matrix by the spatial field values. For example, to compute the posterior mean of the spatial field at locations in the matrix <code>newloc</code>, the following code can be used.</p>
<div class="sourceCode" id="cb752"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb752-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb752-1" tabindex="-1"></a><span class="co">#set the new locations</span></span>
<span id="cb752-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb752-2" tabindex="-1"></a>newloc <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">c</span>(<span class="dv">219</span>, <span class="dv">678</span>, <span class="dv">818</span>), <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">160</span>))</span>
<span id="cb752-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb752-3" tabindex="-1"></a></span>
<span id="cb752-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb752-4" tabindex="-1"></a><span class="co">#create the projection matrix</span></span>
<span id="cb752-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb752-5" tabindex="-1"></a>Aproj <span class="ot">&lt;-</span> <span class="fu">inla.spde.make.A</span>(mesh, <span class="at">loc =</span> newloc)</span>
<span id="cb752-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb752-6" tabindex="-1"></a></span>
<span id="cb752-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb752-7" tabindex="-1"></a><span class="co">#obtain the posterior mean</span></span>
<span id="cb752-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb752-8" tabindex="-1"></a>Aproj <span class="sc">%*%</span> res<span class="sc">$</span>summary.random<span class="sc">$</span>s<span class="sc">$</span>mean</span></code></pre></div>
<pre><code>## 3 x 1 Matrix of class &quot;dgeMatrix&quot;
##      [,1]
## [1,]    0
## [2,]    0
## [3,]    0</code></pre>
<p>Additionally, the functions <code>inla.mesh.projector()</code> and <code>inla.mesh.project()</code> can be used to project the spatial field values at different locations. To do so, firstly, the <code>inla.mesh.projector()</code> function is needed to compute a projection matrix for the new locations, specifying either the locations in the argument <code>loc</code> or computing the locations on a grid by specifying the arguments <code>xlim</code>, <code>ylim</code> and <code>dims</code>.</p>
<p>For example, to compute a projection matrix for 300x300 locations on a grid that covers the mesh region, the following code can be used.</p>
<div class="sourceCode" id="cb754"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb754-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb754-1" tabindex="-1"></a><span class="co">#obtain the range</span></span>
<span id="cb754-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb754-2" tabindex="-1"></a>rang <span class="ot">&lt;-</span> <span class="fu">apply</span>(mesh<span class="sc">$</span>loc[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)], <span class="dv">2</span>, range)</span>
<span id="cb754-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb754-3" tabindex="-1"></a></span>
<span id="cb754-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb754-4" tabindex="-1"></a><span class="co">#project the spatial field values</span></span>
<span id="cb754-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb754-5" tabindex="-1"></a>proj <span class="ot">&lt;-</span> <span class="fu">inla.mesh.projector</span>(mesh,</span>
<span id="cb754-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb754-6" tabindex="-1"></a>  <span class="at">xlim =</span> rang[, <span class="dv">1</span>], <span class="at">ylim =</span> rang[, <span class="dv">2</span>],</span>
<span id="cb754-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb754-7" tabindex="-1"></a>  <span class="at">dims =</span> <span class="fu">c</span>(<span class="dv">300</span>, <span class="dv">300</span>))</span></code></pre></div>
<p>Following this, the function <code>inla.mesh.project()</code> is used to project the posterior mean and the posterior standard deviation of the spatial field calculated at the mesh nodes to the grid locations.</p>
<div class="sourceCode" id="cb755"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb755-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb755-1" tabindex="-1"></a><span class="co">#project the posterior mean</span></span>
<span id="cb755-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb755-2" tabindex="-1"></a>mean_s <span class="ot">&lt;-</span> <span class="fu">inla.mesh.project</span>(proj, res<span class="sc">$</span>summary.random<span class="sc">$</span>s<span class="sc">$</span>mean)</span>
<span id="cb755-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb755-3" tabindex="-1"></a></span>
<span id="cb755-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb755-4" tabindex="-1"></a><span class="co">#project the posterior standard deviation</span></span>
<span id="cb755-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb755-5" tabindex="-1"></a>sd_s <span class="ot">&lt;-</span> <span class="fu">inla.mesh.project</span>(proj, res<span class="sc">$</span>summary.random<span class="sc">$</span>s<span class="sc">$</span>sd)</span></code></pre></div>
<p>The projected values can be plotted suing the <code>ggplot2</code> package in R. To do so, first create a data frame with the coordinates of the grid locations and the spatial field values. the coordinates of the grid locations can be obtained by combining <code>proj$x</code> and <code>proj$y</code>, done through using the function <code>expand.grid()</code>. The values of the posterior mean of the spatial field are in the matrix <code>mean_s</code> and the values of the posterior standard deviation of the spatial field are in the matrix <code>st_s</code>.</p>
<div class="sourceCode" id="cb756"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb756-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb756-1" tabindex="-1"></a><span class="co">#load the viridis and cowplot packages</span></span>
<span id="cb756-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb756-2" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb756-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb756-3" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span></code></pre></div>
<div class="sourceCode" id="cb757"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb757-1"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb757-1" tabindex="-1"></a><span class="co">#prepare the data </span></span>
<span id="cb757-2"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb757-2" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x =</span> proj<span class="sc">$</span>x, <span class="at">y =</span> proj<span class="sc">$</span>y)</span>
<span id="cb757-3"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb757-3" tabindex="-1"></a>df<span class="sc">$</span>mean_s <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(mean_s)</span>
<span id="cb757-4"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb757-4" tabindex="-1"></a>df<span class="sc">$</span>sd_s <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(sd_s)</span>
<span id="cb757-5"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb757-5" tabindex="-1"></a></span>
<span id="cb757-6"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb757-6" tabindex="-1"></a><span class="co">#plot the projected values - mean</span></span>
<span id="cb757-7"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb757-7" tabindex="-1"></a>gmean <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> mean_s)) <span class="sc">+</span></span>
<span id="cb757-8"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb757-8" tabindex="-1"></a>  <span class="fu">geom_raster</span>() <span class="sc">+</span></span>
<span id="cb757-9"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb757-9" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">na.value =</span> <span class="st">&quot;transparent&quot;</span>) <span class="sc">+</span></span>
<span id="cb757-10"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb757-10" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb757-11"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb757-11" tabindex="-1"></a></span>
<span id="cb757-12"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb757-12" tabindex="-1"></a><span class="co">#plot the predicted values - standard deviation</span></span>
<span id="cb757-13"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb757-13" tabindex="-1"></a>gsd <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> sd_s)) <span class="sc">+</span></span>
<span id="cb757-14"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb757-14" tabindex="-1"></a>  <span class="fu">geom_raster</span>() <span class="sc">+</span></span>
<span id="cb757-15"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb757-15" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">na.value =</span> <span class="st">&quot;transparent&quot;</span>) <span class="sc">+</span></span>
<span id="cb757-16"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb757-16" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb757-17"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb757-17" tabindex="-1"></a></span>
<span id="cb757-18"><a href="bayesian-hierarchical-population-modelling-in-r.html#cb757-18" tabindex="-1"></a><span class="fu">plot_grid</span>(gmean, gsd)</span></code></pre></div>
<p><img src="WorldPop_Training_Manual_files/figure-html/plot%20proj%20values-1.png" width="672" /></p>
<p>Useful resources</p>
<ul>
<li>Open Buildings: <a href="https://sites.research.google/gr/open-buildings/">Google</a></li>
<li>Building Footprints: <a href="https://github.com/microsoft/GlobalMLBuildingFootprints">Microsoft</a></li>
<li>Gridded building intensity: <a href="http://planetgis.org/">Planet</a></li>
<li>Modelling in R: <a href="https://r4ds.had.co.nz/model-basics.html">R for Data Science</a></li>
<li>R-INLA package: <a href="https://www.paulamoraga.com/book-geospatial/sec-inla.html">Geospatial Health Data: Modeling and Visualization with R-INLA and Shiny</a></li>
<li>Mixed-effects models with INLA: <a href="https://becarioprecario.bitbucket.io/inla-gitbook/ch-mixed.html">Bayesian inference with INLA</a></li>
<li>Markov Chain Monte Carlo: <a href="https://setosa.io/ev/markov-chains/">Setosa</a></li>
<li>Metropolis-Hastings algorithm: <a href="https://www.bayesrulesbook.com/chapter-7.html">Bayes Rules Book</a></li>
</ul>
<!-- ## Further analysis -->
<!-- #  -->
<!-- # ```{r further analysis, eval = FALSE} -->
<!-- #  -->
<!-- # d[, c("long", "lat")] <- coordinates(spst) -->
<!-- # head(d) -->
<!-- #  -->
<!-- # library(sp) -->
<!-- # library(rgdal) -->
<!-- # sps <- SpatialPoints(d[, c("x", "y")], -->
<!-- #   proj4string = CRS("+proj=utm +zone=28") -->
<!-- # ) -->
<!-- #  -->
<!-- # spst <- spTransform(sps, CRS("+proj=longlat +datum=WGS84")) -->
<!-- #  -->
<!-- # library(leaflet) -->
<!-- # library(viridis) -->
<!-- #  -->
<!-- # pal <- colorBin("viridis", bins = c(0, 0.25, 0.5, 0.75, 1)) -->
<!-- # leaflet(d) %>% -->
<!-- #   addProviderTiles(providers$CartoDB.Positron) %>% -->
<!-- #   addCircles(lng = ~long, lat = ~lat, color = ~ pal(prev)) %>% -->
<!-- #   addLegend("bottomright", -->
<!-- #     pal = pal, values = ~prev, -->
<!-- #     title = "Prev." -->
<!-- #   ) %>% -->
<!-- #  -->
<!-- #   addScaleBar(position = c("bottomleft")) -->
<!-- #  -->
<!-- # library(raster) -->
<!-- #  -->
<!-- # r <- getData(name = "alt", country = "GMB", mask = TRUE) -->
<!-- # pal <- colorNumeric("viridis", values(r), -->
<!-- #   na.color = "transparent" -->
<!-- # ) -->
<!-- #  -->
<!-- # leaflet() %>% -->
<!-- #   addProviderTiles(providers$CartoDB.Positron) %>% -->
<!-- #   addRasterImage(r, colors = pal, opacity = 0.5) %>% -->
<!-- #   addLegend("bottomright", -->
<!-- #     pal = pal, values = values(r), -->
<!-- #     title = "Altitude" -->
<!-- #   ) %>% -->
<!-- #   addScaleBar(position = c("bottomleft")) -->
<!-- #  -->
<!-- # library(INLA) -->
<!-- # coo <- cbind(d$long, d$lat) -->
<!-- # mesh <- inla.mesh.2d( -->
<!-- #   loc = coordinates, max.edge = c(0.1, 5), -->
<!-- #   cutoff = 0.01 -->
<!-- # ) -->

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction-to-small-area-population-estimation-and-modelling-sapem.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="model-fit-checks-and-cross-validation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "section",
    "scroll_highlight": true
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
